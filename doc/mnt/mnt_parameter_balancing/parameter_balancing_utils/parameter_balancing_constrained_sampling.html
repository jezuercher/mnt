<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of parameter_balancing_constrained_sampling</title>
  <meta name="keywords" content="parameter_balancing_constrained_sampling">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">mnt</a> &gt; <a href="../index.html">mnt_parameter_balancing</a> &gt; <a href="index.html">parameter_balancing_utils</a> &gt; parameter_balancing_constrained_sampling.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for mnt/mnt_parameter_balancing/parameter_balancing_utils&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>parameter_balancing_constrained_sampling
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [q_sample, xmodel_sample, xdata_sample, kinetics_sample, v_sample, q_min, q_max] = parameter_balancing_constrained_sampling(task,res,options,quantity_info) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../mnt/mnt_network/network_query/network_numbers.html" class="code" title="function [nr,nm,nx,KM_indices,KA_indices,KI_indices,nKM,nKA,nKI] = network_numbers(network)">network_numbers</a>	[nr,nm,nx,KM_indices,KA_indices,KI_indices,nKM,nKA,nKI] = network_numbers(network)</li><li><a href="parameter_balancing_quantity_numbers.html" class="code" title="function num = parameter_balancing_quantity_numbers(quantities,quantity_info,network)">parameter_balancing_quantity_numbers</a>	count how many quantities of a certain type appear in a model</li><li><a href="parameter_balancing_sample_models.html" class="code" title="function [v, kinetics_list] = parameter_balancing_sample_models(task,kinetics_sample,options)">parameter_balancing_sample_models</a>	</li><li><a href="../../../mnt/utils/convex_sampling.html" class="code" title="function [x, x_lower, x_upper, success_flag, x_lower_list, x_upper_list] = convex_sampling(A_ineq,b_ineq,A_eq,b_eq,n_sample,xl,xu,verbose,method,options)">convex_sampling</a>	[x, x_lower. x_upper, success_flag, x_lower_list, x_upper_list] = convex_sampling(A_ineq,b_ineq,A_eq,b_eq,n_sample,xl,xu);</li><li><a href="../../../mnt/utils/default.html" class="code" title="function commandstring = default(varargin)">default</a>	commandstring = default(varname1,defaultvalue1,varname2,defaultvalue2,...)</li><li><a href="../../../mnt/utils/join_struct.html" class="code" title="function c = join_struct(a,b)">join_struct</a>	c = join_struct(a,b)</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [q_sample, xmodel_sample, xdata_sample, kinetics_sample, v_sample, q_min, q_max] = parameter_balancing_constrained_sampling(task,res,options,quantity_info)</a>
0002 
0003 eval(<a href="../../../mnt/utils/default.html" class="code" title="function commandstring = default(varargin)">default</a>(<span class="string">'options'</span>,<span class="string">'struct'</span>,<span class="string">'quantity_info'</span>,<span class="string">' data_integration_load_quantity_info'</span>));
0004 
0005 options_default.n_sample = 1000;
0006 options_default.n_warm   = [];
0007 options_default.n_pick   = 10;
0008 options_default.q_width  = 10;
0009 options_default.compute_reaction_velocities = 0;
0010 options_default.flag_artificial_centering = 0;
0011 options_default.insert_pseudo_values = 0;
0012 options_default.sampling_type = <span class="string">'gaussian'</span>;
0013 options_default.start_sampling_near_mode = 0;
0014 options_default.try_rejection_sampling = 0;
0015 
0016 options = <a href="../../../mnt/utils/join_struct.html" class="code" title="function c = join_struct(a,b)">join_struct</a>(options_default,options);
0017 
0018 <span class="comment">% use all lower and upper values as explicit constraints</span>
0019 
0020 xconstraints = [-task.xlower.value_nat; <span class="keyword">...</span>
0021                  task.xupper.value_nat; ];
0022 
0023 Qconstraints = [-task.Q_xlower_q; <span class="keyword">...</span>
0024                  task.Q_xupper_q;];
0025 
0026 <span class="keyword">if</span> options.insert_pseudo_values,
0027 
0028 xconstraints = [xconstraints; <span class="keyword">...</span>
0029                 -task.xall.lower_nat; <span class="keyword">...</span>
0030                  task.xall.upper_nat;];
0031 
0032 Qconstraints = [Qconstraints; <span class="keyword">...</span>
0033                 -task.Q_xall_q; <span class="keyword">...</span>
0034                  task.Q_xall_q];
0035 
0036 <span class="keyword">end</span>
0037 
0038 ind_exact    = find(task.xdata.std &lt; 10^-3);
0039 <span class="keyword">if</span> ind_exact,
0040   display(<span class="string">'Data points with standard deviations &lt;10^-3 found. Using equality constraints.'</span>); 
0041   x_exact = task.xdata.mean(ind_exact);
0042   Q_exact = task.Q_xdata_q(ind_exact,:);
0043   ind_nonexact = find(task.xdata.std &gt;= 10^-3);
0044 <span class="keyword">else</span>
0045   x_exact = [];
0046   Q_exact = [];
0047 <span class="keyword">end</span>
0048 
0049 q_mode  = res.q_posterior.mode;
0050 q_mean  = res.q_posterior.mean;
0051 q_cov   = res.q_posterior.cov;
0052 q_std   = sqrt(diag(q_cov));
0053 q_lower = q_mode - options.q_width * q_std;
0054 q_upper = q_mode + options.q_width * q_std;
0055 
0056 <span class="keyword">if</span> options.start_sampling_near_mode,
0057   q_start = res.q_posterior.mode; 
0058 <span class="keyword">else</span>, 
0059   q_start = [];
0060 <span class="keyword">end</span>
0061 
0062 <span class="keyword">switch</span> options.sampling_type,
0063   
0064   <span class="keyword">case</span> <span class="string">'gaussian'</span>,
0065     
0066     display(<span class="string">'Running sampling with Gaussian distribution and constraints'</span>);
0067     <span class="comment">%% call hit and run directly</span>
0068     <span class="comment">%% [q_sample, q_min, q_max] = convex_sampling_hit_and_run(Qconstraints, xconstraints, Q_exact, x_exact, q_lower, q_upper, q_mean, q_cov, options.n_sample, options.n_warm,options.n_pick,options.flag_artificial_centering, q_start);</span>
0069     <span class="comment">%% call convex_sampling (remove equality constraints first)</span>
0070     ooptions         = options;
0071     ooptions.x_mean  = q_mean;
0072     ooptions.x_cov   = q_cov;
0073     ooptions.x_start = q_start;
0074     [q_sample, q_min, q_max] = <a href="../../../mnt/utils/convex_sampling.html" class="code" title="function [x, x_lower, x_upper, success_flag, x_lower_list, x_upper_list] = convex_sampling(A_ineq,b_ineq,A_eq,b_eq,n_sample,xl,xu,verbose,method,options)">convex_sampling</a>(Qconstraints, xconstraints, Q_exact, x_exact, options.n_sample, q_lower, q_upper, 1, <span class="string">'hit-and-run'</span>, ooptions);
0075     
0076   <span class="keyword">case</span> <span class="string">'uniform'</span>,
0077     
0078     display(<span class="string">'Running uniform sampling'</span>);
0079     <span class="keyword">switch</span> options.try_rejection_sampling,
0080       <span class="keyword">case</span> 1,
0081         display(<span class="string">'Using rejection sampling instead of hit-and run'</span>);
0082         [q_sample, q_min, q_max] = <a href="../../../mnt/utils/convex_sampling.html" class="code" title="function [x, x_lower, x_upper, success_flag, x_lower_list, x_upper_list] = convex_sampling(A_ineq,b_ineq,A_eq,b_eq,n_sample,xl,xu,verbose,method,options)">convex_sampling</a>(Qconstraints, xconstraints, Q_exact, x_exact,options.n_sample,q_lower, q_upper,0);
0083       <span class="keyword">case</span> 0,
0084         display(<span class="string">'Using hit-and run sampling'</span>);
0085         <span class="comment">%% call hit and run directly</span>
0086         <span class="comment">%% [q_sample, q_min, q_max] = convex_sampling_hit_and_run(Qconstraints, xconstraints, Q_exact, x_exact, q_lower, q_upper, [], [], options.n_sample, options.n_warm,options.n_pick,options.flag_artificial_centering, q_start );</span>
0087         <span class="comment">%% call convex_sampling (remove equality constraints first)</span>
0088         ooptions = options;
0089         ooptions.x_mean  = [];
0090         ooptions.x_cov   = [];
0091         ooptions.x_start = q_start;
0092         [q_sample, q_min, q_max] = <a href="../../../mnt/utils/convex_sampling.html" class="code" title="function [x, x_lower, x_upper, success_flag, x_lower_list, x_upper_list] = convex_sampling(A_ineq,b_ineq,A_eq,b_eq,n_sample,xl,xu,verbose,method,options)">convex_sampling</a>(Qconstraints, xconstraints, Q_exact, x_exact,options.n_sample,q_lower, q_upper,1,<span class="string">'hit-and-run'</span>,ooptions);   <span class="keyword">end</span>
0093   
0094 <span class="keyword">end</span>
0095 
0096 xmodel_sample = task.Q_xmodel_q * q_sample;
0097 xdata_sample  = task.Q_xdata_q  * q_sample;
0098 
0099 
0100 <span class="comment">% -----------------------------------------------------------------------</span>
0101 <span class="comment">% translate the sampled model values back to kinetic constants</span>
0102 
0103 [nr,nm,nx,ind_KM,ind_KA,ind_KI,nKM,nKA,nKI] = <a href="../../../mnt/mnt_network/network_query/network_numbers.html" class="code" title="function [nr,nm,nx,KM_indices,KA_indices,KI_indices,nKM,nKA,nKI] = network_numbers(network)">network_numbers</a>(task.network);
0104 
0105 num_model = <a href="parameter_balancing_quantity_numbers.html" class="code" title="function num = parameter_balancing_quantity_numbers(quantities,quantity_info,network)">parameter_balancing_quantity_numbers</a>(task.model_quantities,quantity_info,task.network);
0106 
0107 <span class="keyword">for</span> it = 1:length(task.model_quantities),
0108   my_quantity     = task.model_quantities{it};
0109   ind             = find(strcmp(my_quantity,quantity_info.QuantityType));
0110   my_scaling      = quantity_info.Scaling{ind};
0111   my_symbol       = quantity_info.Symbol{ind};
0112   my_indices      = task.xmodel.indices.(my_symbol);
0113   my_x_sample     = xmodel_sample(my_indices,:);
0114 
0115   <span class="keyword">if</span> strcmp( my_scaling, <span class="string">'Logarithmic'</span>),
0116     my_x_sample   = exp(my_x_sample);
0117   <span class="keyword">else</span>
0118     my_x_sample   = my_x_sample;
0119   <span class="keyword">end</span>
0120   
0121   <span class="keyword">switch</span> my_symbol, 
0122     <span class="keyword">case</span> <span class="string">'KM'</span>, indices = ind_KM;
0123     <span class="keyword">case</span> <span class="string">'KA'</span>, indices = ind_KA;
0124     <span class="keyword">case</span> <span class="string">'KI'</span>, indices = ind_KI;
0125   <span class="keyword">end</span>
0126 
0127   <span class="keyword">switch</span> my_symbol, 
0128     <span class="keyword">case</span> {<span class="string">'KM'</span>},
0129       my_x_sample  =  exp(xmodel_sample(task.xmodel.indices.KM,:));
0130     <span class="keyword">case</span> {<span class="string">'KA'</span>},
0131       my_x_sample  =  exp(xmodel_sample(task.xmodel.indices.KA,:));
0132     <span class="keyword">case</span> {<span class="string">'KI'</span>},
0133       my_x_sample  =  exp(xmodel_sample(task.xmodel.indices.KI,:));
0134   <span class="keyword">end</span>
0135 
0136   kinetics_sample.(my_symbol)   = my_x_sample;
0137   
0138 <span class="keyword">end</span>
0139 
0140 <span class="keyword">if</span> options.compute_reaction_velocities,
0141   my_kinetics = task.network.kinetics;
0142   <span class="keyword">if</span> strcmp(<span class="string">'cs'</span>,my_kinetics.type),
0143     [v_sample] = <a href="parameter_balancing_sample_models.html" class="code" title="function [v, kinetics_list] = parameter_balancing_sample_models(task,kinetics_sample,options)">parameter_balancing_sample_models</a>(task,kinetics_sample,struct(<span class="string">'sample_models'</span>,<span class="string">'0'</span>));
0144   <span class="keyword">else</span>
0145     error(<span class="string">'Kinetics not supported'</span>);
0146   <span class="keyword">end</span>
0147 <span class="keyword">else</span>,
0148   v_sample = [];
0149 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Wed 10-Apr-2013 10:42:33 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>