<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of network_integrate_par_pert</title>
  <meta name="keywords" content="network_integrate_par_pert">
  <meta name="description" content="[t, s, v, p, s_int,  met_int] = network_integrate_par_pert(network, s, T, gf, par_osc, dt)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">mnt</a> &gt; <a href="#">mnt_simulation</a> &gt; network_integrate_par_pert.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for ./mnt/mnt_simulation&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>network_integrate_par_pert
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>[t, s, v, p, s_int,  met_int] = network_integrate_par_pert(network, s, T, gf, par_osc, dt)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [t, s_t, v, p, s_int_t, met_int]= network_integrate_par_pert(network, s, T, graphics_flag,par_osc,dt) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">[t, s, v, p, s_int,  met_int] = network_integrate_par_pert(network, s, T, gf, par_osc, dt)

solve differential equations for metabolic network with field 'kinetics'

INPUT
network    network data structure (see 'metabolic_networks')
s          initial concentrations (row vector)
T          integration time (or list of integration time points)
dt       time step in output of results
par_osc    list of structures describing oscillatory parameters,
           each with:  
             name             parameter name
             type             'values' (interpolation between values)
                              'complex' (complex exponential), 'cos' (cosine), 'sin' (sine)
             if type = 'values' 
               t                time points
               values           values
             else
               mean             mean value of oscillation
               amplitude        amplitude of oscillation
               omega            circular frequency
               phase            phase angle at time t=0
gf         graphics flag

OUTPUT
t          vector of time points
s_int, s   (matrices) timecourses of internal/all metabolite concentrations
met_int    list of internal metabolites

 Information about compartment volumes can be given in fields
 'metabolite_compartments', 'compartments', and 'compartment_sizes'
 If 'metabolite_compartments' does not exist, all metabolites are considered in a volume of 1

 for visualising the results at one time point, type
 i=1;  % (number of time point)
 netgraph_draw(network,'metvalues',s_t(:,i),'actvalues',...
               network_velocities(s_t(:,i),network,network.kinetics));

For extracting a single oscillation period, see 'choose_period'</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../.././mnt/mnt_kinetics/kinetics/network_velocities.html" class="code" title="function v = network_velocities(s, network, kinetics, split, indices,t)">network_velocities</a>	v = network_velocities(s,network,kinetics,split,indices,t)</li><li><a href="../.././mnt/utils/label_names.html" class="code" title="function [label,indices] = label_names(names,allnames,method)">label_names</a>	function [label,indices] = label_names(names,allnames, method)</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function f = integrate_network_der_MA(t,s_int,s_ext,Nf_int,Nb_int,network,par_osc)</a></li><li><a href="#_sub2" class="code">function f = integrate_network_der(t,s_int,network,internal,external,s_ext,N_int,po)</a></li><li><a href="#_sub3" class="code">function [network,p] = compute_parameters(network,t,po)</a></li></ul>
<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%[t, s, v, p, s_int,  met_int] = network_integrate_par_pert(network, s, T, gf, par_osc, dt)</span>
0002 <span class="comment">%</span>
0003 <span class="comment">%solve differential equations for metabolic network with field 'kinetics'</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%INPUT</span>
0006 <span class="comment">%network    network data structure (see 'metabolic_networks')</span>
0007 <span class="comment">%s          initial concentrations (row vector)</span>
0008 <span class="comment">%T          integration time (or list of integration time points)</span>
0009 <span class="comment">%dt       time step in output of results</span>
0010 <span class="comment">%par_osc    list of structures describing oscillatory parameters,</span>
0011 <span class="comment">%           each with:</span>
0012 <span class="comment">%             name             parameter name</span>
0013 <span class="comment">%             type             'values' (interpolation between values)</span>
0014 <span class="comment">%                              'complex' (complex exponential), 'cos' (cosine), 'sin' (sine)</span>
0015 <span class="comment">%             if type = 'values'</span>
0016 <span class="comment">%               t                time points</span>
0017 <span class="comment">%               values           values</span>
0018 <span class="comment">%             else</span>
0019 <span class="comment">%               mean             mean value of oscillation</span>
0020 <span class="comment">%               amplitude        amplitude of oscillation</span>
0021 <span class="comment">%               omega            circular frequency</span>
0022 <span class="comment">%               phase            phase angle at time t=0</span>
0023 <span class="comment">%gf         graphics flag</span>
0024 <span class="comment">%</span>
0025 <span class="comment">%OUTPUT</span>
0026 <span class="comment">%t          vector of time points</span>
0027 <span class="comment">%s_int, s   (matrices) timecourses of internal/all metabolite concentrations</span>
0028 <span class="comment">%met_int    list of internal metabolites</span>
0029 <span class="comment">%</span>
0030 <span class="comment">% Information about compartment volumes can be given in fields</span>
0031 <span class="comment">% 'metabolite_compartments', 'compartments', and 'compartment_sizes'</span>
0032 <span class="comment">% If 'metabolite_compartments' does not exist, all metabolites are considered in a volume of 1</span>
0033 <span class="comment">%</span>
0034 <span class="comment">% for visualising the results at one time point, type</span>
0035 <span class="comment">% i=1;  % (number of time point)</span>
0036 <span class="comment">% netgraph_draw(network,'metvalues',s_t(:,i),'actvalues',...</span>
0037 <span class="comment">%               network_velocities(s_t(:,i),network,network.kinetics));</span>
0038 <span class="comment">%</span>
0039 <span class="comment">%For extracting a single oscillation period, see 'choose_period'</span>
0040 
0041 <a name="_sub0" href="#_subfunctions" class="code">function [t, s_t, v, p, s_int_t, met_int]= network_integrate_par_pert(network, s, T, graphics_flag,par_osc,dt)</a>
0042 
0043 <span class="keyword">if</span> ~exist(<span class="string">'s'</span>,<span class="string">'var'</span>),             s  = rand(size(network.metabolites)); <span class="keyword">end</span>
0044 <span class="keyword">if</span> ~exist(<span class="string">'T'</span>,<span class="string">'var'</span>),             T  = 1; <span class="keyword">end</span>
0045 <span class="keyword">if</span> ~exist(<span class="string">'dt'</span>,<span class="string">'var'</span>),            dt = 0.005*max(T); <span class="keyword">end</span>
0046 <span class="keyword">if</span> ~exist(<span class="string">'par_osc'</span>,<span class="string">'var'</span>),       par_osc = {}; <span class="keyword">end</span>
0047 <span class="keyword">if</span> ~exist(<span class="string">'graphics_flag'</span>,<span class="string">'var'</span>), graphics_flag = 0; <span class="keyword">end</span>
0048 
0049 [n_S,n_A] = size(network.N);
0050 external  = find(network.external);
0051 internal  = setdiff(1:n_S,external)';
0052 s_int     = s(internal);
0053 s_ext     = s(external);
0054 
0055 volumes = ones(length(internal),1);
0056 <span class="keyword">if</span> isfield(network,<span class="string">'metabolite_compartments'</span>),
0057   ll = <a href="../.././mnt/utils/label_names.html" class="code" title="function [label,indices] = label_names(names,allnames,method)">label_names</a>(metabolite_compartments(internal), network.compartments);
0058   volumes = network.compartment_sizes(ll);
0059   display(<span class="string">'Dynamic simulation: Using given compartment volumes = 1'</span>);
0060 <span class="keyword">else</span>,
0061   display(<span class="string">'Dynamic simulation: Assuming compartment volumes = 1'</span>);
0062 <span class="keyword">end</span>
0063 
0064 N     = network.N;
0065 N_int = diag(1./volumes) * N(internal,:);
0066 
0067 <span class="keyword">switch</span> network.kinetics.type,
0068   
0069   <span class="keyword">case</span> <span class="string">'mass-action'</span>,
0070     [n_met,n_A] = size(N);
0071     
0072     <span class="keyword">if</span> isfield(network.kinetics,<span class="string">'exponents'</span>),
0073       Nf = network.kinetics.exponents.*(N&lt;0);
0074       Nb = network.kinetics.exponents.*(N&gt;0);
0075     <span class="keyword">else</span>,
0076       Nf  = abs(N.*(N&lt;0));
0077       Nb  =     N.*(N&gt;0);      
0078     <span class="keyword">end</span>
0079     Nfint = Nf(internal,:);
0080     Nbint = Nb(internal,:);
0081     
0082     <span class="keyword">if</span> ~isfield(network.kinetics,<span class="string">'used_fwd'</span>), 
0083       network.kinetics.used_fwd = ones(size(network.kinetics.k_fwd));
0084       network.kinetics.used_bwd = ones(size(network.kinetics.k_bwd));
0085     <span class="keyword">end</span>
0086     
0087     df = prod( repmat(s(external),1,n_A) .^ Nf(external,:))';
0088     db = prod( repmat(s(external),1,n_A) .^ Nb(external,:))';
0089 
0090     [t,s_int_t] = ode23(@<a href="#_sub1" class="code" title="subfunction f = integrate_network_der_MA(t,s_int,s_ext,Nf_int,Nb_int,network,par_osc)">integrate_network_der_MA</a>,[0:dt:T],s_int,[],s_ext,Nfint,Nbint,network,par_osc);
0091     
0092 <span class="comment">%   case 'numeric',</span>
0093 <span class="comment">%     N_internal = N;</span>
0094 <span class="comment">%     N_internal(find(network.external),:) = 0;</span>
0095 <span class="comment">%     N_internal(find(network.external==0),:) = diag(1./volumes) * N_internal(find(network.external==0),:);</span>
0096 <span class="comment">%     [t,s_t] = network_integrate_kin(s,network.kinetics.parameters,0,T,...</span>
0097 <span class="comment">%                     N_internal,network.kinetics.velocity_function);</span>
0098 <span class="comment">%      s_int_t=s_t(:,internal);</span>
0099   
0100   <span class="keyword">otherwise</span>,
0101      <span class="keyword">if</span> length(T)==1,
0102        t = [0:dt:T]'; 
0103      <span class="keyword">else</span>,
0104        t = T;
0105      <span class="keyword">end</span>
0106      
0107      <span class="keyword">if</span> length(s_int),
0108        [t,s_int_t] = ode45(@<a href="#_sub2" class="code" title="subfunction f = integrate_network_der(t,s_int,network,internal,external,s_ext,N_int,po)">integrate_network_der</a>,t,s_int,[],network,internal,external,s_ext,N_int,par_osc);
0109      <span class="keyword">else</span>,
0110        s_int_t = zeros(0,length(t));
0111      <span class="keyword">end</span>
0112  <span class="keyword">end</span>    
0113  
0114  s_int_t = s_int_t';
0115  s_t     = ones(n_S,length(t)); 
0116  s_t(internal,:) = s_int_t; 
0117 
0118 <span class="keyword">if</span> length(external), s_t(external,:) = repmat(s_ext,1,length(t)); <span class="keyword">end</span>
0119 
0120 <span class="keyword">if</span> graphics_flag,
0121   [ni,nk]=subplot_n(size(s_t,1));
0122   <span class="keyword">for</span> i=1:size(s,1), 
0123     subplot(ni,nk,i);
0124     plot(t,s_t(i,:));
0125     axis([t(1) t(end) 0 max(s_t(i,:)) ]);
0126     title(network.metabolites{i});
0127   <span class="keyword">end</span>
0128 <span class="keyword">end</span>;
0129 
0130 <span class="keyword">for</span> it = 1:length(t),
0131   [n,pp]  = <a href="#_sub3" class="code" title="subfunction [network,p] = compute_parameters(network,t,po)">compute_parameters</a>(network,t(it),par_osc);
0132   v(:,it) = <a href="../.././mnt/mnt_kinetics/kinetics/network_velocities.html" class="code" title="function v = network_velocities(s, network, kinetics, split, indices,t)">network_velocities</a>(s_t(:,it),n);
0133   <span class="keyword">if</span> length(pp), p(:,it) = pp'; <span class="keyword">else</span> p=[]; <span class="keyword">end</span>
0134 <span class="keyword">end</span>
0135 
0136 met_int = network.metabolites(internal);
0137 
0138 
0139 <span class="comment">% --------------------------------------------------------------------</span>
0140 
0141 <a name="_sub1" href="#_subfunctions" class="code">function f = integrate_network_der_MA(t,s_int,s_ext,Nf_int,Nb_int,network,par_osc)</a>
0142 
0143 <span class="comment">% vector f contains time derivative of the internal metabolites</span>
0144 
0145 k_fwdT = network.kinetics.used_fwd' .* network.kinetics.k_fwd' .* df';
0146 k_bwdT = network.kinetics.used_bwd' .* network.kinetics.k_bwd' .* db';
0147 Nk_fwdT = N_int * sparse(diag(k_fwdT));
0148 Nk_bwdT = N_int * sparse(diag(k_bwdT));
0149 
0150 log_s_int = log(s_int+10^-14);
0151 
0152 f = Nk_fwdT *  exp(Nf_int' * log_s_int )   -   Nk_bwdT *  exp(Nb_int' * log_s_int);
0153 
0154 
0155 <span class="comment">% --------------------------------------------------------------------</span>
0156 
0157 <a name="_sub2" href="#_subfunctions" class="code">function f = integrate_network_der(t,s_int,network,internal,external,s_ext,N_int,po)</a>
0158 
0159 <span class="comment">% vector f contains time derivative of the internal metabolites</span>
0160 
0161 network = <a href="#_sub3" class="code" title="subfunction [network,p] = compute_parameters(network,t,po)">compute_parameters</a>(network,t,po);
0162 
0163 s(internal)  = s_int;
0164 s(external)  = s_ext;
0165 f            = N_int * <a href="../.././mnt/mnt_kinetics/kinetics/network_velocities.html" class="code" title="function v = network_velocities(s, network, kinetics, split, indices,t)">network_velocities</a>(s,network);
0166 
0167  
0168 <span class="comment">%-----------------------------------------------------------------------</span>
0169  
0170 <a name="_sub3" href="#_subfunctions" class="code">function [network,p] = compute_parameters(network,t,po)</a>
0171 
0172 <span class="keyword">switch</span> network.kinetics.type,
0173   <span class="keyword">case</span> <span class="string">'numeric'</span>,
0174     p = [];
0175     <span class="keyword">for</span> it = 1:length(po),
0176       <span class="keyword">switch</span> po{it}.type,
0177     <span class="keyword">case</span> <span class="string">'complex'</span>,
0178       p(it) = po{it}.mean + po{it}.amplitude * exp(i * (po{it}.phase +  po{it}.omega * t ));
0179     <span class="keyword">case</span> <span class="string">'cos'</span>,
0180       p(it) = po{it}.mean + po{it}.amplitude * cos( po{it}.phase +  po{it}.omega * t );
0181     <span class="keyword">case</span> <span class="string">'sin'</span>,
0182       p(it) = po{it}.mean + po{it}.amplitude * sin( po{it}.phase +  po{it}.omega * t );
0183     <span class="keyword">case</span> <span class="string">'values'</span>,
0184           p(it) = interp1(po{it}.t,po{it}.values,t,<span class="string">'spline'</span>);
0185       <span class="keyword">end</span>       
0186       network.kinetics.parameters = setfield(network.kinetics.parameters,po{it}.name,p(it));
0187     <span class="keyword">end</span>
0188   <span class="keyword">otherwise</span>, fprintf(<span class="string">'Parameter oscillations not supported for this kinetics type\n'</span>);
0189 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Sat 15-Nov-2014 18:05:26 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>