<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of network_integrate_kin</title>
  <meta name="keywords" content="network_integrate_kin">
  <meta name="description" content="[t,x,v,t_pre,x_pre,p_p_pre] = network_integrate_kin(x0,pp,T1,T2,N,velocity_function,delta_par,external)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">mnt</a> &gt; <a href="index.html">mnt_simulation</a> &gt; network_integrate_kin.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for mnt/mnt_simulation&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>network_integrate_kin
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>[t,x,v,t_pre,x_pre,p_p_pre] = network_integrate_kin(x0,pp,T1,T2,N,velocity_function,delta_par,external)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [t,x,v,t_pre,x_pre,p,p_pre] = network_integrate_kin(x0,pp,T1,T2,N,velocity_function,delta_par,external) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">[t,x,v,t_pre,x_pre,p_p_pre] = network_integrate_kin(x0,pp,T1,T2,N,velocity_function,delta_par,external)

 Time integration for metabolic systems with one oscillatory parameter
  kinetics function given by m-file and structure array of parameters

ARGUMENTS
 x0           initial concentrations (vector)
 p            parameters (structure array)
 T1, T2       integration times for tuning and simulation
 N            stoichiometric matrix
 velocity_function function handle to kinetics function
 delta_par    structure array describing the parameter perturbation
              (optional)

FIELDS OF delta_par: 
 type (optional)  'complex', 'cos'
 omega            circular frequency
 name             parameter name
 value            amplitude of oscillation

For extracting a single oscillation period, see 'choose_period'</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../mnt/utils/default.html" class="code" title="function commandstring = default(varargin)">default</a>	commandstring = default(varname1,defaultvalue1,varname2,defaultvalue2,...)</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="network_integrate.html" class="code" title="function [t, s_t, s_int_t, met_int,v,x_assign] = network_integrate(network, s_init, T, graphics_flag, verbose_flag, Tmax,dilution_rate,ode_opt)">network_integrate</a>	[t, s, s_int, met_int,v,x_assign] = network_integrate(network, s_init, T, graphics_flag, verbose_flag,Tmax,dilution_rate,ode_opt)</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function x_dot = derivatives(t,x,N,pp,velocity_function)</a></li><li><a href="#_sub2" class="code">function x_dot = der_pert_cos(t,x,N,pp,velocity_function,delta_par)</a></li><li><a href="#_sub3" class="code">function x_dot = der_pert_complex(t,x,N,pp,velocity_function,delta_par)</a></li><li><a href="#_sub4" class="code">function x_dot = der_pert_prescribed(t,x,N,pp,velocity_function,delta_par)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%[t,x,v,t_pre,x_pre,p_p_pre] = network_integrate_kin(x0,pp,T1,T2,N,velocity_function,delta_par,external)</span>
0002 <span class="comment">%</span>
0003 <span class="comment">% Time integration for metabolic systems with one oscillatory parameter</span>
0004 <span class="comment">%  kinetics function given by m-file and structure array of parameters</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%ARGUMENTS</span>
0007 <span class="comment">% x0           initial concentrations (vector)</span>
0008 <span class="comment">% p            parameters (structure array)</span>
0009 <span class="comment">% T1, T2       integration times for tuning and simulation</span>
0010 <span class="comment">% N            stoichiometric matrix</span>
0011 <span class="comment">% velocity_function function handle to kinetics function</span>
0012 <span class="comment">% delta_par    structure array describing the parameter perturbation</span>
0013 <span class="comment">%              (optional)</span>
0014 <span class="comment">%</span>
0015 <span class="comment">%FIELDS OF delta_par:</span>
0016 <span class="comment">% type (optional)  'complex', 'cos'</span>
0017 <span class="comment">% omega            circular frequency</span>
0018 <span class="comment">% name             parameter name</span>
0019 <span class="comment">% value            amplitude of oscillation</span>
0020 <span class="comment">%</span>
0021 <span class="comment">%For extracting a single oscillation period, see 'choose_period'</span>
0022 
0023 <a name="_sub0" href="#_subfunctions" class="code">function [t,x,v,t_pre,x_pre,p,p_pre] = network_integrate_kin(x0,pp,T1,T2,N,velocity_function,delta_par,external)</a>
0024 
0025 eval(<a href="../../mnt/utils/default.html" class="code" title="function commandstring = default(varargin)">default</a>(<span class="string">'external'</span>,<span class="string">'[]'</span>,<span class="string">'delta_par'</span>,<span class="string">'[]'</span>));
0026 
0027 odeoptions = odeset(<span class="string">'NonNegative'</span>,1:length(x0),<span class="string">'RelTol'</span>, 1e-6);
0028 
0029 <span class="keyword">if</span> length(T2)==1, T2 = 0:T2/100:T2; <span class="keyword">end</span>
0030 
0031 N(find(external),:) = 0;
0032 
0033 <span class="comment">% --------------------------------------------------------------------</span>
0034 
0035 <span class="keyword">if</span> ~isempty(delta_par),
0036   <span class="keyword">if</span> delta_par.omega~=0,
0037     odeoptions1=odeset(<span class="string">'MaxStep'</span>,2*pi/delta_par.omega/10,<span class="string">'NonNegative'</span>,ones(size(x0)));
0038     odeoptions2=odeset(<span class="string">'MaxStep'</span>,2*pi/delta_par.omega/100,<span class="string">'NonNegative'</span>,ones(size(x0)));
0039   <span class="keyword">end</span>
0040   <span class="keyword">if</span> ~isfield(delta_par,<span class="string">'type'</span>), delta_par.type=<span class="string">'complex'</span>; <span class="keyword">end</span>
0041 <span class="keyword">end</span>
0042 
0043 <span class="comment">% --------------------------------------------------------------------</span>
0044 
0045 <span class="keyword">if</span> T1 &gt; 0, 
0046   <span class="keyword">if</span> ~isempty(delta_par),
0047     <span class="keyword">switch</span> delta_par.type,
0048       
0049       <span class="keyword">case</span> <span class="string">'cos'</span>,
0050         [t_pre,x_pre] = ode15s(@<a href="#_sub2" class="code" title="subfunction x_dot = der_pert_cos(t,x,N,pp,velocity_function,delta_par)">der_pert_cos</a>,[ -T1, 0],x0,odeoptions1,N,pp,velocity_function,delta_par);
0051         <span class="keyword">for</span> j=1:size(t_pre),
0052           p_pre(j,:) = getfield(pp,delta_par.name) + real(delta_par.value * exp(i*delta_par.omega*t_pre(j)));
0053           this_p   = setfield(pp,delta_par.name, p_pre(j,:));
0054           v_pre(j,:)   = feval(velocity_function,x_pre(j,:).',this_p).';
0055         <span class="keyword">end</span>
0056         
0057       <span class="keyword">case</span> <span class="string">'complex'</span>,
0058         [t_pre,x_pre] = ode15s(@<a href="#_sub3" class="code" title="subfunction x_dot = der_pert_complex(t,x,N,pp,velocity_function,delta_par)">der_pert_complex</a>,[ -T1, 0],x0,odeoptions1,N,pp,velocity_function,delta_par);
0059         <span class="keyword">for</span> j=1:size(t_pre),
0060           p_pre(j,:) = getfield(pp,delta_par.name) + delta_par.value*exp(i*delta_par.omega*t_pre(j));
0061           this_p   = setfield(pp,delta_par.name, p_pre(j,:));
0062           v_pre(j,:)   = feval(velocity_function,x_pre(j,:).',this_p).';
0063         <span class="keyword">end</span>
0064         
0065       <span class="keyword">case</span> <span class="string">'prescribed'</span>,
0066         [t_pre,x_pre] = ode15s(@<a href="#_sub4" class="code" title="subfunction x_dot = der_pert_prescribed(t,x,N,pp,velocity_function,delta_par)">der_pert_prescribed</a>,[ -T1, 0],x0,odeoptions1,N,pp,velocity_function,delta_par);
0067         <span class="keyword">for</span> j=1:size(t_pre),
0068           p_pre(j,:)  = feval(delta_par.parameter_function,t_pre(j),delta_par);
0069           this_p      = setfield(pp,delta_par.name, p_pre(j,:));
0070           v_pre(j,:)  = feval(velocity_function,x_pre(j,:).',this_p).';
0071         <span class="keyword">end</span>
0072     <span class="keyword">end</span>
0073     
0074   <span class="keyword">else</span>
0075     
0076     [t_pre,x_pre]  = ode15s(@<a href="#_sub1" class="code" title="subfunction x_dot = derivatives(t,x,N,pp,velocity_function)">derivatives</a>,T2,x0,odeoptions,N,pp,velocity_function);
0077     <span class="keyword">for</span> j=1:size(t_pre),
0078       v_pre(j,:)= feval(velocity_function,x_pre(j,:).',pp).';
0079     <span class="keyword">end</span>
0080   <span class="keyword">end</span>
0081   x_init = x_pre(<span class="keyword">end</span>,:);  
0082 <span class="keyword">else</span>
0083   t_pre  = [];
0084   x_pre  = [];
0085   v_pre  = [];
0086   p_pre  = [];
0087   x_init = x0;
0088 <span class="keyword">end</span>
0089 
0090 <span class="keyword">if</span> ~isempty(delta_par),
0091   
0092   <span class="keyword">switch</span> delta_par.type,
0093     
0094     <span class="keyword">case</span> <span class="string">'cos'</span>,        
0095       [t,x] = ode15s(@<a href="#_sub2" class="code" title="subfunction x_dot = der_pert_cos(t,x,N,pp,velocity_function,delta_par)">der_pert_cos</a>,T2,x_init,odeoptions2,N,pp,velocity_function,delta_par);
0096       <span class="keyword">for</span> j=1:size(t),
0097     p(j,:)   = getfield(pp,delta_par.name) + real(delta_par.value * exp(i*delta_par.omega*t(j)));
0098     this_p   = setfield(pp,delta_par.name, p(j,:));
0099     v(j,:)   = feval(velocity_function,x(j,:).',this_p).';
0100       <span class="keyword">end</span>
0101       
0102     <span class="keyword">case</span> <span class="string">'complex'</span>,    
0103       [t,x] = ode15s(@<a href="#_sub3" class="code" title="subfunction x_dot = der_pert_complex(t,x,N,pp,velocity_function,delta_par)">der_pert_complex</a>,T2,x_init,odeoptions2,N,pp,velocity_function,delta_par)
0104       <span class="keyword">for</span> j=1:size(t),
0105     p(j,:) = getfield(pp,delta_par.name) + delta_par.value*exp(i*delta_par.omega*t(j));
0106     this_p   = setfield(pp,delta_par.name, p(j,:));
0107     v(j,:)   = feval(velocity_function,x(j,:).',this_p).';
0108       <span class="keyword">end</span>
0109       
0110     <span class="keyword">case</span> <span class="string">'prescribed'</span>, 
0111       [t,x] = ode15s(@<a href="#_sub4" class="code" title="subfunction x_dot = der_pert_prescribed(t,x,N,pp,velocity_function,delta_par)">der_pert_prescribed</a>,T2,x_init,odeoptions2,N,pp,velocity_function,delta_par);
0112       <span class="keyword">for</span> j=1:size(t),
0113         p(j,:)   = feval(delta_par.parameter_function,t(j),delta_par);
0114     this_p   = setfield(pp,delta_par.name, p(j,:));
0115         v(j,:)   = feval(velocity_function,x(j,:).',this_p).';
0116       <span class="keyword">end</span>
0117       
0118   <span class="keyword">end</span>   
0119 <span class="keyword">else</span>,
0120   [t,x] = ode15s(@<a href="#_sub1" class="code" title="subfunction x_dot = derivatives(t,x,N,pp,velocity_function)">derivatives</a>, T2 , x_init, odeoptions, N, pp, velocity_function);
0121   <span class="keyword">for</span> j=1:size(t),
0122     v(j,:)= feval(velocity_function,x(j,:).',pp,t(j)).';
0123   <span class="keyword">end</span>
0124 <span class="keyword">end</span>
0125 
0126 
0127 <span class="comment">% --------------------------------------------------------------------</span>
0128 
0129 <a name="_sub1" href="#_subfunctions" class="code">function x_dot = derivatives(t,x,N,pp,velocity_function)</a>
0130 
0131 x_dot    = N * feval(velocity_function,x,pp,t);
0132 
0133 <span class="comment">% --------------------------------------------------------------------</span>
0134 
0135 <a name="_sub2" href="#_subfunctions" class="code">function x_dot = der_pert_cos(t,x,N,pp,velocity_function,delta_par)</a>
0136 
0137 delta_pt = real(delta_par.value*exp(i*delta_par.omega*t));
0138 this_p   = setfield(pp,delta_par.name,getfield(pp,delta_par.name) + delta_pt);
0139 x_dot    = N * feval(velocity_function,x,this_p,t);
0140 
0141 
0142 <span class="comment">% --------------------------------------------------------------------</span>
0143 
0144 <a name="_sub3" href="#_subfunctions" class="code">function x_dot = der_pert_complex(t,x,N,pp,velocity_function,delta_par)</a>
0145 
0146 delta_pt = delta_par.value*exp(i*delta_par.omega*t);
0147 this_p   = setfield(pp,delta_par.name,getfield(pp,delta_par.name) + delta_pt);
0148 x_dot    = N * feval(velocity_function,x,this_p,t);
0149 
0150 <span class="comment">% --------------------------------------------------------------------</span>
0151 
0152 <a name="_sub4" href="#_subfunctions" class="code">function x_dot = der_pert_prescribed(t,x,N,pp,velocity_function,delta_par)</a>
0153 
0154 pt       = feval(delta_par.parameter_function,t,delta_par);
0155 this_p   = setfield(pp,delta_par.name, pt);
0156 x_dot    = N * feval(velocity_function,x,this_p,t);</pre></div>
<hr><address>Generated on Wed 10-Apr-2013 10:42:33 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>