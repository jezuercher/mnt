<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of network_integrate_kin</title>
  <meta name="keywords" content="network_integrate_kin">
  <meta name="description" content="[t,x,v,t_pre,x_pre,p_p_pre] = network_integrate_kin(x0,pp,T1,T2,N,velocity_function,delta_par,external,volumes,verbose_flag)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">mnt</a> &gt; <a href="#">mnt_simulation</a> &gt; network_integrate_kin.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for ./mnt/mnt_simulation&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>network_integrate_kin
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>[t,x,v,t_pre,x_pre,p_p_pre] = network_integrate_kin(x0,pp,T1,T2,N,velocity_function,delta_par,external,volumes,verbose_flag)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [t,x,v,t_pre,x_pre,p,p_pre] = network_integrate_kin(x0,pp,T1,T2,N,velocity_function,delta_par,external,volumes,verbose_flag) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">[t,x,v,t_pre,x_pre,p_p_pre] = network_integrate_kin(x0,pp,T1,T2,N,velocity_function,delta_par,external,volumes,verbose_flag)

 Time integration for metabolic systems with one oscillatory parameter
 Kinetics function is given by m-file and structure array of parameters

ARGUMENTS
 x0           initial concentrations (vector)
 p            parameters (structure array)
 T1, T2       integration times for tuning and simulation
 N            stoichiometric matrix
 velocity_function function handle to kinetics function
 delta_par    structure array describing the parameter perturbation
              (optional)
 volumes      compartment volumes assigned to internal metabolites (length = # int. metabolite) 

FIELDS OF delta_par: 
 type (optional)  'complex', 'cos'
 omega            circular frequency
 name             parameter name
 value            amplitude of oscillation

For extracting a single oscillation period, see 'choose_period'</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../.././mnt/utils/default.html" class="code" title="function commandstring = default(varargin)">default</a>	commandstring = default(varname1,defaultvalue1,varname2,defaultvalue2,...)</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="network_integrate.html" class="code" title="function [t, s_t, s_int_t, met_int,v,x_assign] = network_integrate(network, s_init, T, graphics_flag, verbose_flag, Tmax,dilution_rate,ode_opt)">network_integrate</a>	[t, s, s_int, met_int,v,x_assign] = network_integrate(network, s_init, T, graphics_flag, verbose_flag,Tmax,dilution_rate,ode_opt)</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function x_dot = derivatives(t,x,N,pp,velocity_function)</a></li><li><a href="#_sub2" class="code">function x_dot = der_pert_cos(t,x,N,pp,velocity_function,delta_par)</a></li><li><a href="#_sub3" class="code">function x_dot = der_pert_complex(t,x,N,pp,velocity_function,delta_par)</a></li><li><a href="#_sub4" class="code">function x_dot = der_pert_prescribed(t,x,N,pp,velocity_function,delta_par)</a></li></ul>
<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%[t,x,v,t_pre,x_pre,p_p_pre] = network_integrate_kin(x0,pp,T1,T2,N,velocity_function,delta_par,external,volumes,verbose_flag)</span>
0002 <span class="comment">%</span>
0003 <span class="comment">% Time integration for metabolic systems with one oscillatory parameter</span>
0004 <span class="comment">% Kinetics function is given by m-file and structure array of parameters</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%ARGUMENTS</span>
0007 <span class="comment">% x0           initial concentrations (vector)</span>
0008 <span class="comment">% p            parameters (structure array)</span>
0009 <span class="comment">% T1, T2       integration times for tuning and simulation</span>
0010 <span class="comment">% N            stoichiometric matrix</span>
0011 <span class="comment">% velocity_function function handle to kinetics function</span>
0012 <span class="comment">% delta_par    structure array describing the parameter perturbation</span>
0013 <span class="comment">%              (optional)</span>
0014 <span class="comment">% volumes      compartment volumes assigned to internal metabolites (length = # int. metabolite)</span>
0015 <span class="comment">%</span>
0016 <span class="comment">%FIELDS OF delta_par:</span>
0017 <span class="comment">% type (optional)  'complex', 'cos'</span>
0018 <span class="comment">% omega            circular frequency</span>
0019 <span class="comment">% name             parameter name</span>
0020 <span class="comment">% value            amplitude of oscillation</span>
0021 <span class="comment">%</span>
0022 <span class="comment">%For extracting a single oscillation period, see 'choose_period'</span>
0023 
0024 <a name="_sub0" href="#_subfunctions" class="code">function [t,x,v,t_pre,x_pre,p,p_pre] = network_integrate_kin(x0,pp,T1,T2,N,velocity_function,delta_par,external,volumes,verbose_flag)</a>
0025 
0026 eval(<a href="../.././mnt/utils/default.html" class="code" title="function commandstring = default(varargin)">default</a>(<span class="string">'external'</span>,<span class="string">'[]'</span>,<span class="string">'delta_par'</span>,<span class="string">'[]'</span>,<span class="string">'volumes'</span>,<span class="string">'[]'</span>));
0027 
0028 odeoptions = odeset(<span class="string">'NonNegative'</span>,1:length(x0),<span class="string">'RelTol'</span>, 1e-6);
0029 
0030 <span class="keyword">if</span> length(T2) == 1, display(<span class="string">'Using 100 time integration steps'</span>); T2 = 0:T2/100:T2; <span class="keyword">end</span>
0031 
0032 N(find(external),:) = 0;
0033 
0034 <span class="keyword">if</span> length(volumes),
0035   <span class="keyword">if</span> verbose_flag, display(<span class="string">'Dynamic simulation: Using given compartment volumes = 1'</span>); <span class="keyword">end</span>
0036   N(find(external==0),:) = diag(volumes) * N(find(external==0),:);
0037 <span class="keyword">else</span>,
0038   <span class="keyword">if</span> verbose_flag,   display(<span class="string">'Dynamic simulation: Assuming compartment volumes = 1'</span>); <span class="keyword">end</span>
0039 <span class="keyword">end</span>
0040 
0041 
0042 <span class="comment">% --------------------------------------------------------------------</span>
0043 
0044 <span class="keyword">if</span> ~isempty(delta_par),
0045   <span class="keyword">if</span> delta_par.omega~=0,
0046     odeoptions1=odeset(<span class="string">'MaxStep'</span>,2*pi/delta_par.omega/10,<span class="string">'NonNegative'</span>,ones(size(x0)));
0047     odeoptions2=odeset(<span class="string">'MaxStep'</span>,2*pi/delta_par.omega/100,<span class="string">'NonNegative'</span>,ones(size(x0)));
0048   <span class="keyword">end</span>
0049   <span class="keyword">if</span> ~isfield(delta_par,<span class="string">'type'</span>), delta_par.type=<span class="string">'complex'</span>; <span class="keyword">end</span>
0050 <span class="keyword">end</span>
0051 
0052 <span class="comment">% --------------------------------------------------------------------</span>
0053 
0054 <span class="keyword">if</span> T1 &gt; 0, 
0055   <span class="keyword">if</span> ~isempty(delta_par),
0056     <span class="keyword">switch</span> delta_par.type,
0057       
0058       <span class="keyword">case</span> <span class="string">'cos'</span>,
0059         [t_pre,x_pre] = ode15s(@<a href="#_sub2" class="code" title="subfunction x_dot = der_pert_cos(t,x,N,pp,velocity_function,delta_par)">der_pert_cos</a>,[ -T1, 0],x0,odeoptions1,N,pp,velocity_function,delta_par);
0060         <span class="keyword">for</span> j=1:size(t_pre),
0061           p_pre(j,:) = getfield(pp,delta_par.name) + real(delta_par.value * exp(i*delta_par.omega*t_pre(j)));
0062           this_p   = setfield(pp,delta_par.name, p_pre(j,:));
0063           v_pre(j,:)   = feval(velocity_function,x_pre(j,:).',this_p).';
0064         <span class="keyword">end</span>
0065         
0066       <span class="keyword">case</span> <span class="string">'complex'</span>,
0067         [t_pre,x_pre] = ode15s(@<a href="#_sub3" class="code" title="subfunction x_dot = der_pert_complex(t,x,N,pp,velocity_function,delta_par)">der_pert_complex</a>,[ -T1, 0],x0,odeoptions1,N,pp,velocity_function,delta_par);
0068         <span class="keyword">for</span> j=1:size(t_pre),
0069           p_pre(j,:) = getfield(pp,delta_par.name) + delta_par.value*exp(i*delta_par.omega*t_pre(j));
0070           this_p   = setfield(pp,delta_par.name, p_pre(j,:));
0071           v_pre(j,:)   = feval(velocity_function,x_pre(j,:).',this_p).';
0072         <span class="keyword">end</span>
0073         
0074       <span class="keyword">case</span> <span class="string">'prescribed'</span>,
0075         [t_pre,x_pre] = ode15s(@<a href="#_sub4" class="code" title="subfunction x_dot = der_pert_prescribed(t,x,N,pp,velocity_function,delta_par)">der_pert_prescribed</a>,[ -T1, 0],x0,odeoptions1,N,pp,velocity_function,delta_par);
0076         <span class="keyword">for</span> j=1:size(t_pre),
0077           p_pre(j,:)  = feval(delta_par.parameter_function,t_pre(j),delta_par);
0078           this_p      = setfield(pp,delta_par.name, p_pre(j,:));
0079           v_pre(j,:)  = feval(velocity_function,x_pre(j,:).',this_p).';
0080         <span class="keyword">end</span>
0081     <span class="keyword">end</span>
0082     
0083   <span class="keyword">else</span>
0084 
0085     [t_pre,x_pre]  = ode15s(@<a href="#_sub1" class="code" title="subfunction x_dot = derivatives(t,x,N,pp,velocity_function)">derivatives</a>,T2,x0,odeoptions,N,pp,velocity_function);
0086 
0087     <span class="keyword">for</span> j=1:size(t_pre),
0088       v_pre(j,:)= feval(velocity_function,x_pre(j,:).',pp).';
0089     <span class="keyword">end</span>
0090   
0091   <span class="keyword">end</span>
0092   x_init = x_pre(<span class="keyword">end</span>,:);  
0093 <span class="keyword">else</span>
0094   t_pre  = [];
0095   x_pre  = [];
0096   v_pre  = [];
0097   p_pre  = [];
0098   x_init = x0;
0099 <span class="keyword">end</span>
0100 
0101 <span class="keyword">if</span> ~isempty(delta_par),
0102   
0103   <span class="keyword">switch</span> delta_par.type,
0104     
0105     <span class="keyword">case</span> <span class="string">'cos'</span>,        
0106       [t,x] = ode15s(@<a href="#_sub2" class="code" title="subfunction x_dot = der_pert_cos(t,x,N,pp,velocity_function,delta_par)">der_pert_cos</a>,T2,x_init,odeoptions2,N,pp,velocity_function,delta_par);
0107       <span class="keyword">for</span> j=1:size(t),
0108     p(j,:)   = getfield(pp,delta_par.name) + real(delta_par.value * exp(i*delta_par.omega*t(j)));
0109     this_p   = setfield(pp,delta_par.name, p(j,:));
0110     v(j,:)   = feval(velocity_function,x(j,:).',this_p).';
0111       <span class="keyword">end</span>
0112       
0113     <span class="keyword">case</span> <span class="string">'complex'</span>,    
0114       [t,x] = ode15s(@<a href="#_sub3" class="code" title="subfunction x_dot = der_pert_complex(t,x,N,pp,velocity_function,delta_par)">der_pert_complex</a>,T2,x_init,odeoptions2,N,pp,velocity_function,delta_par)
0115       <span class="keyword">for</span> j=1:size(t),
0116     p(j,:) = getfield(pp,delta_par.name) + delta_par.value*exp(i*delta_par.omega*t(j));
0117     this_p   = setfield(pp,delta_par.name, p(j,:));
0118     v(j,:)   = feval(velocity_function,x(j,:).',this_p).';
0119       <span class="keyword">end</span>
0120       
0121     <span class="keyword">case</span> <span class="string">'prescribed'</span>, 
0122       [t,x] = ode15s(@<a href="#_sub4" class="code" title="subfunction x_dot = der_pert_prescribed(t,x,N,pp,velocity_function,delta_par)">der_pert_prescribed</a>,T2,x_init,odeoptions2,N,pp,velocity_function,delta_par);
0123       <span class="keyword">for</span> j=1:size(t),
0124         p(j,:)   = feval(delta_par.parameter_function,t(j),delta_par);
0125     this_p   = setfield(pp,delta_par.name, p(j,:));
0126         v(j,:)   = feval(velocity_function,x(j,:).',this_p).';
0127       <span class="keyword">end</span>
0128       
0129   <span class="keyword">end</span>   
0130 <span class="keyword">else</span>,
0131   [t,x] = ode15s(@<a href="#_sub1" class="code" title="subfunction x_dot = derivatives(t,x,N,pp,velocity_function)">derivatives</a>, T2 , x_init, odeoptions, N, pp, velocity_function);
0132   <span class="keyword">for</span> j=1:size(t),
0133     v(j,:)= feval(velocity_function,x(j,:).',pp,t(j)).';
0134   <span class="keyword">end</span>
0135 <span class="keyword">end</span>
0136 
0137 
0138 <span class="comment">% --------------------------------------------------------------------</span>
0139 
0140 <a name="_sub1" href="#_subfunctions" class="code">function x_dot = derivatives(t,x,N,pp,velocity_function)</a>
0141 
0142 x_dot    = N * feval(velocity_function,x,pp,t);
0143 
0144 <span class="comment">% --------------------------------------------------------------------</span>
0145 
0146 <a name="_sub2" href="#_subfunctions" class="code">function x_dot = der_pert_cos(t,x,N,pp,velocity_function,delta_par)</a>
0147 
0148 delta_pt = real(delta_par.value*exp(i*delta_par.omega*t));
0149 this_p   = setfield(pp,delta_par.name,getfield(pp,delta_par.name) + delta_pt);
0150 x_dot    = N * feval(velocity_function,x,this_p,t);
0151 
0152 
0153 <span class="comment">% --------------------------------------------------------------------</span>
0154 
0155 <a name="_sub3" href="#_subfunctions" class="code">function x_dot = der_pert_complex(t,x,N,pp,velocity_function,delta_par)</a>
0156 
0157 delta_pt = delta_par.value*exp(i*delta_par.omega*t);
0158 this_p   = setfield(pp,delta_par.name,getfield(pp,delta_par.name) + delta_pt);
0159 x_dot    = N * feval(velocity_function,x,this_p,t);
0160 
0161 <span class="comment">% --------------------------------------------------------------------</span>
0162 
0163 <a name="_sub4" href="#_subfunctions" class="code">function x_dot = der_pert_prescribed(t,x,N,pp,velocity_function,delta_par)</a>
0164 
0165 pt       = feval(delta_par.parameter_function,t,delta_par);
0166 this_p   = setfield(pp,delta_par.name, pt);
0167 x_dot    = N * feval(velocity_function,x,this_p,t);</pre></div>
<hr><address>Generated on Sat 15-Nov-2014 18:05:26 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>