<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of xml2mat</title>
  <meta name="keywords" content="xml2mat">
  <meta name="description" content="XML2MAT converts XML string into matlab structure variable">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../index.html">Home</a> &gt;  <a href="#">mnt</a> &gt; <a href="../../index.html">util</a> &gt; <a href="../index.html">xml</a> &gt; <a href="index.html">XML4MAT</a> &gt; xml2mat.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../index.html"><img alt="<" border="0" src="../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for mnt/util/xml/XML4MAT&nbsp;<img alt=">" border="0" src="../../../../right.png"></a></td></tr></table>-->

<h1>xml2mat
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>XML2MAT converts XML string into matlab structure variable</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function [MAT,VARNAME,tag_contents]=xml2mat(XML) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">XML2MAT converts XML string into matlab structure variable
Syntax: [MAT,VARNAME,tag_contents]=xml2mat(XML)
Description
 XML is an XML formated string using rules compliant with
     the proceedure implemented in MAT2XML.
     It can also be a file name with MbML text.
 VARNAME is the variable name.
     If recovering the MAT variable with the original name is desired than
     the followinf line will do the trick:

          [MAT,VARNAME]=xml2mat(XML);eval([VARNAME,'=MAT'])

 See Also: <a href="mat2xml.html" class="code" title="function XML=mat2xml(MAT,VARNAME)">mat2xml</a>
 Jonas Almeida, 20 Aug 2002, XML4MAT Tbox</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="file2str.html" class="code" title="function y=file2str(x)">file2str</a>	FILE2STR reads textfile intoa single long string</li><li><a href="spcharout.html" class="code" title="function y=spcharout(x)">spcharout</a>	SPCHAROUT replaces special character codes by their values</li><li><a href="tag2eval.html" class="code" title="function [to_eval,eval_i,j]=tag2eval(tag_contents,to_eval,eval_i,j,tags)">tag2eval</a>	TAG2EVAL Extacts statements for evaluation by XML2MAT</li><li><a href="xml2whos.html" class="code" title="function w=xml2whos(w_xml)">xml2whos</a>	XML2WHOS identifies WHOS-type structured variable from xml descriptor</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="xml2cell.html" class="code" title="function [y,varname]=xml2cell(filename_or_xml_string,plt)">xml2cell</a>	XML2CELL reads non-MbML compliant xmlfile into matlab nested cell arrays</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [MAT,VARNAME,tag_contents]=xml2mat(XML)</a>
0002 
0003 <span class="comment">%XML2MAT converts XML string into matlab structure variable</span>
0004 <span class="comment">%Syntax: [MAT,VARNAME,tag_contents]=xml2mat(XML)</span>
0005 <span class="comment">%Description</span>
0006 <span class="comment">% XML is an XML formated string using rules compliant with</span>
0007 <span class="comment">%     the proceedure implemented in MAT2XML.</span>
0008 <span class="comment">%     It can also be a file name with MbML text.</span>
0009 <span class="comment">% VARNAME is the variable name.</span>
0010 <span class="comment">%     If recovering the MAT variable with the original name is desired than</span>
0011 <span class="comment">%     the followinf line will do the trick:</span>
0012 <span class="comment">%</span>
0013 <span class="comment">%          [MAT,VARNAME]=xml2mat(XML);eval([VARNAME,'=MAT'])</span>
0014 <span class="comment">%</span>
0015 <span class="comment">% See Also: mat2xml</span>
0016 <span class="comment">% Jonas Almeida, 20 Aug 2002, XML4MAT Tbox</span>
0017 
0018 
0019 <span class="keyword">if</span> strncmp(XML,<span class="string">'%60;'</span>,4)  <span class="comment">% XML provided as encoded XML string</span>
0020     XML=<a href="spcharout.html" class="code" title="function y=spcharout(x)">spcharout</a>(XML);
0021 <span class="keyword">end</span>
0022 
0023 <span class="comment">% is this a xml string or xml filename ?</span>
0024 <span class="keyword">if</span> XML(1)~=<span class="string">'&lt;'</span> 
0025     XML=strrep(<a href="file2str.html" class="code" title="function y=file2str(x)">file2str</a>(XML),<span class="string">''''</span>,<span class="string">''''''</span>);
0026     <span class="comment">% Remove non-content lines if they exist</span>
0027     XML=regexprep(XML,<span class="string">'&lt;[?!].*?&gt;'</span>,<span class="string">''</span>);
0028 <span class="keyword">end</span>
0029 
0030 <span class="comment">%Analise XML line</span>
0031 tag_ini=find(XML==<span class="string">'&lt;'</span>);
0032 tag_end=find(XML==<span class="string">'&gt;'</span>);
0033 n=length(tag_ini); <span class="comment">% number of enclosed tag structures</span>
0034 
0035 <span class="comment">% extract tag_names properties and contents</span>
0036 <span class="keyword">if</span> n&gt;0
0037 <span class="keyword">for</span> i=1:n
0038     tag_close(i)=(XML(tag_ini(i)+1)==<span class="string">'/'</span>); <span class="comment">% 1 for closing contents and 0 for opening</span>
0039     tag_contents{i,1}=XML(tag_ini(i)+1+tag_close(i):tag_end(i)-1);  <span class="comment">% first column contains names</span>
0040 <span class="keyword">end</span>
0041 tag_path=[0]; <span class="comment">% first name is root name</span>
0042 to_do=zeros(n,1); <span class="comment">% 1 needs doing</span>
0043 to_do(1)=1;
0044 tag_open=~tag_close;
0045 i=1;tag_contents{i,2}=<a href="xml2whos.html" class="code" title="function w=xml2whos(w_xml)">xml2whos</a>(tag_contents{i,1});tag_contents{i,2}.fields=[];tag_contents{i,3}=tag_path;tag_path=[tag_path,i];
0046 <span class="keyword">for</span> i=2:n
0047     tag_contents{i,2}=<a href="xml2whos.html" class="code" title="function w=xml2whos(w_xml)">xml2whos</a>(tag_contents{i,1});tag_contents{i,2}.fields=[]; <span class="comment">% second column contains WHO properties</span>
0048     <span class="keyword">if</span> tag_open(i)
0049         tag_contents{i,3}=tag_path;  <span class="comment">% third column contains structre path</span>
0050         tag_path=[tag_path,i];
0051         to_do(i)=1; <span class="comment">% do this one</span>
0052         to_do(tag_contents{i,3}+(tag_contents{i,3}==0))=0; <span class="comment">% do host later</span>
0053         tag_contents{tag_path(end-1),2}.fields=[tag_contents{tag_path(end-1),2}.fields,i];
0054     <span class="keyword">else</span>
0055         tag_path(end)=[]; <span class="comment">% move back one level</span>
0056     <span class="keyword">end</span>  
0057 <span class="keyword">end</span>
0058 
0059 <span class="comment">% RECOVER DATA</span>
0060 todo_list=find(to_do==1)';do_i=1;
0061 <span class="keyword">while</span> do_i&lt;=length(todo_list);
0062     i=todo_list(do_i);
0063     <span class="comment">% for each case extract value</span>
0064     tag_contents{i,4}=XML(tag_end(i)+1:tag_ini(i+1)-1);  <span class="comment">% 4th column contains value as string</span>
0065     w=tag_contents{i,2};
0066     <span class="comment">% recover number format if appropriated</span>
0067     <span class="keyword">if</span> ~isfield(w,<span class="string">'class'</span>)
0068         w.class=<span class="string">'char'</span>;
0069         tag_contents{i,4}=<a href="spcharout.html" class="code" title="function y=spcharout(x)">spcharout</a>(tag_contents{i,4});
0070         w.size=size(tag_contents{i,4}); <span class="comment">%correct size tag as well</span>
0071         <span class="comment">%tag_contents{i,2}=w;</span>
0072     <span class="keyword">elseif</span> strcmp(w.class,<span class="string">'char'</span>)
0073         tag_contents{i,4}=<a href="spcharout.html" class="code" title="function y=spcharout(x)">spcharout</a>(tag_contents{i,4});
0074         w.size=size(tag_contents{i,4}); <span class="comment">%correct size tag as well</span>
0075         <span class="comment">%tag_contents{i,2}=w;</span>
0076     <span class="keyword">elseif</span> strcmp(w.class,<span class="string">'double'</span>)
0077         tag_contents{i,4}=str2num(tag_contents{i,4});
0078         <span class="keyword">if</span> ~isfield(w,<span class="string">'size'</span>);
0079             w.size=size(tag_contents{i,4});
0080         <span class="keyword">end</span>
0081     <span class="keyword">elseif</span> strcmp(w.class,<span class="string">'struct'</span>)&amp;(~isfield(w,<span class="string">'size'</span>))
0082         n_fields=length(w.fields);
0083         <span class="keyword">for</span> i=1:n_fields
0084             field_names{i}=tag_contents{w.fields(i),2}.name;
0085         <span class="keyword">end</span>
0086         unique_names=unique(field_names);
0087         n_unique=length(unique_names);
0088         n_certo=(n_fields/n_unique);
0089         w.size=[1 n_certo];
0090     <span class="keyword">end</span>
0091     tag_contents{i,2}=w;
0092     <span class="keyword">if</span> (length(w.size&gt;2)|(w.size(1)&gt;1))
0093         iis=<span class="string">'i1'</span>;<span class="keyword">for</span> ii=2:length(w.size);iis=[iis,<span class="string">',i'</span>,num2str(ii)];<span class="keyword">end</span>
0094         nn=prod(w.size); <span class="comment">%number of elements</span>
0095         eval([<span class="string">'['</span>,iis,<span class="string">']=ind2sub(w.size,[1:nn]);'</span>]); <span class="comment">% generation of indexes</span>
0096         iis=<span class="string">'i1(ind)'</span>;<span class="keyword">for</span> ii=2:length(w.size);iis=[iis,<span class="string">',i'</span>,num2str(ii),<span class="string">'(ind)'</span>];<span class="keyword">end</span> <span class="comment">% indexes of indexes</span>
0097         <span class="keyword">for</span> ind=1:nn
0098             eval([<span class="string">'valor('</span>,iis,<span class="string">')=tag_contents{i,4}(ind);'</span>])            
0099         <span class="keyword">end</span>        
0100         <span class="keyword">if</span> exist(<span class="string">'valor'</span>)==1;tag_contents{i,4}=valor;clear valor;<span class="keyword">end</span>
0101     <span class="keyword">end</span>
0102     do_i=do_i+1;
0103 <span class="keyword">end</span>
0104 
0105 <span class="comment">% RECOVER STRUCTURE</span>
0106 j=1;tags=find(tag_open);
0107 eval_i={<span class="string">'MAT'</span>};to_eval={};
0108 <span class="keyword">while</span> j&lt;=length(tags)
0109     i=tags(j);
0110     [to_eval,eval_i,j]=<a href="tag2eval.html" class="code" title="function [to_eval,eval_i,j]=tag2eval(tag_contents,to_eval,eval_i,j,tags)">tag2eval</a>(tag_contents,to_eval,eval_i,j,tags);
0111     <span class="comment">%w=tag_contents{i,2}</span>
0112     j=j+1;
0113 <span class="keyword">end</span>
0114 
0115 <span class="keyword">for</span> i=1:length(to_eval)
0116     <span class="comment">%disp(to_eval{i})</span>
0117     eval(to_eval{i})
0118 <span class="keyword">end</span>
0119 
0120 <span class="comment">%MAT.tag_contents=tag_contents;</span>
0121 VARNAME=tag_contents{1,2}.name;
0122 <span class="keyword">else</span>
0123     MAT=XML;
0124     VARNAME=[];
0125     tag_contents=[];
0126 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Fri 05-Apr-2013 15:19:47 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>