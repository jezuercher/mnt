<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of response_coefficients_target_numerical</title>
  <meta name="keywords" content="response_coefficients_target_numerical">
  <meta name="description" content="[RZp,RZpp] = response_coefficients_target_numerical(network,c,ind_rel_par,zc,zv)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">mnt</a> &gt; <a href="#">mnt_mca</a> &gt; response_coefficients_target_numerical.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for ./mnt/mnt_mca&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>response_coefficients_target_numerical
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>[RZp,RZpp] = response_coefficients_target_numerical(network,c,ind_rel_par,zc,zv)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [RZp,RZpp] = response_coefficients_target_numerical(network,c,ind_rel_par,zc,zv) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">[RZp,RZpp] = response_coefficients_target_numerical(network,c,ind_rel_par,zc,zv)

 Unscaled response coefficients for a target function z (first and second order)

 The target z must be a linear function of the stationary concentrations and fluxes
 ON NON-LOGARITHMIC SCALE

 network    : network with kinetic information in field 'kinetics'
 c          : starting point for computing steady-state concnetrations
 ind_rel_par: indices of parameters to be considered
 zc,zv      : vectors defining the target function z as a linear function of c and v (stationary)

 The calculation is done like in response_coefficients_numerical</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../.././mnt/mnt_kinetics/kinetics/parameters2vector.html" class="code" title="function [vector,names,relevant,relevant_reactions,types] = parameters2vector(kinetics,S_ext,S_ext_names,network,split,no_names)">parameters2vector</a>	[vector,names,relevant,relevant_reactions,types] = parameters2vector(kinetics,S_ext,S_ext_names,network,split,no_names)</li><li><a href="../.././mnt/mnt_kinetics/kinetics/vector2parameters.html" class="code" title="function [kinetics,S_ext] = vector2parameters(kinetics,vector,external_ind,network)">vector2parameters</a>	[kinetics,S_ext] = vector2parameters(kinetics,vector,external_ind,network)</li><li><a href="../.././mnt/mnt_simulation/network_steady_state.html" class="code" title="function  [S, J, Sdot, error,L_int,NR_int,indep_met_int] = network_steady_state(network,s,integrate_time,L_int,NR_int,indep_met_int,dilution_rate)">network_steady_state</a>	[S, J, Sdot, error] = network_steady_state(network,s,integrate_time,L_int,NR_int,indep_met_int,dilution_rate)</li><li><a href="../.././mnt/utils/column.html" class="code" title="function x = column(x)">column</a>	transform a vector (row or column) into a column vector</li><li><a href="../.././mnt/utils/default.html" class="code" title="function commandstring = default(varargin)">default</a>	commandstring = default(varname1,defaultvalue1,varname2,defaultvalue2,...)</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%[RZp,RZpp] = response_coefficients_target_numerical(network,c,ind_rel_par,zc,zv)</span>
0002 <span class="comment">%</span>
0003 <span class="comment">% Unscaled response coefficients for a target function z (first and second order)</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% The target z must be a linear function of the stationary concentrations and fluxes</span>
0006 <span class="comment">% ON NON-LOGARITHMIC SCALE</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% network    : network with kinetic information in field 'kinetics'</span>
0009 <span class="comment">% c          : starting point for computing steady-state concnetrations</span>
0010 <span class="comment">% ind_rel_par: indices of parameters to be considered</span>
0011 <span class="comment">% zc,zv      : vectors defining the target function z as a linear function of c and v (stationary)</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% The calculation is done like in response_coefficients_numerical</span>
0014 
0015 <a name="_sub0" href="#_subfunctions" class="code">function [RZp,RZpp] = response_coefficients_target_numerical(network,c,ind_rel_par,zc,zv)</a>
0016 
0017 zc = <a href="../.././mnt/utils/column.html" class="code" title="function x = column(x)">column</a>(zc);
0018 zv = <a href="../.././mnt/utils/column.html" class="code" title="function x = column(x)">column</a>(zv);
0019 
0020 kinetics     = network.kinetics;
0021 [nm,nr]      = size(network.N);
0022 ind_ext      = find(network.external);
0023 n_ext        = length(ind_ext);
0024 delta        = 10^-5;
0025 T            = 10000;
0026 
0027 <span class="comment">%v = network_velocities(c,network);</span>
0028 [s,v,dum1,dum2,L_int,NR_int,indep_met_int] = <a href="../.././mnt/mnt_simulation/network_steady_state.html" class="code" title="function  [S, J, Sdot, error,L_int,NR_int,indep_met_int] = network_steady_state(network,s,integrate_time,L_int,NR_int,indep_met_int,dilution_rate)">network_steady_state</a>(network,c,T);
0029 c           = s;
0030 
0031 S_ext       = c(ind_ext);
0032 S_ext_names = network.metabolites(ind_ext);
0033 par         = <a href="../.././mnt/mnt_kinetics/kinetics/parameters2vector.html" class="code" title="function [vector,names,relevant,relevant_reactions,types] = parameters2vector(kinetics,S_ext,S_ext_names,network,split,no_names)">parameters2vector</a>(kinetics,S_ext,S_ext_names,network);
0034 
0035 eval(<a href="../.././mnt/utils/default.html" class="code" title="function commandstring = default(varargin)">default</a>(<span class="string">'ind_rel_par'</span>,<span class="string">'1:length(par)'</span>));
0036 
0037 np          = length(ind_rel_par);
0038 
0039 
0040 <span class="comment">% ------------------------------------------------------------------------------</span>
0041 <span class="comment">% first-order response coefficients and</span>
0042 <span class="comment">% diagonal elements for second order response coefficients</span>
0043 
0044 RS = nan * zeros(nm,np);
0045 RJ = nan * zeros(nr,np);
0046 
0047 RZp       = nan * zeros(1,np);
0048 RZpp      = nan * zeros(1,np,np);
0049 RTpp_diag = nan * zeros(1,np);  <span class="comment">%  diagonal elements from RZpp</span>
0050 
0051 network1 = network;
0052 network2 = network;
0053 
0054 nc = length(c);
0055 nv = length(v);  
0056 
0057 <span class="keyword">for</span> itt=1:np,
0058   it = ind_rel_par(itt);
0059   display(sprintf(<span class="string">'%d/%d'</span>,itt,np));
0060 
0061   par_pert1  = par; par_pert1(it) = par(it)*(1+delta);
0062   par_pert2  = par; par_pert2(it) = par(it)*(1-delta);
0063   <span class="keyword">if</span> par_pert1(it) == 0, par_pert(it) =  10^-8; <span class="keyword">end</span>
0064   <span class="keyword">if</span> par_pert2(it) == 0, par_pert(it) = -10^-8; <span class="keyword">end</span>
0065 
0066   [nkinetics1, Sext_pert1] = <a href="../.././mnt/mnt_kinetics/kinetics/vector2parameters.html" class="code" title="function [kinetics,S_ext] = vector2parameters(kinetics,vector,external_ind,network)">vector2parameters</a>(kinetics,par_pert1,ind_ext,network);
0067   [nkinetics2, Sext_pert2] = <a href="../.././mnt/mnt_kinetics/kinetics/vector2parameters.html" class="code" title="function [kinetics,S_ext] = vector2parameters(kinetics,vector,external_ind,network)">vector2parameters</a>(kinetics,par_pert2,ind_ext,network);
0068   s_pert1  = c;
0069   s_pert2  = c;
0070   s_pert1(ind_ext) = Sext_pert1;
0071   s_pert2(ind_ext) = Sext_pert2;
0072   network1.kinetics = nkinetics1;
0073   network2.kinetics = nkinetics2;
0074   [s_pert1, v_pert1] = <a href="../.././mnt/mnt_simulation/network_steady_state.html" class="code" title="function  [S, J, Sdot, error,L_int,NR_int,indep_met_int] = network_steady_state(network,s,integrate_time,L_int,NR_int,indep_met_int,dilution_rate)">network_steady_state</a>(network1,s_pert1,T,L_int,NR_int,indep_met_int);
0075   [s_pert2, v_pert2] = <a href="../.././mnt/mnt_simulation/network_steady_state.html" class="code" title="function  [S, J, Sdot, error,L_int,NR_int,indep_met_int] = network_steady_state(network,s,integrate_time,L_int,NR_int,indep_met_int,dilution_rate)">network_steady_state</a>(network2,s_pert2,T,L_int,NR_int,indep_met_int);
0076 
0077   delta_par_pert1 = par_pert1(it) - par(it);
0078   delta_par_pert2 = par_pert2(it )- par(it);
0079 
0080   As = [ s_pert1 - c; <span class="keyword">...</span>
0081          s_pert2 - c  ];
0082   
0083   Bs = [ delta_par_pert1 * eye(nc), 1/2 * delta_par_pert1.^2 * eye(nc); <span class="keyword">...</span>
0084          delta_par_pert2 * eye(nc), 1/2 * delta_par_pert2.^2 * eye(nc)];        
0085   
0086   my_RS_both = pinv(full(Bs)) * As;
0087   my_RS  = my_RS_both(1:nc);
0088   my_RS2 = my_RS_both(nc+1:end);
0089 
0090   Av = [ v_pert1 - v; <span class="keyword">...</span>
0091          v_pert2 - v  ];
0092   
0093   Bv = [ delta_par_pert1 * eye(nv), 1/2 * delta_par_pert1.^2 * eye(nv); <span class="keyword">...</span>
0094          delta_par_pert2 * eye(nv), 1/2 * delta_par_pert2.^2 * eye(nv)];        
0095 
0096   my_RJ_both = pinv(full(Bv)) * Av;
0097   my_RJ  = my_RJ_both(1:nv);
0098   my_RJ2 = my_RJ_both(nv+1:end);
0099 
0100   RS(:,it) = my_RS;
0101   RJ(:,it) = my_RJ;
0102   RS2diag(:,it) = my_RS2;
0103   RJ2diag(:,it) = my_RJ2;
0104 
0105   my_RZp  = zc' * my_RS  + zv' * my_RJ; 
0106   my_RZ2p = zc' * my_RS2 + zv' * my_RJ2; 
0107 
0108   RZp(:,it)     = my_RZp;
0109   RZpp_diag(it) = my_RZ2p;
0110   RZpp(1,it,it) = my_RZ2p;
0111 
0112 <span class="keyword">end</span>
0113 
0114 
0115 <span class="comment">% ------------------------------------------------------------------------------</span>
0116 <span class="comment">% second-order response coefficients, off-diagonal elements</span>
0117 <span class="comment">% compute the value twice: for two increased parameters and two decreased parameters</span>
0118 
0119 delta     = 10^-4;
0120 
0121 <span class="keyword">for</span> itt=1:np,
0122   <span class="keyword">for</span> kt=1:itt-1,
0123 
0124     display(sprintf(<span class="string">'%d/%d %d/%d'</span>,itt,np,kt,itt-1));
0125     it = ind_rel_par(itt);
0126     k  = ind_rel_par(kt);
0127 
0128     <span class="comment">%% -----------------------------------------</span>
0129     <span class="comment">%% both parameters increased</span>
0130     par_pert1     = par; 
0131     par_pert1(it) = par(it)*(1+delta); 
0132     par_pert1(k)  = par(k) *(1+delta);
0133     <span class="keyword">if</span> par_pert1(it)== 0, par_pert1(it) = 10^-5; <span class="keyword">end</span> 
0134     <span class="keyword">if</span> par_pert1(k) == 0, par_pert1(k)  = 10^-5; <span class="keyword">end</span>
0135     delta_par1    = par_pert1 - par;
0136 
0137     [nkinetics, Sext_pert] = <a href="../.././mnt/mnt_kinetics/kinetics/vector2parameters.html" class="code" title="function [kinetics,S_ext] = vector2parameters(kinetics,vector,external_ind,network)">vector2parameters</a>(kinetics,par_pert1,ind_ext,network);
0138     s_pert1            = c + RS * delta_par1(ind_rel_par) + 0. * RS2diag(:,it) * delta_par1(it)^2 + 0. * RS2diag(:,k) * delta_par1(k)^2; 
0139     s_pert1(ind_ext)   = Sext_pert;
0140     network1.kinetics = nkinetics;
0141     [s_pert1,v_pert1]   = <a href="../.././mnt/mnt_simulation/network_steady_state.html" class="code" title="function  [S, J, Sdot, error,L_int,NR_int,indep_met_int] = network_steady_state(network,s,integrate_time,L_int,NR_int,indep_met_int,dilution_rate)">network_steady_state</a>(network1,s_pert1,T,L_int,NR_int,indep_met_int);    
0142 
0143     my_RJ2_1 = [v_pert1 - v - RJ * delta_par1(ind_rel_par) <span class="keyword">...</span>
0144                 - 1/2 * RJ2diag(:,[it,k]) *  delta_par1([it,k]).^2] <span class="keyword">...</span>
0145         / prod(delta_par1([it,k]));
0146     
0147     my_RS2_1 = [s_pert1 - c - RS * delta_par1(ind_rel_par) <span class="keyword">...</span>
0148                 - 1/2 * RS2diag(:,[it,k]) * delta_par1([it,k]).^2] <span class="keyword">...</span>
0149         / prod(delta_par1([it,k]));
0150 
0151     <span class="comment">%% -----------------------------------------</span>
0152     <span class="comment">%% both parameters decreased</span>
0153 
0154     par_pert2     = par; 
0155     par_pert2(it) = par(it)*(1-delta); 
0156     par_pert2(k)  = par(k) *(1-delta);
0157     <span class="keyword">if</span> par_pert2(it)==0, par_pert2(it) = -10^-5; <span class="keyword">end</span> 
0158     <span class="keyword">if</span> par_pert2(k) ==0, par_pert2(k)  = -10^-5; <span class="keyword">end</span>
0159     delta_par2      = par_pert2 - par;
0160     [nkinetics, Sext_pert] = <a href="../.././mnt/mnt_kinetics/kinetics/vector2parameters.html" class="code" title="function [kinetics,S_ext] = vector2parameters(kinetics,vector,external_ind,network)">vector2parameters</a>(kinetics,par_pert2,ind_ext,network);
0161     s_pert2            = c + RS * delta_par2(ind_rel_par) + 0. * RS2diag(:,it) * delta_par2(it)^2 + 0. * RS2diag(:,k) * delta_par2(k)^2; 
0162     s_pert2(ind_ext)   = Sext_pert;
0163     network1.kinetics  = nkinetics;
0164     [s_pert2,v_pert2]  = <a href="../.././mnt/mnt_simulation/network_steady_state.html" class="code" title="function  [S, J, Sdot, error,L_int,NR_int,indep_met_int] = network_steady_state(network,s,integrate_time,L_int,NR_int,indep_met_int,dilution_rate)">network_steady_state</a>(network1,s_pert2,T,L_int,NR_int,indep_met_int);
0165 
0166     my_RS2_2 = [s_pert1 - c - RS * delta_par1(ind_rel_par) <span class="keyword">...</span>
0167                 - 1/2 * RS2diag(:,[it,k]) *  delta_par2([it,k]).^2] <span class="keyword">...</span>
0168         / prod(delta_par2([it,k]));
0169 
0170     my_RJ2_2 = [v_pert2 - v - RJ * delta_par2(ind_rel_par) <span class="keyword">...</span>
0171                 - 1/2 * RJ2diag(:,[it,k]) * delta_par2([it,k]).^2] <span class="keyword">...</span>
0172         / prod(delta_par2([it,k]));
0173 
0174     my_RS2 = 1/2 * [my_RS2_1 + my_RS2_2];
0175     my_RJ2 = 1/2 * [my_RJ2_1 + my_RJ2_2];
0176 
0177     my_RZpp = zc' * my_RS2 + zv' * my_RJ2;
0178 
0179     RZpp(1,k,it) = my_RZpp;
0180     RZpp(1,it,k) = my_RZpp;
0181  
0182   <span class="keyword">end</span>
0183 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Sat 15-Nov-2014 18:05:26 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>