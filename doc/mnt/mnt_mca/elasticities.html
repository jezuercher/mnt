<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of elasticities</title>
  <meta name="keywords" content="elasticities">
  <meta name="description" content="[Ec,Ep,parameters,Ecc,Ecp,Epp,p] = elasticities(network,s,options);">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">mnt</a> &gt; <a href="#">mnt_mca</a> &gt; elasticities.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for ./mnt/mnt_mca&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>elasticities
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>[Ec,Ep,parameters,Ecc,Ecp,Epp,p] = elasticities(network,s,options);</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [Ec,Ep,parameters,Ecc,Ecp,Epp,p] = elasticities(network,s,options); </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">[Ec,Ep,parameters,Ecc,Ecp,Epp,p] = elasticities(network,s,options);

 Numerical calculation of reaction elasticities

FUNCTION ARGUMENTS:
  network     network structure (type 'help network_structure')
  s           column vector of metabolite concentrations
  options     fields with default values:
    split:              0     flag (1: forward and backward directions are described separately)
    include_external:   1     flag
    delta_basic:        0.001
    only_enzyme_levels: 0     flag 
  split       

OUTPUT:
 Ec:        sparse matrix dv_i/ds_k of elasticties w.r.t. metabolites
 Ep:        sparse matrix dv_i/dp_m of elasticties w.r.t. parameters
 parameters list of parameter names
 Ecc:       tensor d^2v_i/(ds_k ds_l) of second elasticties w.r.t. metabolites
 Ecp:       tensor d^2v_i/(ds_k dp_m) of second elasticties w.r.t. metabolites and parameters  
 Epp:       tensor d^2v_i/(dp_m dP_n) of second elasticties w.r.t. parameters 
 p:         parameter vector
 
 The parameters comprise all kinetic parameters, followed by all external concentrations
 Note that therefore, they appear in both the epsilon and pi matrices!

 See also: 'numerical_elasticities'</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../.././mnt/mnt_kinetics/kinetics/network_velocities.html" class="code" title="function v = network_velocities(s, network, kinetics, split, indices,t)">network_velocities</a>	v = network_velocities(s,network,kinetics,split,indices,t)</li><li><a href="../.././mnt/mnt_kinetics/kinetics/parameters2vector.html" class="code" title="function [vector,names,relevant,relevant_reactions,types] = parameters2vector(kinetics,S_ext,S_ext_names,network,split,no_names)">parameters2vector</a>	[vector,names,relevant,relevant_reactions,types] = parameters2vector(kinetics,S_ext,S_ext_names,network,split,no_names)</li><li><a href="../.././mnt/mnt_kinetics/kinetics/vector2parameters.html" class="code" title="function [kinetics,S_ext] = vector2parameters(kinetics,vector,external_ind,network)">vector2parameters</a>	[kinetics,S_ext] = vector2parameters(kinetics,vector,external_ind,network)</li><li><a href="../.././mnt/utils/default.html" class="code" title="function commandstring = default(varargin)">default</a>	commandstring = default(varname1,defaultvalue1,varname2,defaultvalue2,...)</li><li><a href="../.././mnt/utils/join_struct.html" class="code" title="function c = join_struct(a,b)">join_struct</a>	c = join_struct(a,b)</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../.././demo/mnt_demo.html" class="code" title="">mnt_demo</a>	</li><li><a href="../.././mnt/mnt_kinetics/modular_rate_laws/test_modular_rate_law.html" class="code" title="function r = test_modular_rate_law(n,kinetics)">test_modular_rate_law</a>	r = test_moldular_rate_law(n,kinetics)</li><li><a href="basic_control_analysis.html" class="code" title="function R = basic_control_analysis(network,s,options)">basic_control_analysis</a>	R = basic_control_analysis(network,s,options)</li><li><a href="time_response_coefficients.html" class="code" title="function [t, s,RS,s_ind,RS_ind,parameters,parameter_names]= time_response_coefficients(network, s_init, t_final)">time_response_coefficients</a>	[t, s, RS, s_ind, RS_ind, parameters, par_names]= time_response_coefficients(network, s0, t_final)</li><li><a href="../.././mnt/mnt_network/network_build_edit/network_check_regulation_matrix.html" class="code" title="function network = network_check_regulation_matrix(network)">network_check_regulation_matrix</a>	network = network_check_regulation_matrix(network)</li></ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%[Ec,Ep,parameters,Ecc,Ecp,Epp,p] = elasticities(network,s,options);</span>
0002 <span class="comment">%</span>
0003 <span class="comment">% Numerical calculation of reaction elasticities</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%FUNCTION ARGUMENTS:</span>
0006 <span class="comment">%  network     network structure (type 'help network_structure')</span>
0007 <span class="comment">%  s           column vector of metabolite concentrations</span>
0008 <span class="comment">%  options     fields with default values:</span>
0009 <span class="comment">%    split:              0     flag (1: forward and backward directions are described separately)</span>
0010 <span class="comment">%    include_external:   1     flag</span>
0011 <span class="comment">%    delta_basic:        0.001</span>
0012 <span class="comment">%    only_enzyme_levels: 0     flag</span>
0013 <span class="comment">%  split</span>
0014 <span class="comment">%</span>
0015 <span class="comment">%OUTPUT:</span>
0016 <span class="comment">% Ec:        sparse matrix dv_i/ds_k of elasticties w.r.t. metabolites</span>
0017 <span class="comment">% Ep:        sparse matrix dv_i/dp_m of elasticties w.r.t. parameters</span>
0018 <span class="comment">% parameters list of parameter names</span>
0019 <span class="comment">% Ecc:       tensor d^2v_i/(ds_k ds_l) of second elasticties w.r.t. metabolites</span>
0020 <span class="comment">% Ecp:       tensor d^2v_i/(ds_k dp_m) of second elasticties w.r.t. metabolites and parameters</span>
0021 <span class="comment">% Epp:       tensor d^2v_i/(dp_m dP_n) of second elasticties w.r.t. parameters</span>
0022 <span class="comment">% p:         parameter vector</span>
0023 <span class="comment">%</span>
0024 <span class="comment">% The parameters comprise all kinetic parameters, followed by all external concentrations</span>
0025 <span class="comment">% Note that therefore, they appear in both the epsilon and pi matrices!</span>
0026 <span class="comment">%</span>
0027 <span class="comment">% See also: 'numerical_elasticities'</span>
0028 
0029 
0030 <a name="_sub0" href="#_subfunctions" class="code">function [Ec,Ep,parameters,Ecc,Ecp,Epp,p] = elasticities(network,s,options);</a>
0031 
0032 eval(<a href="../.././mnt/utils/default.html" class="code" title="function commandstring = default(varargin)">default</a>(<span class="string">'options'</span>,<span class="string">'struct'</span>));
0033 
0034 options_default = struct(<span class="string">'split'</span>,0,<span class="string">'include_external'</span>,1,<span class="string">'delta_basic'</span>,0.001,<span class="string">'only_enzyme_levels'</span>,0);
0035 options         = <a href="../.././mnt/utils/join_struct.html" class="code" title="function c = join_struct(a,b)">join_struct</a>(options_default,options);
0036 
0037 no_names     = (nargout&lt;3);
0038 compute_pi   = (nargout&gt;1);
0039 second_order = (nargout&gt;3);
0040 kinetics     = network.kinetics;
0041 [nm,nr]      = size(network.N);
0042 ind_ext      = find(network.external);
0043 n_ext        = length(ind_ext);
0044 nv           = nr;
0045 
0046 <span class="keyword">if</span> options.split, nv = 2*nr; <span class="keyword">end</span>
0047 
0048 delta = options.delta_basic;
0049 
0050 
0051 <span class="comment">% ------------------------------------------------------------------</span>
0052 <span class="comment">% first order metabolite elasticities</span>
0053 
0054 v           = <a href="../.././mnt/mnt_kinetics/kinetics/network_velocities.html" class="code" title="function v = network_velocities(s, network, kinetics, split, indices,t)">network_velocities</a>(s,network,kinetics,options.split);
0055 S_ext       = s(ind_ext);
0056 S_ext_names = network.metabolites(ind_ext);
0057 
0058 Ec = nan * zeros(nv,nm);
0059 
0060 
0061 <span class="comment">% -------------------------------------------------------------------</span>
0062 <span class="comment">% build matrices with perturbed concentrations</span>
0063 
0064 s_pert1_vec = s *(1+delta);
0065 s_pert1_vec(abs(s_pert1_vec) &lt; delta ) = delta;
0066 S_pert1 = repmat(s,1,nm); 
0067 S_pert1(find(eye(nm))) = s_pert1_vec;
0068 
0069 s_pert2_vec = s * (1-delta);
0070 s_pert2_vec(abs(s_pert2_vec) &lt; delta ) = delta/2;
0071 S_pert2 = repmat(s,1,nm); 
0072 S_pert2(find(eye(nm))) = s_pert2_vec;
0073 
0074 
0075 <span class="keyword">if</span> second_order,
0076 
0077   <span class="keyword">for</span> it=1:nm,
0078     v_pert1  = <a href="../.././mnt/mnt_kinetics/kinetics/network_velocities.html" class="code" title="function v = network_velocities(s, network, kinetics, split, indices,t)">network_velocities</a>(S_pert1(:,it),network,kinetics,options.split);
0079     v_pert2  = <a href="../.././mnt/mnt_kinetics/kinetics/network_velocities.html" class="code" title="function v = network_velocities(s, network, kinetics, split, indices,t)">network_velocities</a>(S_pert2(:,it),network,kinetics,options.split);
0080     M = [S_pert1(it,it)-s(it), 0.5 * (S_pert1(it,it)-s(it))^2;<span class="keyword">...</span>
0081          S_pert2(it,it)-s(it), 0.5 * (S_pert2(it,it)-s(it))^2];
0082     this_Ec  = inv(M)* [v_pert1 - v, v_pert2 - v]';
0083     Ec(:,it) = this_Ec(1,:)';
0084     Ecc(:,it,it) = this_Ec(2,:)';
0085   <span class="keyword">end</span>
0086   
0087 <span class="keyword">else</span>,
0088   
0089   <span class="keyword">for</span> it=1:nm,
0090     v_pert1  = <a href="../.././mnt/mnt_kinetics/kinetics/network_velocities.html" class="code" title="function v = network_velocities(s, network, kinetics, split, indices,t)">network_velocities</a>(S_pert1(:,it),network,kinetics,options.split);
0091     v_pert2  = <a href="../.././mnt/mnt_kinetics/kinetics/network_velocities.html" class="code" title="function v = network_velocities(s, network, kinetics, split, indices,t)">network_velocities</a>(S_pert2(:,it),network,kinetics,options.split);
0092     Ec(:,it) = (v_pert1-v_pert2) / (S_pert1(it,it)-S_pert2(it,it));
0093   <span class="keyword">end</span>
0094 
0095 <span class="keyword">end</span>
0096 
0097 
0098 <span class="comment">% ------------------------------------------------------------------</span>
0099 <span class="comment">% first order parameter elasticities</span>
0100 
0101 <span class="keyword">if</span> compute_pi,    
0102   
0103   [p,parameters] = <a href="../.././mnt/mnt_kinetics/kinetics/parameters2vector.html" class="code" title="function [vector,names,relevant,relevant_reactions,types] = parameters2vector(kinetics,S_ext,S_ext_names,network,split,no_names)">parameters2vector</a>(kinetics,S_ext,S_ext_names,network);  
0104   
0105   np = length(p);
0106 
0107   <span class="comment">%% restrict parameters to the first nr in the list (i.e., the enzyme levels)</span>
0108   <span class="keyword">if</span> options.only_enzyme_levels, 
0109     npp = nr;
0110   <span class="keyword">else</span>
0111     npp = np;
0112   <span class="keyword">end</span>
0113 
0114   <span class="comment">% build matrices with perturbed parameters</span>
0115 
0116   p_pert1_vec = p * (1+delta);
0117   p_pert1_vec(abs(p_pert1_vec) &lt; delta) = delta;
0118   P_pert1 = repmat(p,1,np); P_pert1(find(eye(np))) = p_pert1_vec;
0119   
0120   p_pert2_vec = p * (1-delta);
0121   p_pert2_vec(abs(p_pert2_vec) &lt; delta) = delta/2;
0122   P_pert2 = repmat(p,1,np); P_pert2(find(eye(np))) = p_pert2_vec;
0123   
0124   Ep = nan*zeros(nv,npp);
0125 
0126   <span class="keyword">if</span> second_order,
0127   
0128     <span class="keyword">for</span> it=1:npp,
0129       [nkinetics1,Sext_pert1] = <a href="../.././mnt/mnt_kinetics/kinetics/vector2parameters.html" class="code" title="function [kinetics,S_ext] = vector2parameters(kinetics,vector,external_ind,network)">vector2parameters</a>(kinetics,P_pert1(:,it),ind_ext,network);
0130       [nkinetics2,Sext_pert2] = <a href="../.././mnt/mnt_kinetics/kinetics/vector2parameters.html" class="code" title="function [kinetics,S_ext] = vector2parameters(kinetics,vector,external_ind,network)">vector2parameters</a>(kinetics,P_pert2(:,it),ind_ext,network);
0131       s_pert1  = s; s_pert1(ind_ext) = Sext_pert1;
0132       s_pert2  = s; s_pert2(ind_ext) = Sext_pert2;
0133       v_pert1  = <a href="../.././mnt/mnt_kinetics/kinetics/network_velocities.html" class="code" title="function v = network_velocities(s, network, kinetics, split, indices,t)">network_velocities</a>(s_pert1,network,nkinetics1,options.split);
0134       v_pert2  = <a href="../.././mnt/mnt_kinetics/kinetics/network_velocities.html" class="code" title="function v = network_velocities(s, network, kinetics, split, indices,t)">network_velocities</a>(s_pert2,network,nkinetics2,options.split);
0135       M = [P_pert1(it,it)-p(it), 0.5 * (P_pert1(it,it)-p(it))^2;<span class="keyword">...</span>
0136            P_pert2(it,it)-p(it), 0.5 * (P_pert2(it,it)-p(it))^2];
0137       this_Ep = inv(M)* [v_pert1 - v, v_pert2 - v]';
0138       Ep(:,it) = this_Ep(1,:)';
0139       Epp(:,it,it) = this_Ep(2,:)';
0140   <span class="keyword">end</span>
0141 
0142   <span class="keyword">else</span>,
0143   
0144     <span class="keyword">for</span> it=1:npp,
0145       [nkinetics1, Sext_pert1] = <a href="../.././mnt/mnt_kinetics/kinetics/vector2parameters.html" class="code" title="function [kinetics,S_ext] = vector2parameters(kinetics,vector,external_ind,network)">vector2parameters</a>(kinetics,P_pert1(:,it),ind_ext,network);
0146       [nkinetics2, Sext_pert2] = <a href="../.././mnt/mnt_kinetics/kinetics/vector2parameters.html" class="code" title="function [kinetics,S_ext] = vector2parameters(kinetics,vector,external_ind,network)">vector2parameters</a>(kinetics,P_pert2(:,it),ind_ext,network);
0147       s_pert1  = s; s_pert1(ind_ext) = Sext_pert1;
0148       s_pert2  = s; s_pert2(ind_ext) = Sext_pert2;
0149       v_pert1  = <a href="../.././mnt/mnt_kinetics/kinetics/network_velocities.html" class="code" title="function v = network_velocities(s, network, kinetics, split, indices,t)">network_velocities</a>(s_pert1,network,nkinetics1,options.split);
0150       v_pert2  = <a href="../.././mnt/mnt_kinetics/kinetics/network_velocities.html" class="code" title="function v = network_velocities(s, network, kinetics, split, indices,t)">network_velocities</a>(s_pert2,network,nkinetics2,options.split);
0151       Ep(:,it) = (v_pert1 - v_pert2) / (P_pert1(it,it) - P_pert2(it,it));
0152     <span class="keyword">end</span>
0153 
0154   <span class="keyword">end</span>
0155   
0156 <span class="keyword">end</span>
0157 
0158 
0159 <span class="comment">% ------------------------------------------------------------------------------</span>
0160 <span class="comment">% second order</span>
0161    
0162 <span class="keyword">if</span> second_order,
0163 
0164   delta = options.delta_basic;
0165   
0166   Epp     = zeros(nv,npp,npp);
0167   Ecp     = nan * zeros(nv,nm,npp);
0168   
0169   <span class="comment">%% metabolites, diagonal elements</span>
0170 
0171   <span class="keyword">for</span> it=1:nm,
0172     Eccdiag(:,it) = Ecc(:,it,it);
0173   <span class="keyword">end</span>
0174   
0175   <span class="comment">%% parameters, diagonal  elements</span>
0176 
0177   <span class="keyword">for</span> it=1:npp,
0178     Eppdiag(:,it) =  Epp(:,it,it);
0179   <span class="keyword">end</span>
0180   
0181   <span class="comment">%% metabolites, off-diagonal elements</span>
0182 
0183   <span class="keyword">for</span> it=1:nm,
0184     <span class="keyword">for</span> k=1:it-1,
0185       s_pert    = S_pert1(:,it); 
0186       s_pert(k) = S_pert1(k,k);
0187       delta_s   = s_pert([it,k])-s([it,k]);
0188       v_pert  = <a href="../.././mnt/mnt_kinetics/kinetics/network_velocities.html" class="code" title="function v = network_velocities(s, network, kinetics, split, indices,t)">network_velocities</a>(s_pert,network,kinetics,options.split);
0189       Ecc(:,it,k) = [ v_pert - v - Ec * (s_pert-s) <span class="keyword">...</span><span class="comment"> </span>
0190                      - 1/2 * Eccdiag(:,[it,k]) * delta_s.^2 ] <span class="keyword">...</span>
0191           / prod(delta_s);
0192       Ecc(:,k,it) = Ecc(:,it,k);
0193     <span class="keyword">end</span>
0194   <span class="keyword">end</span>
0195   
0196   <span class="comment">%% parameters, off-diagonal elements</span>
0197 
0198   <span class="keyword">for</span> it=1:npp,
0199     <span class="keyword">for</span> k=1:it-1,
0200       p_pert    = P_pert1(:,it); 
0201       p_pert(k) = P_pert1(k,k);
0202       delta_p   = p_pert([it,k])-p([it,k]);
0203       [nkinetics,Sext_pert] = <a href="../.././mnt/mnt_kinetics/kinetics/vector2parameters.html" class="code" title="function [kinetics,S_ext] = vector2parameters(kinetics,vector,external_ind,network)">vector2parameters</a>(kinetics,p_pert,ind_ext,network);
0204       s_pert    = s; s_pert(ind_ext) = Sext_pert;
0205       v_pert    = <a href="../.././mnt/mnt_kinetics/kinetics/network_velocities.html" class="code" title="function v = network_velocities(s, network, kinetics, split, indices,t)">network_velocities</a>(s_pert,network,nkinetics,options.split);
0206       Epp(:,it,k) = [ v_pert - v - Ep * (p_pert(1:npp) - p(1:npp)) <span class="keyword">...</span>
0207                       - 1/2 * Eppdiag(:,[it,k]) * delta_p.^2 ] / prod(delta_p);
0208       Epp(:,k,it) = Epp(:,it,k);
0209     <span class="keyword">end</span>
0210   <span class="keyword">end</span>
0211 
0212   <span class="comment">%% metabolites and parameters</span>
0213   
0214   <span class="keyword">for</span> it=1:nm,
0215     <span class="keyword">for</span> k=1:npp,      
0216       s_pert = S_pert1(:,it);
0217       p_pert = P_pert1(:,k);
0218       [nkinetics,Sext_pert] = <a href="../.././mnt/mnt_kinetics/kinetics/vector2parameters.html" class="code" title="function [kinetics,S_ext] = vector2parameters(kinetics,vector,external_ind,network)">vector2parameters</a>(kinetics,p_pert,ind_ext,network);
0219       s_pert(ind_ext) = Sext_pert;
0220       <span class="keyword">if</span> s_pert(it) == s(it), s_pert(it) = s(it)+delta; <span class="keyword">end</span> 
0221       v_pert       = <a href="../.././mnt/mnt_kinetics/kinetics/network_velocities.html" class="code" title="function v = network_velocities(s, network, kinetics, split, indices,t)">network_velocities</a>(s_pert, network, nkinetics, options.split);
0222       Ecp(:,it,k) = [ <span class="keyword">...</span>
0223           v_pert - v - Ec * (s_pert-s) - Ep * (p_pert(1:npp)-p(1:npp)) <span class="keyword">...</span>
0224           -  1/2 * Ecc(:,it,it) * (s_pert(it)-s(it)).^2  <span class="keyword">...</span>
0225           -  1/2 * Epp(:,k,k) * (p_pert(k)-p(k)).^2 <span class="keyword">...</span>
0226           ] <span class="keyword">...</span>
0227           / ( (s_pert(it)-s(it)) * (p_pert(k)-p(k)) );
0228     <span class="keyword">end</span>
0229   <span class="keyword">end</span>
0230   
0231   <span class="comment">%% adjust elements for external metabolites</span>
0232   
0233   <span class="keyword">if</span> ~options.only_enzyme_levels,
0234     Ecp(:,:,nr + [1:n_ext])               = Ecc(:,:,ind_ext);
0235     Epp(:,nr + [1:n_ext], nr + [1:n_ext]) = Ecc(:,ind_ext,ind_ext);
0236   <span class="keyword">end</span>
0237 
0238 <span class="keyword">end</span>
0239 
0240 
0241 <span class="comment">% --------------------------------</span>
0242 <span class="comment">% make matrices sparse</span>
0243 
0244 Ec = sparse(Ec);
0245 
0246 <span class="keyword">if</span> compute_pi,  Ep = sparse(Ep); <span class="keyword">end</span>
0247 
0248 <span class="keyword">if</span> options.include_external == 0,
0249   parameters = parameters(1:end-n_ext);
0250   Ep  = Ep(:,1:end-n_ext);
0251   <span class="keyword">if</span> second_order,
0252     Ecp = Ecp(:,:,1:end-n_ext);
0253     Epp = Epp(:,1:end-n_ext,1:end-n_ext);
0254   <span class="keyword">end</span>
0255 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Sun 09-Nov-2014 13:14:25 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>