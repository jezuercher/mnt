<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of elasticities_scaled</title>
  <meta name="keywords" content="elasticities_scaled">
  <meta name="description" content="[Ec, Ep, parameters, Ecc, Ecp, Epp] = elasticities_scaled(network,s);">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">mnt</a> &gt; <a href="#">mnt_mca</a> &gt; elasticities_scaled.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for ./mnt/mnt_mca&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>elasticities_scaled
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>[Ec, Ep, parameters, Ecc, Ecp, Epp] = elasticities_scaled(network,s);</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [Ec,Ep,parameters,Ecc,Ecp,Epp] = elasticities_scaled(network,s); </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">[Ec, Ep, parameters, Ecc, Ecp, Epp] = elasticities_scaled(network,s);

Numerical calculation of reaction elasticities for logarithmic values
 ('scaled elasticities')

FUNCTION ARGUMENTS:
  network     network structure (type 'help network_structure')
  s           column vector of metabolite concentrations

OUTPUT:
 Ec:          sparse matrix   dv_i/ds_k        of        elasticties w.r.t. metabolites
 Ep:          sparse matrix   dv_i/dp_m        of        elasticties w.r.t. parameters
 parameters:  list of parameter names
 Ecc:         tensor d^2v_i/(ds_k ds_l) of second elasticties w.r.t. metabolites
 Ecp:         tensor d^2v_i/(ds_k dp_m) of second elasticties w.r.t. metabolites and parameters  
 Epp:         tensor d^2v_i/(dp_m dP_n) of second elasticties w.r.t. parameters 

 The parameters comprise all kinetic parameters, followed by all external concentrations
 Note that therefore, the appear in both the epsilon and pi matrices!

 See also: 'elasticities'</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../.././mnt/mnt_kinetics/kinetics/network_velocities.html" class="code" title="function v = network_velocities(s, network, kinetics, split, indices,t)">network_velocities</a>	v = network_velocities(s,network,kinetics,split,indices,t)</li><li><a href="../.././mnt/mnt_kinetics/kinetics/parameters2vector.html" class="code" title="function [vector,names,relevant,relevant_reactions,types] = parameters2vector(kinetics,S_ext,S_ext_names,network,split,no_names)">parameters2vector</a>	[vector,names,relevant,relevant_reactions,types] = parameters2vector(kinetics,S_ext,S_ext_names,network,split,no_names)</li><li><a href="../.././mnt/mnt_kinetics/kinetics/vector2parameters.html" class="code" title="function [kinetics,S_ext] = vector2parameters(kinetics,vector,external_ind,network)">vector2parameters</a>	[kinetics,S_ext] = vector2parameters(kinetics,vector,external_ind,network)</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%[Ec, Ep, parameters, Ecc, Ecp, Epp] = elasticities_scaled(network,s);</span>
0002 <span class="comment">%</span>
0003 <span class="comment">%Numerical calculation of reaction elasticities for logarithmic values</span>
0004 <span class="comment">% ('scaled elasticities')</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%FUNCTION ARGUMENTS:</span>
0007 <span class="comment">%  network     network structure (type 'help network_structure')</span>
0008 <span class="comment">%  s           column vector of metabolite concentrations</span>
0009 <span class="comment">%</span>
0010 <span class="comment">%OUTPUT:</span>
0011 <span class="comment">% Ec:          sparse matrix   dv_i/ds_k        of        elasticties w.r.t. metabolites</span>
0012 <span class="comment">% Ep:          sparse matrix   dv_i/dp_m        of        elasticties w.r.t. parameters</span>
0013 <span class="comment">% parameters:  list of parameter names</span>
0014 <span class="comment">% Ecc:         tensor d^2v_i/(ds_k ds_l) of second elasticties w.r.t. metabolites</span>
0015 <span class="comment">% Ecp:         tensor d^2v_i/(ds_k dp_m) of second elasticties w.r.t. metabolites and parameters</span>
0016 <span class="comment">% Epp:         tensor d^2v_i/(dp_m dP_n) of second elasticties w.r.t. parameters</span>
0017 <span class="comment">%</span>
0018 <span class="comment">% The parameters comprise all kinetic parameters, followed by all external concentrations</span>
0019 <span class="comment">% Note that therefore, the appear in both the epsilon and pi matrices!</span>
0020 <span class="comment">%</span>
0021 <span class="comment">% See also: 'elasticities'</span>
0022 
0023 
0024 <a name="_sub0" href="#_subfunctions" class="code">function [Ec,Ep,parameters,Ecc,Ecp,Epp] = elasticities_scaled(network,s);</a>
0025 
0026 compute_pi   = (nargout&gt;1);
0027 second_order = (nargout&gt;3);
0028 kinetics     = network.kinetics;
0029 [nm,nr]      = size(network.N);
0030 ind_ext      = find(network.external);
0031 n_ext        = length(ind_ext);
0032 delta        = 0.00000001;
0033 
0034 
0035 <span class="comment">% ------------------------------------------------------------------</span>
0036 <span class="comment">% first order metabolite el.</span>
0037 
0038 log_s   = log(s);
0039 log_v   = log(abs(<a href="../.././mnt/mnt_kinetics/kinetics/network_velocities.html" class="code" title="function v = network_velocities(s, network, kinetics, split, indices,t)">network_velocities</a>(s,network,kinetics)));
0040     
0041 S_ext       = s(ind_ext);
0042 S_ext_names = network.metabolites(ind_ext);
0043 
0044 Ec   = zeros(nr,nm);
0045 
0046 <span class="keyword">for</span> it=1:nm,
0047   log_s_pert1 = log_s; log_s_pert1(it) = log_s_pert1(it)*(1+delta);
0048   log_s_pert2 = log_s; log_s_pert2(it) = log_s_pert1(it)*(1-delta);
0049   <span class="keyword">if</span> abs(log_s_pert1(it)) &lt; delta, log_s_pert1(it) = delta;  <span class="keyword">end</span>
0050   <span class="keyword">if</span> abs(log_s_pert2(it)) &lt; delta, log_s_pert2(it) = -delta; <span class="keyword">end</span>
0051   v_pert1 = log(<a href="../.././mnt/mnt_kinetics/kinetics/network_velocities.html" class="code" title="function v = network_velocities(s, network, kinetics, split, indices,t)">network_velocities</a>(exp(log_s_pert1),network,kinetics));
0052   v_pert2 = log(<a href="../.././mnt/mnt_kinetics/kinetics/network_velocities.html" class="code" title="function v = network_velocities(s, network, kinetics, split, indices,t)">network_velocities</a>(exp(log_s_pert2),network,kinetics));
0053   Ec(:,it) = (v_pert1-v_pert2) / (log_s_pert1(it)-log_s_pert2(it));
0054 <span class="keyword">end</span>
0055 
0056 <span class="comment">% ------------------------------------------------------------------</span>
0057 <span class="comment">% first order parameter el.</span>
0058 
0059 <span class="keyword">if</span> compute_pi,    
0060 
0061   [p,parameters] = <a href="../.././mnt/mnt_kinetics/kinetics/parameters2vector.html" class="code" title="function [vector,names,relevant,relevant_reactions,types] = parameters2vector(kinetics,S_ext,S_ext_names,network,split,no_names)">parameters2vector</a>(kinetics,S_ext,S_ext_names,network);
0062   log_p = log(p);
0063   np    = length(p);
0064   
0065   Ep = nan*zeros(nr,np);
0066   <span class="keyword">for</span> i=1:np,
0067     log_p_pert1  = log_p; log_p_pert1(i) = log_p_pert1(i)*(1+delta);
0068     log_p_pert2  = log_p; log_p_pert2(i) = log_p_pert2(i)*(1-delta);
0069     <span class="keyword">if</span> log_p_pert1(i)==0, log_p_pert1(i) =  delta; <span class="keyword">end</span>
0070     <span class="keyword">if</span> log_p_pert2(i)==0, log_p_pert2(i) = -delta; <span class="keyword">end</span>
0071     [nkinetics1,Sext_pert1] = <a href="../.././mnt/mnt_kinetics/kinetics/vector2parameters.html" class="code" title="function [kinetics,S_ext] = vector2parameters(kinetics,vector,external_ind,network)">vector2parameters</a>(kinetics,exp(log_p_pert1),ind_ext);
0072     [nkinetics2,Sext_pert2] = <a href="../.././mnt/mnt_kinetics/kinetics/vector2parameters.html" class="code" title="function [kinetics,S_ext] = vector2parameters(kinetics,vector,external_ind,network)">vector2parameters</a>(kinetics,exp(log_p_pert2),ind_ext);
0073     log_s_pert1    = log_s; log_s_pert1(ind_ext) = log(Sext_pert1);
0074     log_s_pert2    = log_s; log_s_pert2(ind_ext) = log(Sext_pert2);
0075     v_pert1        = log(<a href="../.././mnt/mnt_kinetics/kinetics/network_velocities.html" class="code" title="function v = network_velocities(s, network, kinetics, split, indices,t)">network_velocities</a>(exp(log_s_pert1),network,nkinetics1));
0076     v_pert2        = log(<a href="../.././mnt/mnt_kinetics/kinetics/network_velocities.html" class="code" title="function v = network_velocities(s, network, kinetics, split, indices,t)">network_velocities</a>(exp(log_s_pert2),network,nkinetics2));
0077     Ep(:,i)        = (v_pert1-v_pert2) / (log_p_pert1(i)-log_p_pert2(i));
0078   <span class="keyword">end</span>
0079       
0080 <span class="keyword">end</span>
0081 
0082 <span class="comment">% ------------------------------------------------------------------------------</span>
0083 <span class="comment">% second order</span>
0084    
0085 <span class="keyword">if</span> second_order,
0086 
0087   delta = 0.0001;
0088   
0089   Ecc      = nan * zeros(nr,nm,nm);
0090   Epp      = nan * zeros(nr,np,np);
0091   Ecp      = nan * zeros(nr,nm,np);
0092   Eccdiag  = nan * zeros(nr,nm);  <span class="comment">%  diagonal elements from Ecc</span>
0093   Eppdiag  = nan * zeros(nr,np);  <span class="comment">%  diagonal elements from Epp</span>
0094   
0095 <span class="comment">% metabolites, diagonal elements</span>
0096 
0097   <span class="keyword">for</span> i=1:nm,
0098     log_s_pert    = log_s; 
0099     log_s_pert(i) = log_s_pert(i) * (1+delta); 
0100     <span class="keyword">if</span> abs(log_s_pert(i)) &lt; delta, log_s_pert(i) = delta; <span class="keyword">end</span> 
0101     v_pert       = log(<a href="../.././mnt/mnt_kinetics/kinetics/network_velocities.html" class="code" title="function v = network_velocities(s, network, kinetics, split, indices,t)">network_velocities</a>(exp(log_s_pert),network,kinetics));
0102     Ecc(:,i,i)   = 2 * ( v_pert - log_v - Ec * (log_s_pert-log_s) ) / (log_s_pert(i)-log_s(i))^2;
0103     Eccdiag(:,i) = Ecc(:,i,i);
0104   <span class="keyword">end</span>
0105   
0106 <span class="comment">% metabolites, off diagonal elements</span>
0107 
0108   <span class="keyword">for</span> i=1:nm,
0109     <span class="keyword">for</span> k=1:i-1,
0110       log_s_pert    = log_s; 
0111       log_s_pert(i) = log_s_pert(i) * (1+delta); 
0112       log_s_pert(k) = log_s_pert(k) * (1+delta); 
0113       <span class="keyword">if</span> abs(log_s_pert(i))&lt;delta,  log_s_pert(i) =   delta; <span class="keyword">end</span> 
0114       <span class="keyword">if</span> abs(log_s_pert(k))&lt;delta,  log_s_pert(k) = - delta; <span class="keyword">end</span>
0115       v_pert  = log(<a href="../.././mnt/mnt_kinetics/kinetics/network_velocities.html" class="code" title="function v = network_velocities(s, network, kinetics, split, indices,t)">network_velocities</a>(exp(log_s_pert),network,kinetics));
0116       delta_s = log_s_pert([i,k]) - log_s([i,k]);
0117       Ecc(:,i,k) = <span class="keyword">...</span>
0118           ( v_pert - log_v - Ec * (log_s_pert - log_s) - 1/2 * Eccdiag(:,[i,k]) * delta_s.^2 ) <span class="keyword">...</span>
0119           / prod(delta_s);
0120       Ecc(:,k,i) = Ecc(:,i,k);
0121     <span class="keyword">end</span>
0122   <span class="keyword">end</span>
0123   
0124 <span class="comment">% parameters, diagonal  elements</span>
0125   
0126   <span class="keyword">for</span> i=1:np,
0127     log_p_pert    = log_p; 
0128     log_p_pert(i) = log_p(i) * (1+delta); 
0129     <span class="keyword">if</span> log_p_pert(i)==0, log_p_pert(i) = delta; <span class="keyword">end</span> 
0130     [nkinetics,Sext_pert] = <a href="../.././mnt/mnt_kinetics/kinetics/vector2parameters.html" class="code" title="function [kinetics,S_ext] = vector2parameters(kinetics,vector,external_ind,network)">vector2parameters</a>(kinetics,exp(log_p_pert),ind_ext);
0131     log_s_pert            = log_s; 
0132     log_s_pert(ind_ext)   = log(Sext_pert);
0133     v_pert      = log(<a href="../.././mnt/mnt_kinetics/kinetics/network_velocities.html" class="code" title="function v = network_velocities(s, network, kinetics, split, indices,t)">network_velocities</a>(exp(log_s_pert),network,nkinetics));
0134     Epp(:,i,i)  = 2 * ( v_pert - log_v - Ep * (log_p_pert- log_p) ) <span class="keyword">...</span>
0135         / ( log_p_pert(i) - log_p(i) )^2;
0136     Eppdiag(:,i) =  Epp(:,i,i);
0137   <span class="keyword">end</span>
0138   
0139 <span class="comment">% parameters, off diagonal elements</span>
0140    
0141   <span class="keyword">for</span> i=1:np,
0142     <span class="keyword">for</span> k=1:i-1,
0143       log_p_pert    = log_p; 
0144       log_p_pert(i) = log_p_pert(i)*(1+delta); 
0145       log_p_pert(k) = log_p(k) * (1+delta);
0146       <span class="keyword">if</span> log_p_pert(i)==0, log_p_pert(i) = delta; <span class="keyword">end</span> 
0147       <span class="keyword">if</span> log_p_pert(k)==0, log_p_pert(k) = -delta; <span class="keyword">end</span> 
0148       [nkinetics,Sext_pert]   = <a href="../.././mnt/mnt_kinetics/kinetics/vector2parameters.html" class="code" title="function [kinetics,S_ext] = vector2parameters(kinetics,vector,external_ind,network)">vector2parameters</a>(kinetics,exp(log_p_pert),ind_ext);
0149       log_s_pert    = log_s; 
0150       log_s_pert(ind_ext) = log(Sext_pert);
0151       v_pert      = log(<a href="../.././mnt/mnt_kinetics/kinetics/network_velocities.html" class="code" title="function v = network_velocities(s, network, kinetics, split, indices,t)">network_velocities</a>(exp(log_s_pert),network,nkinetics));
0152       delta_p  = log_p_pert([i,k])-log_p([i,k]);
0153       Epp(:,i,k) = <span class="keyword">...</span>
0154           ( v_pert - log_v - Ep * (log_p_pert-log_p) -  1/2 * Eppdiag(:,[i,k]) * delta_p.^2) <span class="keyword">...</span>
0155           / prod(delta_p);
0156       Epp(:,k,i) = Epp(:,i,k);
0157     <span class="keyword">end</span>
0158   <span class="keyword">end</span>
0159   
0160 <span class="comment">% metabolites and parameters</span>
0161      
0162   <span class="keyword">for</span> i=1:nm,
0163     <span class="keyword">for</span> k=1:np,
0164       
0165       log_s_pert    = log_s;      
0166       log_s_pert(i) = log_s_pert(i) * (1+delta);  
0167       log_p_pert    = log_p;  
0168       log_p_pert(k) = log_p_pert(k) * (1+delta);  
0169       <span class="keyword">if</span> log_p_pert(k)==0, log_p_pert(k)=delta; <span class="keyword">end</span>
0170       [nkinetics,Sext_pert] = <a href="../.././mnt/mnt_kinetics/kinetics/vector2parameters.html" class="code" title="function [kinetics,S_ext] = vector2parameters(kinetics,vector,external_ind,network)">vector2parameters</a>(kinetics,exp(log_p_pert),ind_ext);
0171       log_s_pert(ind_ext)   = log(Sext_pert);
0172       <span class="keyword">if</span> log_s_pert(i)==log_s(i),  log_s_pert(i) = log_s(i) + delta; <span class="keyword">end</span> 
0173       v_pert       = log(<a href="../.././mnt/mnt_kinetics/kinetics/network_velocities.html" class="code" title="function v = network_velocities(s, network, kinetics, split, indices,t)">network_velocities</a>(exp(log_s_pert),network,nkinetics));
0174       Ecp(:,i,k) = ( <span class="keyword">...</span>
0175           v_pert - log_v - Ec * (log_s_pert-log_s) - Ep * (log_p_pert-log_p) <span class="keyword">...</span>
0176           -  1/2 * Eccdiag(:,i) * (log_s_pert(i)-log_s(i)).^2  <span class="keyword">...</span>
0177           -  1/2 * Eppdiag(:,k) * (log_p_pert(k)-log_p(k)).^2 <span class="keyword">...</span>
0178           ) <span class="keyword">...</span>
0179           / ( (log_s_pert(i)-log_s(i)) * (log_p_pert(k)-log_p(k)) );
0180     <span class="keyword">end</span>
0181   <span class="keyword">end</span>
0182   
0183 <span class="comment">% adjust elements for external metabolites</span>
0184   
0185   Ecp(:,ind_ext,end-n_ext+1:end) = Ecc(:,ind_ext,ind_ext);
0186   
0187 <span class="keyword">end</span>
0188    
0189    
0190 <span class="comment">% --------------------------------</span>
0191 <span class="comment">% make matrices sparse</span>
0192    
0193 Ec = sparse(Ec);
0194 
0195 <span class="keyword">if</span> compute_pi,  Ep = sparse(Ep); <span class="keyword">end</span></pre></div>
<hr><address>Generated on Sun 09-Nov-2014 13:14:25 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>