<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of sbml2network</title>
  <meta name="keywords" content="sbml2network">
  <meta name="description" content="network = sbml2network(file,graphics_flag);">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">mnt</a> &gt; <a href="index.html">mnt_network</a> &gt; sbml2network.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for mnt/mnt_network&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>sbml2network
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>network = sbml2network(file,graphics_flag);</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function network = sbml2network(file,graphics_flag); </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> network = sbml2network(file,graphics_flag);

 read network from SBML file

 Attention: only SBML level 1 is supported

 EXAMPLE
 network = sbml2network('data/branch.xml');

 This function requires the xml package &quot;XML TOOLS&quot;
 by Peter Rydesa&quot;ter, available from Matlab Central</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">% network = sbml2network(file,graphics_flag);</span>
0002 <span class="comment">%</span>
0003 <span class="comment">% read network from SBML file</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% Attention: only SBML level 1 is supported</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% EXAMPLE</span>
0008 <span class="comment">% network = sbml2network('data/branch.xml');</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% This function requires the xml package &quot;XML TOOLS&quot;</span>
0011 <span class="comment">% by Peter Rydesa&quot;ter, available from Matlab Central</span>
0012 
0013 <a name="_sub0" href="#_subfunctions" class="code">function network = sbml2network(file,graphics_flag);</a>
0014 
0015 <span class="keyword">if</span> ~exist(<span class="string">'graphics_flag'</span>,<span class="string">'var'</span>), graphics_flag=0; <span class="keyword">end</span>
0016 
0017 f = fopen(file);
0018 xmlstring=char(fread(f,[1 inf],<span class="string">'uint8'</span>));
0019 fclose(f);
0020 st=xmlstruct(xmlstring,<span class="string">'sub'</span>);
0021 
0022 <span class="keyword">for</span> it = 1:length(st.sub),
0023  <span class="keyword">if</span> strcmp(st.sub(it).name, <span class="string">'sbml'</span>),
0024    sbml_struct=st.sub(it);
0025    sbml_level = sbml_struct.data.level;
0026    sbml_xmlns = sbml_struct.data.xmlns;
0027    sbml_version = sbml_struct.data.version;
0028  <span class="keyword">end</span>
0029 <span class="keyword">end</span>
0030 
0031 model = sbml_struct.sub(1); <span class="comment">%fprintf('Model %s\n',model.data.name);</span>
0032 
0033 <span class="keyword">for</span> it = 1:length(model.sub),
0034   <span class="keyword">switch</span> model.sub(it).name,
0035     <span class="keyword">case</span> <span class="string">'notes'</span>,                 notes                 = model.sub(it);
0036     <span class="keyword">case</span> <span class="string">'listOfFunctionDefinitions'</span>, listOfFunctionDefinitions = model.sub(it);
0037     <span class="keyword">case</span> <span class="string">'listOfUnitDefinitions'</span>, listOfUnitDefinitions = model.sub(it);
0038     <span class="keyword">case</span> <span class="string">'listOfCompartments'</span>,    listOfCompartments    = model.sub(it);
0039     <span class="keyword">case</span> <span class="string">'listOfSpecies'</span>,         listOfSpecies         = model.sub(it);
0040     <span class="keyword">case</span> <span class="string">'listOfParameters'</span>,      listOfParameters      = model.sub(it);
0041     <span class="keyword">case</span> <span class="string">'listOfRules'</span>,           listOfRules           = model.sub(it);
0042     <span class="keyword">case</span> <span class="string">'listOfReactions'</span>,       listOfReactions       = model.sub(it);
0043     <span class="keyword">case</span> <span class="string">'listOfEvents'</span>,          listOfEvents          = model.sub(it);
0044   <span class="keyword">end</span>
0045 <span class="keyword">end</span>
0046 
0047 <span class="comment">% --- analyse list of species -&gt; lists 'metabolites', 'metabolite_names',</span>
0048 <span class="comment">% 'metabolite_compartments', 's_init', 'a_init', 'external', 'metabolite_units'</span>
0049 
0050 <span class="keyword">for</span> it=1:length(listOfSpecies.sub)-1,
0051  <span class="keyword">if</span> isfield(listOfSpecies.sub(it).data,<span class="string">'id'</span>),
0052    metabolites{it} = listOfSpecies.sub(it).data.id;
0053  <span class="keyword">end</span>
0054  <span class="keyword">if</span> isfield(listOfSpecies.sub(it).data,<span class="string">'name'</span>),
0055    metabolite_names{it} = listOfSpecies.sub(it).data.name;
0056    <span class="comment">% fill holes</span>
0057  <span class="keyword">else</span>,
0058    metabolite_names{it} =    metabolites{it};
0059  <span class="keyword">end</span>
0060  <span class="keyword">if</span> isfield(listOfSpecies.sub(it).data,<span class="string">'substanceUnits'</span>),
0061    metabolite_units{it} = listOfSpecies.sub(it).data.unit;
0062  <span class="keyword">end</span>
0063  <span class="keyword">if</span> isfield(listOfSpecies.sub(it).data,<span class="string">'compartment'</span>),
0064    metabolite_compartments{it} = listOfSpecies.sub(it).data.compartment;
0065  <span class="keyword">end</span>
0066  <span class="keyword">if</span> isfield(listOfSpecies.sub(it).data,<span class="string">'initialAmount'</span>),
0067    a_init(it) = eval(listOfSpecies.sub(it).data.initialAmount);
0068  <span class="keyword">end</span>
0069  <span class="keyword">if</span> isfield(listOfSpecies.sub(it).data,<span class="string">'initialConcentration'</span>),
0070    s_init(it) = eval(listOfSpecies.sub(it).data.initialConcentration);
0071  <span class="keyword">end</span>
0072  <span class="keyword">if</span> isfield(listOfSpecies.sub(it).data,<span class="string">'boundaryCondition'</span>),
0073    external(it) = eval(listOfSpecies.sub(it).data.boundaryCondition);
0074  <span class="keyword">end</span>
0075 <span class="keyword">end</span>
0076 
0077 
0078 <span class="keyword">if</span> ~exist(<span class="string">'metabolites'</span>,<span class="string">'var'</span>), metabolites = metabolite_names; <span class="keyword">end</span>
0079 metabolites = metabolites';
0080 <span class="keyword">if</span> exist(<span class="string">'s_init'</span>,<span class="string">'var'</span>), s_init = s_init'; <span class="keyword">end</span>
0081 <span class="keyword">if</span> exist(<span class="string">'a_init'</span>,<span class="string">'var'</span>), a_init = a_init'; <span class="keyword">end</span>
0082 <span class="keyword">if</span> exist(<span class="string">'metabolite_names'</span>,<span class="string">'var'</span>), metabolite_names=metabolite_names'; <span class="keyword">end</span> 
0083 <span class="keyword">if</span> exist(<span class="string">'metabolite_units'</span>,<span class="string">'var'</span>), metabolite_units=metabolite_units'; <span class="keyword">end</span> 
0084 <span class="keyword">if</span> exist(<span class="string">'metabolite_compartments'</span>,<span class="string">'var'</span>), metabolite_compartments=metabolite_compartments'; <span class="keyword">end</span> 
0085 
0086 
0087 <span class="comment">% --- analyse list of reactions -&gt; lists 'actions', 'reversible', reaction_annotation,</span>
0088 <span class="comment">% listOfReactants, listOfProducts, listOfModifiers</span>
0089 
0090 actions    = [];
0091 reversible = [];
0092 
0093 nr = length(listOfReactions.sub)-1;
0094 
0095 <span class="keyword">for</span> it=1:nr,
0096 
0097   <span class="keyword">if</span> isfield(listOfReactions.sub(it).data,<span class="string">'id'</span>),         reaction_id{it,:} = listOfReactions.sub(it).data.id; <span class="keyword">end</span>
0098   <span class="keyword">if</span> isfield(listOfReactions.sub(it).data,<span class="string">'name'</span>),       reaction_name{it} = listOfReactions.sub(it).data.name; <span class="keyword">end</span>
0099   <span class="keyword">if</span> isfield(listOfReactions.sub(it).data,<span class="string">'fast'</span>),       reaction_fast{it} = listOfReactions.sub(it).data.fast; <span class="keyword">end</span>
0100   <span class="keyword">if</span> isfield(listOfReactions.sub(it).data,<span class="string">'reversible'</span>), 
0101     reaction_rev{it} = listOfReactions.sub(it).data.reversible;
0102     reversible(it)=strcmp(reaction_rev{it},<span class="string">'true'</span>);
0103   <span class="keyword">end</span>
0104 
0105   listOfReactants{it} = {};
0106   listOfProducts{it}  = {};
0107   listOfModifiers{it}  = {};
0108 
0109   <span class="keyword">for</span> itt = 1:length(listOfReactions.sub(it).sub)-1;
0110     item = listOfReactions.sub(it).sub(itt);
0111     <span class="keyword">switch</span> item.name,
0112       <span class="keyword">case</span> <span class="string">'annotation'</span>,      reaction_annotation{it} = item;
0113       <span class="keyword">case</span> <span class="string">'listOfReactants'</span>,     listOfReactants{it} = item;
0114       <span class="keyword">case</span> <span class="string">'listOfProducts'</span>,       listOfProducts{it} = item;
0115       <span class="keyword">case</span> <span class="string">'listOfModifiers'</span>,     listOfModifiers{it} = item;
0116     <span class="keyword">end</span>
0117   <span class="keyword">end</span>
0118 <span class="keyword">end</span>
0119 
0120 <span class="keyword">if</span> ~exist(<span class="string">'reaction_id'</span>,<span class="string">'var'</span>), reaction_id = reaction_name; <span class="keyword">end</span>
0121 
0122 actions = reaction_id;
0123 
0124 <span class="keyword">if</span> isempty(reversible), reversible = ones(size(actions)); <span class="keyword">else</span>, reversible=reversible'; <span class="keyword">end</span>
0125 
0126 <span class="comment">% -------------------------------------------------------------------------------------</span>
0127 <span class="comment">%</span>
0128 <span class="comment">% analyse kinetics -&gt; lists stoichiometries, pstoichiometries, formula, parlist</span>
0129 
0130 formula = {};
0131 parlist = {};
0132 
0133 <span class="keyword">for</span> it=1:nr,
0134 
0135   this_substrate ={};
0136   <span class="keyword">if</span> ~isempty(listOfReactants{it}), this_substrate = listOfReactants{it}.sub; <span class="keyword">end</span>
0137   substrate{it}={};
0138   sstoichiometries{it}=[];
0139   <span class="keyword">for</span> itt = 1:length(this_substrate)-1;
0140     <span class="keyword">if</span> isfield(this_substrate(itt).data,<span class="string">'specie'</span>), 
0141       substrate{it}= [substrate{it} {this_substrate(itt).data.specie}];
0142     <span class="keyword">else</span>,
0143       substrate{it}= [substrate{it} {this_substrate(itt).data.species}];
0144     <span class="keyword">end</span>
0145     <span class="keyword">if</span> isfield(this_substrate(itt).data,<span class="string">'stoichiometry'</span>),
0146       sstoichiometries{it}=[sstoichiometries{it} eval(this_substrate(itt).data.stoichiometry)];
0147     <span class="keyword">else</span>,sstoichiometries{it} = 1;
0148     <span class="keyword">end</span>
0149   <span class="keyword">end</span>
0150   
0151    
0152   this_product={};
0153   <span class="keyword">if</span> ~isempty(listOfProducts{it}), this_product = listOfProducts{it}.sub; <span class="keyword">end</span> 
0154   product{it}          = {};
0155   pstoichiometries{it} = [];
0156   <span class="keyword">for</span> itt = 1:length(this_product)-1;
0157     <span class="keyword">if</span> isfield(this_product(itt).data,<span class="string">'specie'</span>), 
0158       product{it}= [product{it} {this_product(itt).data.specie}];
0159     <span class="keyword">else</span>,
0160       product{it}= [product{it} {this_product(itt).data.species}];
0161     <span class="keyword">end</span>
0162     <span class="keyword">if</span> isfield(this_product(itt).data,<span class="string">'stoichiometry'</span>),
0163       pstoichiometries{it}=[pstoichiometries{it} eval(this_product(itt).data.stoichiometry)];
0164     <span class="keyword">else</span>,
0165       pstoichiometries{it} = 1;
0166     <span class="keyword">end</span>
0167   <span class="keyword">end</span>
0168 
0169   this_modifier={};
0170   <span class="keyword">if</span> ~isempty(listOfModifiers{it}), this_modifier = listOfModifiers{it}.sub; <span class="keyword">end</span> 
0171   modifier{it}          = {};
0172   <span class="keyword">for</span> itt = 1:length(this_modifier)-1;
0173     <span class="keyword">if</span> isfield(this_modifier(itt).data,<span class="string">'specie'</span>), 
0174       modifier{it}= [modifier{it} {this_modifier(itt).data.specie}];
0175     <span class="keyword">else</span>,
0176       modifier{it}= [modifier{it} {this_modifier(itt).data.species}];
0177     <span class="keyword">end</span>
0178   <span class="keyword">end</span>
0179 
0180   formula{it} = <span class="string">''</span>;
0181   parlist{it} = {};
0182   <span class="keyword">if</span> isfield(listOfReactions.sub(it).sub(3).data,<span class="string">'formula'</span>),
0183     formula{it} = listOfReactions.sub(it).sub(3).data.formula;
0184     parlist{it}={};
0185     <span class="keyword">if</span> ~isempty( listOfReactions.sub(it).sub(3).sub),
0186       <span class="keyword">for</span> itt = 1:length(listOfReactions.sub(it).sub(3).sub(1).sub)-1;
0187     parameters  =  listOfReactions.sub(it).sub(3).sub(1).sub(itt).data;
0188     parlist{it}= [parlist{it}; {parameters}];
0189       <span class="keyword">end</span>
0190     <span class="keyword">end</span>
0191   <span class="keyword">end</span>
0192   
0193 <span class="keyword">end</span>
0194 
0195 <span class="comment">% ----------------------------------------------------------------</span>
0196 
0197 N = zeros(length(metabolites),length(reaction_id));
0198 
0199 <span class="keyword">for</span> it=1:length(listOfReactions.sub)-1,
0200   substrate_indices =  label_names(substrate{it},metabolites,<span class="string">'single'</span>);
0201  <span class="keyword">if</span> length(substrate_indices), N(substrate_indices,it) = N(substrate_indices,it)-sstoichiometries{it}'; <span class="keyword">end</span> 
0202   product_indices =  label_names(product{it},metabolites,<span class="string">'single'</span>);
0203  <span class="keyword">if</span> length(product_indices),  N(product_indices,it) = N(product_indices,it) + pstoichiometries{it}' ; <span class="keyword">end</span>
0204 <span class="keyword">end</span>
0205 
0206 <span class="comment">% --------------------------------------------------------------------------------------------</span>
0207 
0208 network.metabolites  = metabolites;
0209 network.actions      = reaction_id;
0210 network.external     = zeros(size(network.metabolites));
0211 network.reversible   = reversible;
0212 network.N            = N;
0213 
0214 <span class="keyword">if</span> graphics_flag,
0215   <span class="keyword">if</span> length(network.actions),
0216     netgraph_draw(network);
0217   <span class="keyword">end</span>
0218 <span class="keyword">end</span>
0219 
0220 <span class="keyword">if</span> ~isempty(formula),
0221   network.kinetics.type = <span class="string">'formula_strings'</span>;
0222   network.kinetics.reactions = {};
0223   <span class="keyword">for</span> it = 1:length(actions),
0224     network.kinetics.reactions{it}.string = formula{it};
0225     network.kinetics.reactions{it}.parameters = parlist{it};
0226     <span class="keyword">for</span> itt = 1:length(network.kinetics.reactions{it}.parameters),
0227       network.kinetics.reactions{it}.parameters{itt}.value = eval(network.kinetics.reactions{it}.parameters{itt}.value );
0228     <span class="keyword">end</span>
0229   <span class="keyword">end</span>
0230   network.kinetics.reactions = network.kinetics.reactions';
0231   
0232   network.regulation_matrix = zeros(size(network.N))';
0233   <span class="keyword">for</span> it1 = 1:length(network.actions),
0234     <span class="keyword">for</span> it2=1:length(network.metabolites),
0235       <span class="keyword">if</span> length(findstr(network.metabolites{it2},network.kinetics.reactions{it1}.string)), network.regulation_matrix(it1,it2) =1; <span class="keyword">end</span>
0236     <span class="keyword">end</span>
0237   <span class="keyword">end</span>
0238 <span class="keyword">end</span>
0239 
0240 
0241 <span class="keyword">if</span> exist(<span class="string">'metabolite_names'</span>,<span class="string">'var'</span>), network.metabolite_names  = metabolite_names; <span class="keyword">end</span>
0242 network.action_names      = actions;
0243 
0244 <span class="keyword">if</span> ~isempty(formula),
0245   z=1;
0246   network.kinetics.parameter_values = [];
0247   network.kinetics.parameters = [];
0248 
0249   <span class="keyword">for</span> it=1:length(network.actions),
0250     par = network.kinetics.reactions{it}.parameters;
0251     <span class="keyword">for</span> it2 = 1: length(par),
0252       network.kinetics.parameters{z}   = [<span class="string">'v'</span> num2str(it) <span class="string">'_'</span> par{it2}.name];
0253       network.kinetics.parameter_values(z)   = par{it2}.value;
0254       network.kinetics.reactions{it}.parameters{it2}.index = z;
0255       network.kinetics.reactions{it}.parameters{it2} = rmfield(network.kinetics.reactions{it}.parameters{it2},<span class="string">'value'</span>);
0256       z=z+1;
0257     <span class="keyword">end</span>
0258   <span class="keyword">end</span>
0259   network.kinetics.parameter_values = network.kinetics.parameter_values';
0260   network.kinetics.parameters = network.kinetics.parameters';
0261 <span class="keyword">else</span> fprintf(<span class="string">'Warning: no kinetics found in SBML file.\n'</span>);
0262 <span class="keyword">end</span> 
0263 
0264 <span class="keyword">if</span> exist(<span class="string">'s_init'</span>,<span class="string">'var'</span>), 
0265   network.s_init       = s_init; 
0266 <span class="keyword">else</span>,
0267   <span class="keyword">if</span> exist(<span class="string">'a_init'</span>,<span class="string">'var'</span>), 
0268     network.s_init       = a_init; 
0269   <span class="keyword">end</span>
0270 <span class="keyword">end</span>
0271 
0272 <span class="keyword">end</span>
0273 
0274 <span class="comment">% ----------------------------------------------------------------</span>
0275</pre></div>
<hr><address>Generated on Fri 05-Apr-2013 15:19:47 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>