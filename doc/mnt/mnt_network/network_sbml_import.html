<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of network_sbml_import</title>
  <meta name="keywords" content="network_sbml_import">
  <meta name="description" content="[network,s] = network_sbml_import(s,dirname)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">mnt</a> &gt; <a href="index.html">mnt_network</a> &gt; network_sbml_import.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for mnt/mnt_network&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>network_sbml_import
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>[network,s] = network_sbml_import(s,dirname)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [network,s] = network_sbml_import(s,dirname) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">[network,s] = network_sbml_import(s,dirname)

Import a network from SBML format.

s can be:
- a SBML structure (as defined by the SBMLToolbox)
- a filename. In this case, the firectory name has to be given 
  in the argument 'dirname'

Kinetic laws are represented in kinetics of the 'formula_strings'
type (see 'network_velocities')

This function requiers the SBMLToolbox to be installed
(see http://sbml.org/software/sbmltoolbox/)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%[network,s] = network_sbml_import(s,dirname)</span>
0002 <span class="comment">%</span>
0003 <span class="comment">%Import a network from SBML format.</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%s can be:</span>
0006 <span class="comment">%- a SBML structure (as defined by the SBMLToolbox)</span>
0007 <span class="comment">%- a filename. In this case, the firectory name has to be given</span>
0008 <span class="comment">%  in the argument 'dirname'</span>
0009 <span class="comment">%</span>
0010 <span class="comment">%Kinetic laws are represented in kinetics of the 'formula_strings'</span>
0011 <span class="comment">%type (see 'network_velocities')</span>
0012 <span class="comment">%</span>
0013 <span class="comment">%This function requiers the SBMLToolbox to be installed</span>
0014 <span class="comment">%(see http://sbml.org/software/sbmltoolbox/)</span>
0015 
0016 <a name="_sub0" href="#_subfunctions" class="code">function [network,s] = network_sbml_import(s,dirname)</a>
0017 
0018 create_annotations = 0;   <span class="comment">% CONSTRUCT UNIQUE ANNOTATIONS ?</span>
0019 graphics_flag      = 0;   <span class="comment">% SHOW GRAPHICS?</span>
0020 import_names       = 1;   <span class="comment">% import_names from model</span>
0021 import_compartments= 0;   <span class="comment">% import_names from model</span>
0022 
0023 <span class="keyword">if</span> isstr(s),
0024   <span class="keyword">if</span> exist(<span class="string">'dirname'</span>,<span class="string">'var'</span>); cd(dirname); <span class="keyword">end</span> 
0025   s = TranslateSBML(s);
0026 <span class="keyword">end</span>
0027 
0028 <span class="comment">% -----------------------------------------------------------------------------</span>
0029 <span class="comment">% --- analyse list of species -&gt;</span>
0030 
0031 <span class="comment">%  lists 'metabolites', 'metabolite_names',</span>
0032 <span class="comment">% 'metabolite_compartments', 's_init', 'a_init', 'external', 'metabolite_units'</span>
0033 
0034 clear metabolites 
0035 <span class="keyword">for</span> it=1:length(s.species),
0036   metabolites{it,:} = s.species(it).id;
0037   metabolite_names{it,:} = s.species(it).name;
0038   metabolite_compartments{it,:} = s.species(it).compartment;
0039   external(it,:) = s.species(it).boundaryCondition;
0040   s_init(it,:)   = s.species(it).initialConcentration;
0041   a_init(it,:)   = s.species(it).initialAmount;
0042   ind = findstr(s.species(it).annotation,<span class="string">'kegg.compound'</span>); 
0043   <span class="keyword">if</span> ind, metabolite_kegg_id{it,:} = s.species(it).annotation(ind+14:ind+19); 
0044   <span class="keyword">else</span>,
0045     ind = findstr(s.species(it).annotation,<span class="string">'kegg'</span>); 
0046     <span class="keyword">if</span> ind, metabolite_kegg_id{it,:} = s.species(it).annotation(ind+5:ind+10); 
0047     <span class="keyword">else</span>,
0048       metabolite_kegg_id{it,:} = <span class="string">''</span>;
0049     <span class="keyword">end</span>
0050   <span class="keyword">end</span>
0051 <span class="keyword">end</span>
0052 
0053 <span class="comment">% -----------------------------------------------------------------------------</span>
0054 <span class="comment">% --- analyse list of reactions</span>
0055 
0056 actions    = [];
0057 reversible = [];
0058 
0059 <span class="keyword">for</span> it=1:length(s.reaction),
0060   reaction_id{it,:} = s.reaction(it).id; 
0061   reaction_name{it,:} = s.reaction(it).name; 
0062   reaction_fast{it,:} = s.reaction(it).fast;
0063   reversible(it,:) = s.reaction(it).reversible;
0064   reaction_annotation{it,:} = s.reaction(it).annotation;
0065   <span class="keyword">if</span> isempty(s.reaction(it).kineticLaw),
0066     reaction_formula{it,:}    = [];
0067     reaction_math{it,:}       = [];
0068     reaction_parameter{it,:}  = [];
0069   <span class="keyword">else</span>,
0070     reaction_formula{it,:}    = s.reaction(it).kineticLaw.formula;
0071     reaction_math{it,:}       = s.reaction(it).kineticLaw.math;
0072     reaction_parameter{it,:}  = s.reaction(it).kineticLaw.parameter;
0073   <span class="keyword">end</span>
0074   listOfReactants{it,:} = s.reaction(it).reactant;
0075   listOfProducts{it,:}  = s.reaction(it).product;
0076   listOfModifiers{it,:} = s.reaction(it).modifier;
0077   ind = findstr(s.reaction(it).annotation,<span class="string">'kegg.reaction'</span>); 
0078   <span class="keyword">if</span> ind, 
0079     reaction_kegg_id{it,:} = s.reaction(it).annotation(ind+14:ind+19);
0080   <span class="keyword">else</span>,
0081     reaction_kegg_id{it,:} = <span class="string">''</span>;
0082   <span class="keyword">end</span>
0083 
0084 <span class="keyword">end</span>
0085 
0086 actions = reaction_id;
0087 <span class="keyword">if</span> isempty(reversible), reversible = ones(size(actions)); <span class="keyword">else</span>, reversible=reversible; <span class="keyword">end</span>
0088 
0089 <span class="comment">% -----------------------------------------------------------------------------</span>
0090 <span class="comment">% analyse kinetics -&gt; lists stoichiometries, pstoichiometries</span>
0091 
0092 
0093 <span class="keyword">for</span> it=1:length(listOfReactants),
0094   substrate{it}={};
0095   sstoichiometries{it}=[];
0096   <span class="keyword">for</span> itt = 1:length(listOfReactants{it});
0097     substrate{it}= [substrate{it} {listOfReactants{it}(itt).species}];
0098     sstoichiometries{it}= [sstoichiometries{it} listOfReactants{it}(itt).stoichiometry];
0099   <span class="keyword">end</span>
0100 <span class="keyword">end</span>
0101   
0102 <span class="keyword">for</span> it=1:length(listOfProducts),
0103   product{it}={};
0104   pstoichiometries{it}=[];
0105   <span class="keyword">for</span> itt = 1:length(listOfProducts{it});
0106     product{it}= [product{it} {listOfProducts{it}(itt).species}];
0107     pstoichiometries{it}= [pstoichiometries{it} listOfProducts{it}(itt).stoichiometry];
0108   <span class="keyword">end</span>
0109 <span class="keyword">end</span>
0110 
0111 <span class="keyword">for</span> it=1:length(listOfModifiers),
0112   modifier{it}={};
0113   <span class="keyword">for</span> itt = 1:length(listOfModifiers{it});
0114     modifier{it}= [modifier{it} {listOfModifiers{it}(itt).species}];
0115   <span class="keyword">end</span>
0116 <span class="keyword">end</span>
0117 
0118 <span class="comment">% ----------------------------------------------------------------</span>
0119 
0120 N=zeros(length(metabolites),length(reaction_id));
0121 
0122 <span class="keyword">for</span> it=1:length(s.reaction),
0123   substrate_indices =  label_names(substrate{it},metabolites,<span class="string">'single'</span>);
0124  <span class="keyword">if</span> length(substrate_indices), N(substrate_indices,it) = N(substrate_indices,it)-sstoichiometries{it}'; <span class="keyword">end</span> 
0125   product_indices =  label_names(product{it},metabolites,<span class="string">'single'</span>);
0126  <span class="keyword">if</span> length(product_indices),  N(product_indices,it) = N(product_indices,it) + pstoichiometries{it}' ; <span class="keyword">end</span>
0127 <span class="keyword">end</span>
0128 
0129 <span class="comment">% --------------------------------------------------------------------------------------------</span>
0130 
0131 network.metabolites  = metabolites;
0132 network.actions      = reaction_id;
0133 network.external     = double(external);
0134 network.reversible   = reversible;
0135 network.N            = N;
0136 
0137 network.metabolite_KEGGID = metabolite_kegg_id;
0138 network.reaction_KEGGID   = reaction_kegg_id;
0139 
0140 <span class="keyword">if</span> import_names,
0141 
0142 <span class="keyword">if</span> exist(<span class="string">'metabolite_names'</span>,<span class="string">'var'</span>), network.metabolite_names  = metabolite_names; 
0143 <span class="keyword">else</span>, network.metabolite_names  = network.metabolites; <span class="keyword">end</span>
0144 
0145 <span class="keyword">if</span> exist(<span class="string">'reaction_name'</span>,<span class="string">'var'</span>), network.reaction_names  = reaction_name; 
0146 <span class="keyword">else</span>, network.reaction_names  = network.actions; <span class="keyword">end</span>
0147 
0148 <span class="keyword">end</span>
0149 
0150 <span class="keyword">if</span> import_names,
0151   <span class="keyword">if</span> exist(<span class="string">'metabolite_names'</span>,<span class="string">'var'</span>), network.metabolite_compartments  = metabolite_compartments; 
0152   <span class="keyword">else</span>, network.metabolite_compartments  = repmat({<span class="string">''</span>},length(network.metabolites),1); <span class="keyword">end</span>
0153 <span class="keyword">end</span>
0154 
0155 <span class="comment">% ------------------------------------------------------------</span>
0156 <span class="comment">% set reaction kinetics</span>
0157 
0158 network.regulation_matrix = zeros(size(network.N))';
0159   
0160 <span class="keyword">for</span> it1 = 1:length(modifier),
0161   <span class="keyword">for</span> it2=1:length(modifier{it1}),
0162     mm = label_names(modifier{it1}(it2),metabolites);
0163     <span class="keyword">if</span> mm,
0164       network.regulation_matrix(it1,mm)=1;
0165     <span class="keyword">end</span>
0166   <span class="keyword">end</span>
0167 <span class="keyword">end</span>
0168 
0169 <span class="keyword">if</span> ~isempty(reaction_formula{1}),
0170   network.kinetics.type = <span class="string">'formula_strings'</span>;
0171   network.kinetics.reactions = {};
0172   all_parameters = {};
0173   <span class="keyword">for</span> it = 1:length(actions),
0174     network.kinetics.reactions{it}.string = strrep(reaction_math{it},<span class="string">'pow'</span>,<span class="string">'power'</span>);
0175     <span class="keyword">for</span> itt = 1:length(reaction_parameter{it}),
0176       this_parameter = reaction_parameter{it}(itt);
0177       network.kinetics.reactions{it}.parameters{itt}.name = this_parameter.id;
0178       network.kinetics.reactions{it}.parameters{itt}.value = this_parameter.value;
0179     <span class="keyword">end</span>
0180     <span class="keyword">if</span> length(reaction_parameter{it}),
0181       network.kinetics.reactions{it}.parameters = network.kinetics.reactions{it}.parameters';
0182       <span class="keyword">else</span>,
0183       network.kinetics.reactions{it}.parameters = {};
0184     <span class="keyword">end</span>
0185     <span class="keyword">end</span>
0186   network.kinetics.reactions = network.kinetics.reactions';
0187 <span class="keyword">end</span>
0188 
0189 
0190 <span class="keyword">if</span> ~isempty(reaction_formula{1}),
0191   z=1;
0192   network.kinetics.parameter_values = [];
0193   network.kinetics.parameters = [];
0194 
0195   <span class="keyword">for</span> it=1:length(network.actions),
0196     par = network.kinetics.reactions{it}.parameters;
0197     <span class="keyword">for</span> it2 = 1: length(par),
0198       network.kinetics.parameters{z}   = [<span class="string">'v'</span> num2str(it) <span class="string">'_'</span> par{it2}.name];
0199       network.kinetics.parameter_values(z)   = par{it2}.value;
0200       network.kinetics.reactions{it}.parameters{it2}.index = z;
0201       network.kinetics.reactions{it}.parameters{it2} = rmfield(network.kinetics.reactions{it}.parameters{it2},<span class="string">'value'</span>);
0202       z=z+1;
0203     <span class="keyword">end</span>
0204   <span class="keyword">end</span>
0205   network.kinetics.parameter_values = network.kinetics.parameter_values';
0206   network.kinetics.parameters = network.kinetics.parameters';
0207 <span class="keyword">else</span> fprintf(<span class="string">'Warning: no kinetics found in SBML file.\n'</span>);
0208 <span class="keyword">end</span> 
0209 
0210 <span class="keyword">if</span> exist(<span class="string">'s_init'</span>,<span class="string">'var'</span>), network.s_init       = s_init; 
0211 <span class="keyword">else</span>,
0212 <span class="keyword">if</span> exist(<span class="string">'a_init'</span>,<span class="string">'var'</span>), network.s_init       = a_init; <span class="keyword">end</span>
0213 <span class="keyword">end</span>
0214 
0215 <span class="keyword">if</span> graphics_flag,
0216   <span class="keyword">if</span> length(network.actions),
0217     netgraph_draw(network);
0218   <span class="keyword">end</span>
0219 <span class="keyword">end</span>
0220 
0221 
0222 <span class="comment">% --------------------------------------------------------------</span>
0223 
0224 <span class="comment">%if create_annotations,</span>
0225 
0226 <span class="comment">%for it=1:length(network.metabolites),</span>
0227 <span class="comment">%  network.metabolite_annotation{it}.object      = network.metabolites{it};</span>
0228 <span class="comment">%  network.metabolite_annotation{it}.is_reaction = 0;</span>
0229 <span class="comment">%  network.metabolite_annotation{it}.quantity    = 'concentration';</span>
0230 <span class="comment">%  network.metabolite_annotation{it}.unit        = 'mM';</span>
0231 <span class="comment">%end</span>
0232 
0233 <span class="comment">%for it=1:length(network.actions),</span>
0234 <span class="comment">%  network.action_annotation{it}.object        = network.actions{it};</span>
0235 <span class="comment">%  network.action_annotation{it}.is_reaction   =  1;</span>
0236 <span class="comment">%  network.action_annotation{it}.quantity      = 'flux';</span>
0237 <span class="comment">%  network.action_annotation{it}.unit          = 'mM/min';</span>
0238 <span class="comment">%end</span>
0239 
0240 <span class="comment">%if ~isempty(reaction_formula),</span>
0241 <span class="comment">%  z=1;</span>
0242 <span class="comment">%  for it=1:length(network.actions),</span>
0243 <span class="comment">%    par = network.kinetics.reactions{it}.parameters;</span>
0244 <span class="comment">%    for it2 = 1: length(par),</span>
0245 <span class="comment">%    network.parameter_annotation{z}.quantity      = 'reaction parameter';</span>
0246 <span class="comment">%    network.parameter_annotation{it}.is_reaction  = 0;</span>
0247 <span class="comment">%    network.parameter_annotation{it}.unit         = 'unknown';</span>
0248 <span class="comment">%    network.parameter_annotation{z}.object        = par{it2}.name;</span>
0249 <span class="comment">%    network.parameter_annotation{z}.value         = par{it2}.value;</span>
0250 <span class="comment">%    network.parameter_annotation{z}.appears_in_reaction = it;</span>
0251 <span class="comment">%    z=z+1;</span>
0252 <span class="comment">%    end</span>
0253 <span class="comment">%  end</span>
0254 <span class="comment">%end</span></pre></div>
<hr><address>Generated on Fri 05-Apr-2013 15:19:47 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>