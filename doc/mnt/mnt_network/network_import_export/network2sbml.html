<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of network2sbml</title>
  <meta name="keywords" content="network2sbml">
  <meta name="description" content="string = network2sbml(network,verbose,name,filename,write_equilibrium_constants)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="#">mnt</a> &gt; <a href="#">mnt_network</a> &gt; <a href="#">network_import_export</a> &gt; network2sbml.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for ./mnt/mnt_network/network_import_export&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>network2sbml
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>string = network2sbml(network,verbose,name,filename,write_equilibrium_constants)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function s = network2sbml(network,verbose,name,filename,write_equilibrium_constants) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">string = network2sbml(network,verbose,name,filename,write_equilibrium_constants)

export network to SBML string or SBML file (only SBML level 2)

This script does not depend on libSBML and SBML toolbox

ATTENTION: 
 1. Reaction kinetics are only written if the kinetics 
    is of type 'numeric' or 'mass-action'
 2. Names of reactions and metabolites may be altered
    in order to conform to valid XML syntax

ARGUMENTS
 network   (network structure)
 name      (string, optional, can be set '') model name
 filename  (string, optional) if this argument is given,
                              the sbml string is written to a file</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../.././mnt/mnt_kinetics/kinetics/kinetics_string.html" class="code" title="function s = kinetics_string(kinetics,n,actions,network)">kinetics_string</a>	s = kinetics_string(kinetics,n,actions,network)</li><li><a href="../../.././mnt/utils/default.html" class="code" title="function commandstring = default(varargin)">default</a>	commandstring = default(varname1,defaultvalue1,varname2,defaultvalue2,...)</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%string = network2sbml(network,verbose,name,filename,write_equilibrium_constants)</span>
0002 <span class="comment">%</span>
0003 <span class="comment">%export network to SBML string or SBML file (only SBML level 2)</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%This script does not depend on libSBML and SBML toolbox</span>
0006 <span class="comment">%</span>
0007 <span class="comment">%ATTENTION:</span>
0008 <span class="comment">% 1. Reaction kinetics are only written if the kinetics</span>
0009 <span class="comment">%    is of type 'numeric' or 'mass-action'</span>
0010 <span class="comment">% 2. Names of reactions and metabolites may be altered</span>
0011 <span class="comment">%    in order to conform to valid XML syntax</span>
0012 <span class="comment">%</span>
0013 <span class="comment">%ARGUMENTS</span>
0014 <span class="comment">% network   (network structure)</span>
0015 <span class="comment">% name      (string, optional, can be set '') model name</span>
0016 <span class="comment">% filename  (string, optional) if this argument is given,</span>
0017 <span class="comment">%                              the sbml string is written to a file</span>
0018 
0019 <a name="_sub0" href="#_subfunctions" class="code">function s = network2sbml(network,verbose,name,filename,write_equilibrium_constants)</a>
0020 
0021 eval(<a href="../../.././mnt/utils/default.html" class="code" title="function commandstring = default(varargin)">default</a>(<span class="string">'write_equilibrium_constants'</span>,<span class="string">'0'</span>));
0022 <span class="keyword">if</span> exist(<span class="string">'metnames'</span>,<span class="string">'var'</span>), network.metabolites = metnames;     <span class="keyword">end</span>
0023 <span class="keyword">if</span> ~exist(<span class="string">'verbose'</span>,<span class="string">'var'</span>),    verbose = 0;       <span class="keyword">end</span>
0024 <span class="keyword">if</span> ~exist(<span class="string">'name'</span>,<span class="string">'var'</span>), name    = <span class="string">''</span>;      <span class="keyword">end</span>
0025 <span class="keyword">if</span> isempty(<span class="string">'name'</span>),      name    = <span class="string">'Model'</span>; <span class="keyword">end</span> 
0026 <span class="keyword">if</span> ~exist(<span class="string">'filename'</span>,<span class="string">'var'</span>),filename = []; <span class="keyword">end</span> 
0027 
0028 <span class="keyword">if</span> write_equilibrium_constants,
0029   kEQ_found = 0;
0030   <span class="keyword">if</span> isfield(network,<span class="string">'kinetics'</span>),
0031     <span class="keyword">if</span> isfield(network.kinetics,<span class="string">'Keq'</span>),
0032       kEQ_found = 1;
0033     <span class="keyword">end</span>
0034   <span class="keyword">end</span>  
0035   <span class="keyword">if</span> ~kEQ_found,
0036     warning(<span class="string">'No equilibrium constants found; inventing equilibrium constants'</span>);
0037   <span class="keyword">end</span>
0038 <span class="keyword">end</span>
0039 
0040 [nm,nr] = size(network.N);
0041 
0042 
0043 <span class="comment">% ----------------------------------------------------------------</span>
0044 <span class="comment">% prepare model: adjust names to valid XML syntax</span>
0045 
0046 name = strrep(name,<span class="string">' '</span>,<span class="string">'_'</span>);
0047 
0048 <span class="keyword">for</span> it=1:nm,
0049   network.metabolites{it} = strrep(network.metabolites{it},<span class="string">'-'</span>,<span class="string">'_'</span>);
0050   network.metabolites{it} = strrep(network.metabolites{it},<span class="string">':'</span>,<span class="string">'_'</span>);
0051   network.metabolites{it} = strrep(network.metabolites{it},<span class="string">','</span>,<span class="string">'_'</span>);
0052   network.metabolites{it} = strrep(network.metabolites{it},<span class="string">'.'</span>,<span class="string">'_'</span>);
0053   network.metabolites{it} = strrep(network.metabolites{it},<span class="string">' '</span>,<span class="string">'_'</span>);
0054   network.metabolites{it} = strrep(network.metabolites{it},<span class="string">'+'</span>,<span class="string">'plus'</span>);
0055   network.metabolites{it} = strrep(network.metabolites{it},<span class="string">'('</span>,<span class="string">'_'</span>);
0056   network.metabolites{it} = strrep(network.metabolites{it},<span class="string">')'</span>,<span class="string">'_'</span>);
0057   network.metabolites{it} = strrep(network.metabolites{it},<span class="string">'&lt;'</span>,<span class="string">'_'</span>);
0058   network.metabolites{it} = strrep(network.metabolites{it},<span class="string">'['</span>,<span class="string">'_'</span>);  
0059   network.metabolites{it} = strrep(network.metabolites{it},<span class="string">']'</span>,<span class="string">'_'</span>);
0060   network.metabolites{it} = strrep(network.metabolites{it},<span class="string">'__'</span>,<span class="string">'_'</span>);
0061 
0062 <span class="comment">%  network.metabolites{it} = strrep(network.metabolites{it},'_','');</span>
0063 
0064   metabolite_id{it} = network.metabolites{it};
0065   
0066   <span class="keyword">if</span> length(strfind(<span class="string">'0123456789'</span>,network.metabolites{it}(1)))
0067     metabolite_id{it} = [<span class="string">'_'</span> metabolite_id{it}];
0068   <span class="keyword">end</span>
0069   
0070 <span class="keyword">end</span>
0071 
0072 <span class="keyword">for</span> it=1:nr,
0073   network.actions{it} = strrep(network.actions{it},<span class="string">' '</span>,<span class="string">'_'</span>);
0074   network.actions{it} = strrep(network.actions{it},<span class="string">'='</span>,<span class="string">'-'</span>);
0075   network.actions{it} = strrep(network.actions{it},<span class="string">'&lt;-&gt;'</span>,<span class="string">'_rev_'</span>);
0076   network.actions{it} = strrep(network.actions{it},<span class="string">'-&gt;'</span>,<span class="string">'_irrev_'</span>);
0077   network.actions{it} = strrep(network.actions{it},<span class="string">':'</span>,<span class="string">'-'</span>);
0078   network.actions{it} = strrep(network.actions{it},<span class="string">'-'</span>,<span class="string">'_'</span>);
0079   network.actions{it} = strrep(network.actions{it},<span class="string">','</span>,<span class="string">'_'</span>);
0080   network.actions{it} = strrep(network.actions{it},<span class="string">'.'</span>,<span class="string">'_'</span>);
0081   network.actions{it} = strrep(network.actions{it},<span class="string">'('</span>,<span class="string">'_'</span>);
0082   network.actions{it} = strrep(network.actions{it},<span class="string">')'</span>,<span class="string">'_'</span>);
0083   network.actions{it} = strrep(network.actions{it},<span class="string">'.'</span>,<span class="string">'_'</span>);
0084   network.actions{it} = strrep(network.actions{it},<span class="string">'+'</span>,<span class="string">'plus'</span>);
0085 <span class="keyword">end</span>
0086 
0087 <span class="comment">% if names are not unique:</span>
0088 
0089 <span class="keyword">if</span> length(unique(network.metabolites))&lt;nm,
0090  <span class="keyword">for</span> it=1:nm, 
0091   network.metabolites{it} = [<span class="string">'M'</span> num2str(it) <span class="string">'_'</span> network.metabolites{it}];
0092  <span class="keyword">end</span>
0093 <span class="keyword">end</span>
0094 
0095 <span class="keyword">if</span> length(unique(network.actions))&lt;nr,
0096   <span class="keyword">for</span> it=1:nr, 
0097     network.actions{it} = [<span class="string">'A'</span> num2str(it) <span class="string">'_'</span> network.actions{it}];
0098   <span class="keyword">end</span>
0099 <span class="keyword">end</span>
0100 
0101 
0102 <span class="comment">% ----------------------------------------------------------------</span>
0103 <span class="comment">% create SBML</span>
0104 
0105 <span class="comment">% header</span>
0106 
0107 s = sprintf(<span class="string">'&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n'</span>); 
0108 s = [s sprintf(<span class="string">'&lt;sbml xmlns=&quot;http://www.sbml.org/sbml/level2/version3&quot; level=&quot;2&quot; version=&quot;3&quot;&gt;\n'</span>)]; 
0109 s = [s sprintf(<span class="string">'  &lt;model name=&quot;%s&quot;&gt;\n'</span>,name)]; 
0110 
0111 <span class="comment">% notes</span>
0112 
0113 <span class="keyword">if</span> verbose,
0114   s = [s sprintf(<span class="string">'    &lt;notes&gt;\n'</span>)]; 
0115   s = [s sprintf(<span class="string">'      &lt;body xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;\n'</span>)]; 
0116   s = [s sprintf(<span class="string">'        &lt;p&gt;Network model %s written by the Matlab Metabolic Network Package&lt;/p&gt;\n'</span>,name)]; 
0117   s = [s sprintf(<span class="string">'      &lt;/body&gt;\n'</span>)]; 
0118   s = [s sprintf(<span class="string">'    &lt;/notes&gt;\n'</span>)]; 
0119 <span class="keyword">end</span>
0120 
0121 <span class="comment">% compartments</span>
0122 
0123 s = [s sprintf(<span class="string">'    &lt;listOfCompartments&gt;\n'</span>)]; 
0124 s = [s sprintf(<span class="string">'      &lt;compartment id=&quot;compartment&quot; name=&quot;compartment&quot; size=&quot;1&quot;/&gt;\n'</span>)]; 
0125 s = [s sprintf(<span class="string">'    &lt;/listOfCompartments&gt;\n'</span>)]; 
0126 
0127 <span class="comment">% species</span>
0128 
0129 <span class="keyword">if</span> isfield(network,<span class="string">'s_init'</span>),  
0130   initial_amount = network.s_init;
0131 <span class="keyword">else</span>,
0132   initial_amount = zeros(nm,1);
0133 <span class="keyword">end</span>
0134 
0135 s = [s sprintf(<span class="string">'    &lt;listOfSpecies&gt;\n'</span>)]; 
0136 <span class="keyword">for</span> it = 1:nm,
0137   s = [s sprintf(<span class="string">'      &lt;species id=&quot;%s&quot; name=&quot;%s&quot; '</span>, metabolite_id{it}, network.metabolites{it})]; 
0138   s = [s sprintf(<span class="string">'initialAmount=&quot;%d&quot; '</span>,initial_amount(it))];  
0139   s = [s sprintf(<span class="string">'compartment=&quot;compartment&quot; '</span>)];
0140   s = [s sprintf(<span class="string">'boundaryCondition=&quot;false&quot; '</span>)];
0141   <span class="keyword">if</span> verbose,
0142     s = [s sprintf(<span class="string">'&gt;\n      &lt;notes&gt;  &lt;body xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt; Metabolite %s &lt;/body&gt; &lt;/notes&gt;\n    &lt;/species&gt;\n'</span>,network.metabolites{it})]; 
0143   <span class="keyword">else</span>,
0144     s = [s sprintf(<span class="string">'/&gt;\n'</span>)];
0145   <span class="keyword">end</span>
0146 <span class="keyword">end</span>
0147 s = [s sprintf(<span class="string">'    &lt;/listOfSpecies&gt;\n'</span>)]; 
0148 
0149 
0150 <span class="comment">% reactions</span>
0151 
0152 s = [s sprintf(<span class="string">'    &lt;listOfReactions&gt;\n'</span>)]; 
0153 
0154 <span class="keyword">for</span> it = 1:nr,
0155 
0156   <span class="keyword">if</span> network.reversible(it),  revstring = <span class="string">'true'</span>;  <span class="keyword">else</span>, revstring = <span class="string">'false'</span>;  <span class="keyword">end</span>
0157   s = [s sprintf(<span class="string">'      &lt;reaction id=&quot;%s&quot; name=&quot;%s&quot; reversible=&quot;%s&quot;&gt;\n'</span>,network.actions{it},network.actions{it},revstring)]; 
0158   <span class="keyword">if</span> verbose,
0159     <span class="keyword">if</span> isfield(network, <span class="string">'kinetics'</span>),
0160       s = [s sprintf(<span class="string">'        &lt;notes&gt;  &lt;body xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt; %s &lt;/body&gt; &lt;/notes&gt;\n'</span>,<a href="../../.././mnt/mnt_kinetics/kinetics/kinetics_string.html" class="code" title="function s = kinetics_string(kinetics,n,actions,network)">kinetics_string</a>(network.kinetics,it,[],network))]; 
0161     <span class="keyword">else</span>, 
0162       s = [s sprintf(<span class="string">'        &lt;notes&gt;  &lt;body xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt; &lt;/body&gt; &lt;/notes&gt;\n'</span>)]; 
0163     <span class="keyword">end</span>
0164   <span class="keyword">end</span>
0165 
0166   sub_ind = find(network.N(:,it)&lt;0); 
0167   <span class="keyword">if</span> length(sub_ind),
0168     s = [s sprintf(<span class="string">'        &lt;listOfReactants&gt;\n'</span>)]; 
0169     <span class="keyword">for</span> itt = 1:length(sub_ind),
0170       s = [s sprintf(<span class="string">'          &lt;speciesReference species=&quot;%s&quot; stoichiometry=&quot;%d&quot;/&gt;\n'</span>,metabolite_id{sub_ind(itt)},full(abs(network.N(sub_ind(itt),it))))];     
0171     <span class="keyword">end</span>
0172     s = [s sprintf(<span class="string">'        &lt;/listOfReactants&gt;\n'</span>)]; 
0173   <span class="keyword">end</span>
0174   
0175   sub_ind = find(network.N(:,it)&gt;0);
0176   <span class="keyword">if</span> length(sub_ind),
0177     s = [s sprintf(<span class="string">'        &lt;listOfProducts&gt;\n'</span>)]; 
0178     <span class="keyword">for</span> itt = 1:length(sub_ind),
0179       s = [s sprintf(<span class="string">'          &lt;speciesReference species=&quot;%s&quot; stoichiometry=&quot;%d&quot;/&gt;\n'</span>,metabolite_id{sub_ind(itt)},full(network.N(sub_ind(itt),it)))];     
0180     <span class="keyword">end</span>
0181     s = [s sprintf(<span class="string">'        &lt;/listOfProducts&gt;\n'</span>)]; 
0182   <span class="keyword">end</span>
0183 
0184  <span class="keyword">if</span> write_equilibrium_constants,
0185      
0186      s = [s sprintf(<span class="string">'        &lt;kineticLaw&gt;\n'</span>)]; 
0187      s = [s sprintf(<span class="string">'          &lt;listOfParameters&gt;\n'</span>)];
0188      Keq = network.kinetics.Keq(it);
0189      s = [s sprintf(<span class="string">'            &lt;parameter id=&quot;equilibrium_constant&quot; value=&quot;%f&quot;/&gt;\n'</span>,Keq)]; 
0190      s = [s sprintf(<span class="string">'          &lt;/listOfParameters&gt;\n'</span>)]; 
0191      s = [s sprintf(<span class="string">'        &lt;/kineticLaw&gt;\n'</span>)]; 
0192 <span class="keyword">end</span>
0193 
0194   s = [s sprintf(<span class="string">'      &lt;/reaction&gt;\n'</span>)]; 
0195 <span class="keyword">end</span>
0196 
0197 s = [s sprintf(<span class="string">'    &lt;/listOfReactions&gt;\n'</span>)]; 
0198 
0199 <span class="comment">% close SBML</span>
0200 
0201 s = [s sprintf(<span class="string">'  &lt;/model&gt;\n'</span>)]; 
0202 s = [s sprintf(<span class="string">'&lt;/sbml&gt;\n'</span>)]; 
0203 
0204 
0205 <span class="comment">%----------------------------------------------------------</span>
0206 <span class="comment">% write SBML to file</span>
0207 
0208 <span class="keyword">if</span> length(filename),
0209   fid = fopen(filename,<span class="string">'w'</span>);
0210   fprintf(fid,s);
0211   fclose(fid);
0212 <span class="keyword">end</span>
0213 
0214 
0215 <span class="comment">% switch network.kinetics.type,</span>
0216 <span class="comment">%   case 'kinetic_strings',</span>
0217 <span class="comment">%</span>
0218 <span class="comment">%     s = [s sprintf('        &lt;kineticLaw formula=&quot;%s&quot;&gt;\n',network.kinetics.reactions{it}.string)];</span>
0219 <span class="comment">%     s = [s sprintf('          &lt;listOfParameters&gt;\n')];</span>
0220 <span class="comment">%     parameters = network.kinetics.reactions{it}.parameters;</span>
0221 <span class="comment">%</span>
0222 <span class="comment">%     for itt = 1:length(parameters),</span>
0223 <span class="comment">%       s = [s sprintf('            &lt;parameter name=&quot;%s&quot; value=&quot;%d&quot;/&gt;\n',parameters{itt}.name,network.kinetics.parameter_values(parameters{itt}.index))];</span>
0224 <span class="comment">%     end</span>
0225 <span class="comment">%     s = [s sprintf('          &lt;/listOfParameters&gt;\n')];</span>
0226 <span class="comment">%     s = [s sprintf('        &lt;/kineticLaw&gt;\n')];</span>
0227 <span class="comment">%</span>
0228 <span class="comment">%   case 'mass-action',</span>
0229 <span class="comment">%</span>
0230 <span class="comment">%     substrate_ind = find(network.N(:,it)&lt;0);</span>
0231 <span class="comment">%     product_ind   = find(network.N(:,it)&gt;0);</span>
0232 <span class="comment">%</span>
0233 <span class="comment">%     substrates='';</span>
0234 <span class="comment">%     for itt = 1: length(substrate_ind),</span>
0235 <span class="comment">%       substrates = [substrates ' * ' network.metabolites{substrate_ind(itt)} ];</span>
0236 <span class="comment">%     end</span>
0237 <span class="comment">%     products='';</span>
0238 <span class="comment">%     for itt = 1: length(product_ind),</span>
0239 <span class="comment">%       products = [products ' * ' network.metabolites{product_ind(itt)} ];</span>
0240 <span class="comment">%     end</span>
0241 <span class="comment">%</span>
0242 <span class="comment">%     s = [s sprintf('        &lt;kineticLaw formula=&quot;kp%s - km%s&quot;&gt;\n',substrates, products  )];</span>
0243 <span class="comment">%     s = [s sprintf('          &lt;listOfParameters&gt;\n')];</span>
0244 <span class="comment">%     s = [s sprintf('            &lt;parameter name=&quot;kp&quot; value=&quot;%d&quot;/&gt;\n',network.kinetics.k_fwd(it))];</span>
0245 <span class="comment">%     s = [s sprintf('            &lt;parameter name=&quot;km&quot; value=&quot;%d&quot;/&gt;\n',network.kinetics.k_bwd(it))];</span>
0246 <span class="comment">%     s = [s sprintf('          &lt;/listOfParameters&gt;\n')];</span>
0247 <span class="comment">%     s = [s sprintf('        &lt;/kineticLaw&gt;\n')];</span>
0248 <span class="comment">%</span>
0249 <span class="comment">%   case 'standard',</span>
0250 <span class="comment">%     substrate_ind = find(network.N(:,it)&lt;0);</span>
0251 <span class="comment">%     product_ind   = find(network.N(:,it)&gt;0);</span>
0252 <span class="comment">%     substrates= network.metabolites(substrate_ind);</span>
0253 <span class="comment">%     products= network.metabolites(product_ind);</span>
0254 <span class="comment">%</span>
0255 <span class="comment">%     formula = get_formula(network.kinetics.reactions{it},substrates,products);</span>
0256 <span class="comment">%     s = [s sprintf('        &lt;kineticLaw formula=&quot;%s&quot;&gt;\n',formula)];</span>
0257 <span class="comment">%     s = [s sprintf('          &lt;listOfParameters&gt;\n')];</span>
0258 <span class="comment">%     parameters = network.kinetics.reactions{it}.parameters;</span>
0259 <span class="comment">%</span>
0260 <span class="comment">%     for itt = 1:length(parameters),</span>
0261 <span class="comment">%       s = [s sprintf('            &lt;parameter name=&quot;%s&quot; value=&quot;%d&quot;/&gt;\n',parameters{itt},getfield(network.kinetics.reactions{it},parameters{itt}))];</span>
0262 <span class="comment">%     end</span>
0263 <span class="comment">%     s = [s sprintf('          &lt;/listOfParameters&gt;\n')];</span>
0264 <span class="comment">%     s = [s sprintf('        &lt;/kineticLaw&gt;\n')];</span>
0265 <span class="comment">% end</span></pre></div>
<hr><address>Generated on Sat 15-Nov-2014 18:05:26 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>