<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of network_sbml_export</title>
  <meta name="keywords" content="network_sbml_export">
  <meta name="description" content="SBMLmodel = network_sbml_export(network, verbose, name, filename, notes, sbml_level, sbml_version)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="#">mnt</a> &gt; <a href="#">mnt_network</a> &gt; <a href="#">network_import_export</a> &gt; network_sbml_export.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for ./mnt/mnt_network/network_import_export&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>network_sbml_export
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>SBMLmodel = network_sbml_export(network, verbose, name, filename, notes, sbml_level, sbml_version)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function SBMLmodel = network_sbml_export(network,verbose,name,filename,notes,sbml_level,sbml_version) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> SBMLmodel = network_sbml_export(network, verbose, name, filename, notes, sbml_level, sbml_version)
 
 Export network (data type from mnt) to libSBML's SBMLModel data type
 
 ARGUMENTS
  network   (network structure) network
  name      (string, optional)  model name
  notes     (string, optional)
 
 If the argument filename (string) is given, the model is directly written 
 to an SBML (.xml) file (in the present directory; no path can be given)
 
 You can also use SaveSBMLModel(SBMLmodel) from the SBMLToolbox
 to save the model to a .mat file, or OutputSBML(SBMLmodel,filename);
 to export it to an SBML (.xml) file
 
 This function requires the SBMLToolbox (see http://sbml.org/software/sbmltoolbox/)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../.././mnt/mnt_kinetics/modular_rate_laws/cs_rate_law/cs_get_formula.html" class="code" title="function formula = cs_get_formula(r_name,mn,sub,pro,act,inh,m_sub,m_pro)">cs_get_formula</a>	r_name reaction name (for naming the parameters)</li><li><a href="../../.././mnt/mnt_kinetics/modular_rate_laws/modular_rate_law_functions/parameter_conversion/ms_KM_KVratio_to_Keq.html" class="code" title="function keq = ms_KM_KVratio_to_Keq(N,KM,KVratio);">ms_KM_KVratio_to_Keq</a>	keq = ms_KM_KVratio_to_Keq(N,KM,KVratio);</li><li><a href="../../.././mnt/mnt_kinetics/modular_rate_laws/ms_rate_law/ms_get_formula.html" class="code" title="function formula = ms_get_formula(r_name,mn,sub,pro,act,inh,m_sub,m_pro)">ms_get_formula</a>	formula = ms_get_formula(r_name,mn,sub,pro,act,inh,m_sub,m_pro)</li><li><a href="network_adjust_names_for_sbml_export.html" class="code" title="function [metabolites,actions] = network_adjust_names_for_sbml_export(metabolites,actions)">network_adjust_names_for_sbml_export</a>	[metabolites,actions] = network_adjust_names_for_sbml_export(metabolites,actions)</li><li><a href="../../.././mnt/utils/default.html" class="code" title="function commandstring = default(varargin)">default</a>	commandstring = default(varname1,defaultvalue1,varname2,defaultvalue2,...)</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../.././demo/mnt_demo.html" class="code" title="">mnt_demo</a>	</li></ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">% SBMLmodel = network_sbml_export(network, verbose, name, filename, notes, sbml_level, sbml_version)</span>
0002 <span class="comment">%</span>
0003 <span class="comment">% Export network (data type from mnt) to libSBML's SBMLModel data type</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% ARGUMENTS</span>
0006 <span class="comment">%  network   (network structure) network</span>
0007 <span class="comment">%  name      (string, optional)  model name</span>
0008 <span class="comment">%  notes     (string, optional)</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% If the argument filename (string) is given, the model is directly written</span>
0011 <span class="comment">% to an SBML (.xml) file (in the present directory; no path can be given)</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% You can also use SaveSBMLModel(SBMLmodel) from the SBMLToolbox</span>
0014 <span class="comment">% to save the model to a .mat file, or OutputSBML(SBMLmodel,filename);</span>
0015 <span class="comment">% to export it to an SBML (.xml) file</span>
0016 <span class="comment">%</span>
0017 <span class="comment">% This function requires the SBMLToolbox (see http://sbml.org/software/sbmltoolbox/)</span>
0018 
0019 
0020 <a name="_sub0" href="#_subfunctions" class="code">function SBMLmodel = network_sbml_export(network,verbose,name,filename,notes,sbml_level,sbml_version)</a>
0021 
0022 <span class="keyword">if</span> ~exist(<span class="string">'TranslateSBML'</span>,<span class="string">'file'</span>),
0023   error(<span class="string">'Please install the SBML Toolbox (http://sbml.org/Software/SBMLToolbox) - Otherwise the  SBML import/export functions do not work.'</span>);
0024 <span class="keyword">end</span>
0025 
0026 eval(<a href="../../.././mnt/utils/default.html" class="code" title="function commandstring = default(varargin)">default</a>(<span class="string">'verbose'</span>,<span class="string">'0'</span>,<span class="string">'name'</span>,<span class="string">'''Model'''</span>,<span class="string">'notes'</span>,<span class="string">''''''</span>,<span class="string">'sbml_level'</span>,<span class="string">'2'</span>,<span class="string">'sbml_version'</span>,<span class="string">'2'</span>));
0027 
0028 name = strrep(name,<span class="string">' '</span>,<span class="string">'_'</span>);
0029 name = strrep(name,<span class="string">'.'</span>,<span class="string">'_'</span>);
0030 
0031 
0032 <span class="comment">% -------------------------------------------------------------</span>
0033 <span class="comment">% Adjust names to SBML conventions</span>
0034 
0035 [network.metabolites,network.actions] = <a href="network_adjust_names_for_sbml_export.html" class="code" title="function [metabolites,actions] = network_adjust_names_for_sbml_export(metabolites,actions)">network_adjust_names_for_sbml_export</a>(network.metabolites,network.actions);
0036 
0037 <span class="keyword">for</span> it=1:length(network.metabolites),
0038   metabolite_id{it,1}       = network.metabolites{it};
0039 <span class="keyword">end</span>
0040 
0041 <span class="keyword">if</span> length(network.metabolites) ~= length(unique(network.metabolites)),
0042   warning(<span class="string">'Error in conversion of metabolite names'</span>);
0043   <span class="keyword">for</span> it=1:length(network.metabolites), 
0044     network.metabolites{it} = [<span class="string">'M'</span> num2str(it) <span class="string">'_'</span> network.metabolites{it}];
0045   <span class="keyword">end</span>
0046 <span class="keyword">end</span>
0047 
0048 <span class="keyword">if</span> length(unique(network.actions))&lt;length(network.actions),
0049   <span class="keyword">for</span> it=1:length(network.actions), 
0050     network.actions{it} = [<span class="string">'A'</span> num2str(it) <span class="string">'_'</span> network.actions{it}];
0051   <span class="keyword">end</span>
0052 <span class="keyword">end</span>
0053 
0054 
0055 <span class="comment">% -------------------------------------------------------------</span>
0056 <span class="comment">% SBML object</span>
0057 
0058 
0059 SBMLmodel = Model_create(sbml_level,sbml_version);
0060 SBMLmodel = Model_setName(SBMLmodel,name);
0061 SBMLmodel = Model_setId(SBMLmodel,name);
0062 
0063 compartment = Compartment_create(sbml_level,sbml_version);
0064 compartment = Compartment_setId(compartment,<span class="string">'compartment'</span>);
0065 compartment = Compartment_setName(compartment,<span class="string">'compartment'</span>);
0066 <span class="keyword">if</span> sbml_level &gt;2,
0067   compartment = Compartment_setVolume(compartment,1);
0068 <span class="keyword">end</span>
0069 SBMLmodel   = Model_addCompartment(SBMLmodel,compartment);
0070 
0071 <span class="comment">% notes</span>
0072 <span class="comment">% Model %s written by the Metabolic Network Toolbox&lt;/p&gt;\n',name)];</span>
0073 
0074 
0075 <span class="comment">% ----------------------------------------------------------------</span>
0076 <span class="comment">% metabolites</span>
0077 
0078 <span class="keyword">if</span> verbose, fprintf(<span class="string">'  Converting the metabolites: '</span>); <span class="keyword">end</span>
0079 
0080 <span class="keyword">for</span> it = 1:length(network.metabolites),
0081   <span class="keyword">if</span> verbose,  fprintf(<span class="string">'%d '</span>,it); <span class="keyword">end</span> 
0082   species{it} = Species_create(sbml_level,sbml_version);
0083   species{it} = Species_setId(species{it},metabolite_id{it});
0084   species{it} = Species_setName(species{it},network.metabolites{it});
0085   species{it} = Species_setCompartment(species{it},<span class="string">'compartment'</span>);
0086   <span class="keyword">if</span> sbml_level &gt;2,
0087     species{it} = Species_setUnits(species{it},<span class="string">'mmol/l'</span>);
0088   <span class="keyword">end</span>
0089   species{it} = Species_setBoundaryCondition(species{it},double(network.external(it)));
0090   <span class="keyword">if</span> isfield(network,<span class="string">'s_init'</span>),  
0091     species{it} = Species_setInitialConcentration(species{it},network.s_init(it));
0092   <span class="keyword">else</span>,
0093     species{it} = Species_setInitialConcentration(species{it},0);
0094   <span class="keyword">end</span>
0095 <span class="keyword">end</span>
0096 
0097 
0098 <span class="comment">% ----------------------------------------------------------------</span>
0099 <span class="comment">% kinetic laws</span>
0100 
0101 <span class="keyword">if</span> isfield(network,<span class="string">'kinetics'</span>),
0102   <span class="keyword">switch</span> network.kinetics.type,
0103 
0104     <span class="keyword">case</span> {<span class="string">'ms'</span>,<span class="string">'cs'</span>,<span class="string">'ds'</span>,<span class="string">'rp'</span>},    
0105       
0106       <span class="keyword">for</span> it = 1:length(network.metabolites),
0107         species{it} = Species_setInitialConcentration(species{it},network.kinetics.c(it));
0108       <span class="keyword">end</span>
0109 
0110       metnames = network.metabolites;      
0111       kk       = network.kinetics;
0112 
0113       <span class="keyword">if</span> verbose, fprintf(<span class="string">'\n  Converting the rate laws: '</span>); <span class="keyword">end</span>
0114 
0115       <span class="keyword">for</span> it = 1:length(network.actions),
0116 
0117       <span class="keyword">if</span> verbose, fprintf(<span class="string">'%d '</span>,it); <span class="keyword">end</span>
0118 
0119         r_name = [<span class="string">'R'</span> num2str(it) ];
0120         
0121         sub = find(network.N(:,it) &lt; 0);
0122         pro = find(network.N(:,it) &gt; 0);
0123         rea = find(kk.KM(it,:)~=0);
0124         act = find(kk.KA(it,:)~=0);
0125         inh = find(kk.KI(it,:)~=0);
0126         
0127         m_sub           = abs(network.N(sub,it));
0128         m_pro           = abs(network.N(pro,it));
0129         
0130         <span class="keyword">switch</span> network.kinetics.type,
0131           <span class="keyword">case</span> <span class="string">'ms'</span>,
0132             formula    = <a href="../../.././mnt/mnt_kinetics/modular_rate_laws/ms_rate_law/ms_get_formula.html" class="code" title="function formula = ms_get_formula(r_name,mn,sub,pro,act,inh,m_sub,m_pro)">ms_get_formula</a>(r_name,metnames,sub,pro,act,inh,m_sub,m_pro); 
0133             kk.KVratio = <a href="../../.././mnt/mnt_kinetics/modular_rate_laws/modular_rate_law_functions/parameter_conversion/ms_KM_KVratio_to_Keq.html" class="code" title="function keq = ms_KM_KVratio_to_Keq(N,KM,KVratio);">ms_KM_KVratio_to_Keq</a>(network.N,kk.KM,kk.Keq);
0134           <span class="keyword">case</span> <span class="string">'cs'</span>,
0135             formula    = <a href="../../.././mnt/mnt_kinetics/modular_rate_laws/cs_rate_law/cs_get_formula.html" class="code" title="function formula = cs_get_formula(r_name,mn,sub,pro,act,inh,m_sub,m_pro)">cs_get_formula</a>(r_name,metnames,sub,pro,act,inh,m_sub,m_pro); 
0136             kk.KVratio = <a href="../../.././mnt/mnt_kinetics/modular_rate_laws/modular_rate_law_functions/parameter_conversion/ms_KM_KVratio_to_Keq.html" class="code" title="function keq = ms_KM_KVratio_to_Keq(N,KM,KVratio);">ms_KM_KVratio_to_Keq</a>(network.N,kk.KM,kk.Keq);
0137           <span class="keyword">case</span> <span class="string">'rp'</span>,
0138             formula    = <a href="../../.././mnt/mnt_kinetics/modular_rate_laws/ms_rate_law/ms_get_formula.html" class="code" title="function formula = ms_get_formula(r_name,mn,sub,pro,act,inh,m_sub,m_pro)">ms_get_formula</a>(r_name,metnames,sub,pro,act,inh,m_sub,m_pro); 
0139             kk.KVratio = <a href="../../.././mnt/mnt_kinetics/modular_rate_laws/modular_rate_law_functions/parameter_conversion/ms_KM_KVratio_to_Keq.html" class="code" title="function keq = ms_KM_KVratio_to_Keq(N,KM,KVratio);">ms_KM_KVratio_to_Keq</a>(network.N,kk.KM,kk.Keq);
0140           <span class="keyword">case</span> <span class="string">'ds'</span>,
0141             formula    = <a href="../../.././mnt/mnt_kinetics/modular_rate_laws/cs_rate_law/cs_get_formula.html" class="code" title="function formula = cs_get_formula(r_name,mn,sub,pro,act,inh,m_sub,m_pro)">cs_get_formula</a>(r_name,metnames,sub,pro,act,inh,m_sub,m_pro); 
0142             kk.KVratio = <a href="../../.././mnt/mnt_kinetics/modular_rate_laws/modular_rate_law_functions/parameter_conversion/ms_KM_KVratio_to_Keq.html" class="code" title="function keq = ms_KM_KVratio_to_Keq(N,KM,KVratio);">ms_KM_KVratio_to_Keq</a>(network.N,kk.KM,kk.Keq);
0143         <span class="keyword">end</span>
0144         
0145     kinetic_law{it} = KineticLaw_create(sbml_level,sbml_version);
0146     kinetic_law{it} = KineticLaw_setFormula(kinetic_law{it}, formula);
0147     kinetic_law{it} = KineticLaw_setMathFromFormula(kinetic_law{it});
0148 
0149         parameter       = Parameter_create(sbml_level,sbml_version);
0150         parameter       = Parameter_setName(parameter, [<span class="string">'u_'</span> r_name ]);
0151         parameter       = Parameter_setId(  parameter, [<span class="string">'u_'</span> r_name ]);
0152         parameter       = Parameter_setValue(parameter,kk.u(it));
0153         parameter       = Parameter_setConstant(parameter,1);
0154         <span class="keyword">if</span> sbml_level &gt;2,
0155           parameter     = Parameter_setUnits(parameter,<span class="string">'mmol/l'</span>);
0156         <span class="keyword">end</span>
0157         kinetic_law{it} = KineticLaw_addParameter(kinetic_law{it}, parameter);        
0158         
0159         parameter       = Parameter_create(sbml_level,sbml_version);
0160         parameter       = Parameter_setName(parameter, [<span class="string">'kC_'</span> r_name ]);
0161         parameter       = Parameter_setId(  parameter, [<span class="string">'kC_'</span> r_name ]);
0162         parameter       = Parameter_setValue(parameter,kk.KV(it));
0163         parameter       = Parameter_setConstant(parameter,1);
0164         <span class="keyword">if</span> sbml_level &gt;2,
0165           parameter     = Parameter_setUnits(parameter,<span class="string">'1/s'</span>);         
0166         <span class="keyword">end</span>        
0167         kinetic_law{it} = KineticLaw_addParameter(kinetic_law{it}, parameter);        
0168 
0169         parameter       = Parameter_create(sbml_level,sbml_version);
0170         parameter       = Parameter_setName(parameter, [<span class="string">'kEQ_'</span> r_name ]);
0171         parameter       = Parameter_setId(  parameter, [<span class="string">'kEQ_'</span> r_name ]);
0172         parameter       = Parameter_setValue(parameter,kk.Keq(it));
0173         parameter       = Parameter_setConstant(parameter,1);
0174         kinetic_law{it} = KineticLaw_addParameter(kinetic_law{it}, parameter);        
0175         
0176     <span class="keyword">for</span> itt = 1:length(rea),
0177           parameter       = Parameter_create(sbml_level,sbml_version);
0178           parameter       = Parameter_setName(parameter, [<span class="string">'kM_'</span> r_name <span class="string">'_'</span> metnames{rea(itt)} ]);
0179           parameter       = Parameter_setId(  parameter, [<span class="string">'kM_'</span> r_name <span class="string">'_'</span> metnames{rea(itt)} ]);
0180           parameter       = Parameter_setValue(parameter,kk.KM(it,rea(itt)));
0181           parameter       = Parameter_setConstant(parameter,1);
0182         <span class="keyword">if</span> sbml_level &gt;2,
0183           parameter       = Parameter_setUnits(parameter,<span class="string">'mmol/l'</span>);        
0184         <span class="keyword">end</span>
0185         kinetic_law{it} = KineticLaw_addParameter(kinetic_law{it}, parameter);        
0186         <span class="keyword">end</span>
0187 
0188         <span class="keyword">for</span> itt = 1:length(act),
0189           parameter       = Parameter_create(sbml_level,sbml_version);
0190           parameter       = Parameter_setName(parameter, [<span class="string">'kA_'</span> r_name <span class="string">'_'</span> metnames{act(itt)} ]);
0191           parameter       = Parameter_setId(  parameter, [<span class="string">'kA_'</span> r_name <span class="string">'_'</span> metnames{act(itt)} ]);
0192           parameter       = Parameter_setValue(parameter,kk.KA(it,act(itt)));
0193           parameter       = Parameter_setConstant(parameter,1);
0194         <span class="keyword">if</span> sbml_level &gt;2,
0195           parameter       = Parameter_setUnits(parameter,<span class="string">'mmol/l'</span>);        
0196         <span class="keyword">end</span>          
0197         kinetic_law{it} = KineticLaw_addParameter(kinetic_law{it}, parameter);        
0198         <span class="keyword">end</span>
0199 
0200         <span class="keyword">for</span> itt = 1:length(inh),
0201           parameter       = Parameter_create(sbml_level,sbml_version);
0202           parameter       = Parameter_setName(parameter, [<span class="string">'kI_'</span> r_name <span class="string">'_'</span> metnames{inh(itt)} ]);
0203           parameter       = Parameter_setId(  parameter, [<span class="string">'kI_'</span> r_name <span class="string">'_'</span> metnames{inh(itt)} ]);
0204           parameter       = Parameter_setValue(parameter,kk.KI(it,inh(itt)));
0205           parameter       = Parameter_setConstant(parameter,1);
0206           <span class="keyword">if</span> sbml_level &gt;2,
0207             parameter       = Parameter_setUnits(parameter,<span class="string">'mmol/l'</span>);
0208           <span class="keyword">end</span>
0209           kinetic_law{it} = KineticLaw_addParameter(kinetic_law{it}, parameter);
0210         <span class="keyword">end</span>
0211       
0212       <span class="keyword">end</span>
0213     
0214     <span class="keyword">case</span> <span class="string">'kinetic_strings'</span>,
0215     
0216       <span class="keyword">for</span> it = 1:length(network.actions),
0217     kinetic_law{it} = KineticLaw_create(sbml_level,sbml_version);
0218     r = network.kinetics.reactions{it};
0219     kinetic_law{it}.math = strrep(r.string,<span class="string">'power'</span>,<span class="string">'pow'</span>);
0220     kinetic_law{it} = KineticLaw_setFormulaFromMath(kinetic_law{it});
0221     <span class="keyword">for</span> p_ind = 1:length(r.parameters),
0222       thispar            = Parameter_create(sbml_level,sbml_version);
0223       thispar.id         = r.parameters{p_ind};
0224       thispar.value      = r.parameter_values(p_ind);
0225       thispar.isSetValue = 1;
0226       kinetic_law{it}    = KineticLaw_addParameter(kinetic_law{it}, thispar);
0227     <span class="keyword">end</span>
0228       <span class="keyword">end</span>
0229       
0230     <span class="keyword">otherwise</span>, disp(<span class="string">'Kinetics export has not been implemented for this kinetics so far.'</span>);
0231   
0232   <span class="keyword">end</span>
0233 <span class="keyword">end</span>
0234 
0235 <span class="keyword">for</span> it = 1:length(network.metabolites),
0236   SBMLmodel = Model_addSpecies(SBMLmodel,species{it});
0237 <span class="keyword">end</span>
0238 
0239 
0240 <span class="comment">% -----------------------------------------------------------</span>
0241 <span class="comment">% reactions</span>
0242 
0243 <span class="keyword">if</span> verbose, fprintf(<span class="string">'\n  Converting the reactions: '</span>); <span class="keyword">end</span>
0244 
0245 <span class="keyword">for</span> it = 1:length(network.actions),
0246 
0247  <span class="keyword">if</span> verbose,  fprintf(<span class="string">'%d '</span>,it); <span class="keyword">end</span>
0248 
0249   reaction = Reaction_create(sbml_level,sbml_version);
0250   reaction = Reaction_setId(reaction,network.actions{it});
0251   reaction = Reaction_setName(reaction,network.actions{it});
0252   reaction = Reaction_setReversible(reaction,network.reversible(it));
0253   <span class="keyword">if</span> exist(<span class="string">'kinetic_law'</span>,<span class="string">'var'</span>),
0254     reaction = Reaction_setKineticLaw(reaction,kinetic_law{it});  
0255   <span class="keyword">end</span>  
0256 
0257   sub_ind = find(network.N(:,it)&lt;0);
0258   
0259   <span class="keyword">if</span> length(sub_ind),
0260     <span class="keyword">for</span> itt = 1:length(sub_ind),
0261       reactant = SpeciesReference_create(sbml_level,sbml_version);
0262       reactant.species = network.metabolites{sub_ind(itt)};
0263       reactant.stoichiometry = abs(network.N(sub_ind(itt),it));      
0264       reaction = Reaction_addReactant(reaction, reactant);
0265     <span class="keyword">end</span>
0266   <span class="keyword">end</span>
0267   
0268   prod_ind = find(network.N(:,it)&gt;0);
0269 
0270   <span class="keyword">if</span> length(prod_ind),
0271     <span class="keyword">for</span> itt = 1:length(prod_ind),
0272       product = SpeciesReference_create(sbml_level,sbml_version);
0273       product.species = network.metabolites{prod_ind(itt)};
0274       product.stoichiometry = abs(network.N(prod_ind(itt),it));      
0275       reaction = Reaction_addProduct(reaction, product);  
0276     <span class="keyword">end</span>
0277   <span class="keyword">end</span>
0278 
0279   mod_ind = find(network.regulation_matrix(it,:));
0280   
0281   <span class="keyword">if</span> length(mod_ind),
0282     <span class="keyword">for</span> itt = 1:length(mod_ind),
0283       modifier = ModifierSpeciesReference_create(sbml_level,sbml_version);
0284       modifier.species = network.metabolites{mod_ind(itt)};
0285       reaction = Reaction_addModifier(reaction, modifier);
0286     <span class="keyword">end</span>
0287   <span class="keyword">end</span>
0288   
0289   SBMLmodel = Model_addReaction(SBMLmodel,reaction);
0290 
0291 <span class="keyword">end</span>
0292 
0293 <span class="keyword">if</span> verbose, fprintf(<span class="string">'\n'</span>,it); <span class="keyword">end</span>
0294 
0295 <span class="keyword">if</span> exist(<span class="string">'filename'</span>,<span class="string">'var'</span>),
0296   OutputSBML(SBMLmodel,filename);
0297   fprintf(<span class="string">'Wrote SBML file &quot;%s&quot;\n'</span>,filename);
0298 <span class="keyword">end</span>
0299 
0300 
0301 <span class="comment">% -------------------------------------------------------------------</span>
0302 
0303 <span class="comment">%     case 'kinetic_strings',</span>
0304 <span class="comment">%</span>
0305 <span class="comment">%       s = [s sprintf('        &lt;kineticLaw formula=&quot;%s&quot;&gt;\n',network.kinetics.reactions{it}.string)];</span>
0306 <span class="comment">%       s = [s sprintf('          &lt;listOfParameters&gt;\n')];</span>
0307 <span class="comment">%       parameters = network.kinetics.reactions{it}.parameters;</span>
0308 <span class="comment">%</span>
0309 <span class="comment">%       for itt = 1:length(parameters),</span>
0310 <span class="comment">%     s = [s sprintf('            &lt;parameter name=&quot;%s&quot; value=&quot;%d&quot;/&gt;\n',parameters{itt}.name,network.kinetics.parameter_values(parameters{itt}.index))];</span>
0311 <span class="comment">%       end</span>
0312 <span class="comment">%       s = [s sprintf('          &lt;/listOfParameters&gt;\n')];</span>
0313 <span class="comment">%       s = [s sprintf('        &lt;/kineticLaw&gt;\n')];</span>
0314 <span class="comment">%</span>
0315 <span class="comment">%     case 'mass-action',</span>
0316 <span class="comment">%</span>
0317 <span class="comment">%       substrate_ind = find(network.N(:,it)&lt;0);</span>
0318 <span class="comment">%       product_ind   = find(network.N(:,it)&gt;0);</span>
0319 <span class="comment">%</span>
0320 <span class="comment">%       substrates='';</span>
0321 <span class="comment">%       for itt = 1: length(substrate_ind),</span>
0322 <span class="comment">%     substrates = [substrates ' * ' network.metabolites{substrate_ind(itt)} ];</span>
0323 <span class="comment">%       end</span>
0324 <span class="comment">%       products='';</span>
0325 <span class="comment">%       for itt = 1: length(product_ind),</span>
0326 <span class="comment">%     products = [products ' * ' network.metabolites{product_ind(itt)} ];</span>
0327 <span class="comment">%       end</span>
0328 <span class="comment">%</span>
0329 <span class="comment">%       s = [s sprintf('        &lt;kineticLaw formula=&quot;kp%s - km%s&quot;&gt;\n',substrates, products  )];</span>
0330 <span class="comment">%       s = [s sprintf('          &lt;listOfParameters&gt;\n')];</span>
0331 <span class="comment">%       s = [s sprintf('            &lt;parameter name=&quot;kp&quot; value=&quot;%d&quot;/&gt;\n',network.kinetics.k_fwd(it))];</span>
0332 <span class="comment">%       s = [s sprintf('            &lt;parameter name=&quot;km&quot; value=&quot;%d&quot;/&gt;\n',network.kinetics.k_bwd(it))];</span>
0333 <span class="comment">%       s = [s sprintf('          &lt;/listOfParameters&gt;\n')];</span>
0334 <span class="comment">%       s = [s sprintf('        &lt;/kineticLaw&gt;\n')];</span>
0335 <span class="comment">%</span>
0336 <span class="comment">%     case 'standard',</span>
0337 <span class="comment">%</span>
0338 <span class="comment">%       for it = 1:length(network.actions),</span>
0339 <span class="comment">%</span>
0340 <span class="comment">%     sub_ind = find(network.N(:,it)&lt;0);</span>
0341 <span class="comment">%     prod_ind = find(network.N(:,it)&gt;0);</span>
0342 <span class="comment">%     if isfield(network,'regulation_matrix'),</span>
0343 <span class="comment">%       act_ind = find(network.regulation_matrix(it,:)&gt;0);</span>
0344 <span class="comment">%       inh_ind = find(network.regulation_matrix(it,:)&lt;0);</span>
0345 <span class="comment">%     end</span>
0346 <span class="comment">%</span>
0347 <span class="comment">%     kinetic_law{it} = KineticLaw_create(sbml_level,sbml_version);</span>
0348 <span class="comment">%</span>
0349 <span class="comment">%     substrates  = network.metabolites(sub_ind);</span>
0350 <span class="comment">%     products    = network.metabolites(prod_ind);</span>
0351 <span class="comment">%     activators  = network.metabolites(act_ind);</span>
0352 <span class="comment">%     inhibitors  = network.metabolites(inh_ind);</span>
0353 <span class="comment">%     formula     = get_formula(network.kinetics.reactions{it},substrates,products,inhibitors,activators,it);</span>
0354 <span class="comment">%     kinetic_law{it} = KineticLaw_setFormula(kinetic_law{it}, formula);</span>
0355 <span class="comment">%     kinetic_law{it} = KineticLaw_setMathFromFormula(kinetic_law{it});</span>
0356 <span class="comment">%</span>
0357 <span class="comment">%     parameters = network.kinetics.reactions{it}.parameters;</span>
0358 <span class="comment">%     psizes = network.kinetics.reactions{it}.sizes;</span>
0359 <span class="comment">%</span>
0360 <span class="comment">%     for itt = 1:length(parameters),</span>
0361 <span class="comment">%           dum = getfield(network.kinetics.reactions{it},parameters{itt});</span>
0362 <span class="comment">%           for itt2= 1:psizes(itt),</span>
0363 <span class="comment">%             parameter = Parameter_create(sbml_level,sbml_version);</span>
0364 <span class="comment">%             parameter = Parameter_setName(parameter, [  'R' num2str(it)  '_' parameters{itt} num2str(itt2) ]);</span>
0365 <span class="comment">%             parameter = Parameter_setId(  parameter, [  'R' num2str(it) '_'  parameters{itt} num2str(itt2) ]);</span>
0366 <span class="comment">%             parameter = Parameter_setValue(parameter,dum(itt2));</span>
0367 <span class="comment">%             kinetic_law{it} = KineticLaw_addParameter(kinetic_law{it}, parameter);</span>
0368 <span class="comment">%           end</span>
0369 <span class="comment">%     end</span>
0370 <span class="comment">%</span>
0371 <span class="comment">%       end</span>
0372 <span class="comment">%</span></pre></div>
<hr><address>Generated on Sun 09-Nov-2014 13:14:25 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>