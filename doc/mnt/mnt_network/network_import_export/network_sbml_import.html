<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of network_sbml_import</title>
  <meta name="keywords" content="network_sbml_import">
  <meta name="description" content="[network,s] = network_sbml_import(s,dirname,verbose)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">mnt</a> &gt; <a href="../index.html">mnt_network</a> &gt; <a href="index.html">network_import_export</a> &gt; network_sbml_import.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for mnt/mnt_network/network_import_export&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>network_sbml_import
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>[network,s] = network_sbml_import(s,dirname,verbose)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [network,s] = network_sbml_import(s,dirname,verbose) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">[network,s] = network_sbml_import(s,dirname,verbose)

Import a network from SBML format.

s can be:
- a SBML structure (as defined by the SBMLToolbox)
- a filename. In this case, the firectory name has to be given 
  in the argument 'dirname'

Kinetic laws are represented in kinetics of the 'numeric'
type (see 'network_velocities')

This function requiers the SBMLToolbox to be installed
(see http://sbml.org/software/sbmltoolbox/)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../mnt/mnt_graphics/netgraph_draw.html" class="code" title="function  network = netgraph_draw(network,varargin)">netgraph_draw</a>	netgraph_draw(network,varargin)</li><li><a href="../../../mnt/utils/default.html" class="code" title="function commandstring = default(varargin)">default</a>	commandstring = default(varname1,defaultvalue1,varname2,defaultvalue2,...)</li><li><a href="../../../mnt/utils/label_names.html" class="code" title="function [label,indices] = label_names(names,allnames,method)">label_names</a>	function [label,indices] = label_names(names,allnames, method)</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%[network,s] = network_sbml_import(s,dirname,verbose)</span>
0002 <span class="comment">%</span>
0003 <span class="comment">%Import a network from SBML format.</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%s can be:</span>
0006 <span class="comment">%- a SBML structure (as defined by the SBMLToolbox)</span>
0007 <span class="comment">%- a filename. In this case, the firectory name has to be given</span>
0008 <span class="comment">%  in the argument 'dirname'</span>
0009 <span class="comment">%</span>
0010 <span class="comment">%Kinetic laws are represented in kinetics of the 'numeric'</span>
0011 <span class="comment">%type (see 'network_velocities')</span>
0012 <span class="comment">%</span>
0013 <span class="comment">%This function requiers the SBMLToolbox to be installed</span>
0014 <span class="comment">%(see http://sbml.org/software/sbmltoolbox/)</span>
0015 
0016 <a name="_sub0" href="#_subfunctions" class="code">function [network,s] = network_sbml_import(s,dirname,verbose)</a>
0017 
0018 <span class="keyword">if</span> ~exist(<span class="string">'TranslateSBML'</span>,<span class="string">'file'</span>),
0019   error(<span class="string">'Please install the SBML Toolbox (http://sbml.org/Software/SBMLToolbox) - Otherwise the  SBML import/export functions do not work.'</span>);
0020 <span class="keyword">end</span>
0021 
0022 eval(<a href="../../../mnt/utils/default.html" class="code" title="function commandstring = default(varargin)">default</a>(<span class="string">'verbose'</span>,<span class="string">'0'</span>));
0023 
0024 create_annotations = 0;   <span class="comment">% CONSTRUCT UNIQUE ANNOTATIONS ?</span>
0025 graphics_flag      = 0;   <span class="comment">% SHOW GRAPHICS?</span>
0026 import_names       = 1;   <span class="comment">% import_names from model</span>
0027 import_compartments= 0;   <span class="comment">% import_names from model</span>
0028 
0029 <span class="keyword">if</span> isstr(s),
0030   <span class="keyword">if</span> exist(<span class="string">'dirname'</span>,<span class="string">'var'</span>); cd(dirname); <span class="keyword">end</span> 
0031   s = TranslateSBML(s);
0032 <span class="keyword">end</span>
0033 
0034 <span class="comment">% -----------------------------------------------------------------------------</span>
0035 <span class="comment">% --- analyse list of species -&gt;</span>
0036 
0037 <span class="comment">%  lists 'metabolites', 'metabolite_names',</span>
0038 <span class="comment">% 'metabolite_compartments', 's_init', 'a_init', 'external', 'metabolite_units'</span>
0039 
0040 clear metabolites 
0041 <span class="keyword">for</span> it=1:length(s.species),
0042   metabolites{it,:} = s.species(it).id;
0043   metabolite_names{it,:} = s.species(it).name;
0044   metabolite_compartments{it,:} = s.species(it).compartment;
0045   external(it,:) = s.species(it).boundaryCondition;
0046   s_init(it,:)   = s.species(it).initialConcentration;
0047   a_init(it,:)   = s.species(it).initialAmount;
0048   ind = findstr(s.species(it).annotation,<span class="string">'kegg.compound'</span>); 
0049   <span class="keyword">if</span> ind, metabolite_kegg_id{it,:} = s.species(it).annotation(ind+14:ind+19); 
0050   <span class="keyword">else</span>,
0051     ind = findstr(s.species(it).annotation,<span class="string">'kegg'</span>); 
0052     <span class="keyword">if</span> ind, metabolite_kegg_id{it,:} = s.species(it).annotation(ind+5:ind+10); 
0053     <span class="keyword">else</span>,
0054       metabolite_kegg_id{it,:} = <span class="string">''</span>;
0055     <span class="keyword">end</span>
0056   <span class="keyword">end</span>
0057 <span class="keyword">end</span>
0058 
0059 <span class="comment">% -----------------------------------------------------------------------------</span>
0060 <span class="comment">% --- analyse list of reactions</span>
0061 
0062 actions    = [];
0063 reversible = [];
0064 
0065 <span class="keyword">for</span> it=1:length(s.reaction),
0066   reaction_id{it,:} = s.reaction(it).id; 
0067   reaction_name{it,:} = s.reaction(it).name; 
0068   reaction_fast{it,:} = s.reaction(it).fast;
0069   reversible(it,:) = s.reaction(it).reversible;
0070   reaction_annotation{it,:} = s.reaction(it).annotation;
0071   <span class="keyword">if</span> isempty(s.reaction(it).kineticLaw),
0072     reaction_formula{it,:}    = [];
0073     reaction_math{it,:}       = [];
0074     reaction_parameter{it,:}  = [];
0075   <span class="keyword">else</span>,
0076     reaction_formula{it,:}    = s.reaction(it).kineticLaw.formula;
0077     reaction_math{it,:}       = s.reaction(it).kineticLaw.math;
0078     reaction_parameter{it,:}  = s.reaction(it).kineticLaw.parameter;
0079   <span class="keyword">end</span>
0080   listOfReactants{it,:} = s.reaction(it).reactant;
0081   listOfProducts{it,:}  = s.reaction(it).product;
0082   listOfModifiers{it,:} = s.reaction(it).modifier;
0083   ind = findstr(s.reaction(it).annotation,<span class="string">'kegg.reaction'</span>); 
0084   <span class="keyword">if</span> ind, 
0085     reaction_kegg_id{it,:} = s.reaction(it).annotation(ind+14:ind+19);
0086   <span class="keyword">else</span>,
0087     reaction_kegg_id{it,:} = <span class="string">''</span>;
0088   <span class="keyword">end</span>
0089 
0090 <span class="keyword">end</span>
0091 
0092 actions = reaction_id;
0093 <span class="keyword">if</span> isempty(reversible), reversible = ones(size(actions)); <span class="keyword">else</span>, reversible=reversible; <span class="keyword">end</span>
0094 
0095 <span class="comment">% -----------------------------------------------------------------------------</span>
0096 <span class="comment">% analyse kinetics -&gt; lists stoichiometries, pstoichiometries</span>
0097 
0098 
0099 <span class="keyword">for</span> it=1:length(listOfReactants),
0100   substrate{it}={};
0101   sstoichiometries{it}=[];
0102   <span class="keyword">for</span> itt = 1:length(listOfReactants{it});
0103     substrate{it}= [substrate{it} {listOfReactants{it}(itt).species}];
0104     sstoichiometries{it}= [sstoichiometries{it} listOfReactants{it}(itt).stoichiometry];
0105   <span class="keyword">end</span>
0106 <span class="keyword">end</span>
0107   
0108 <span class="keyword">for</span> it=1:length(listOfProducts),
0109   product{it}={};
0110   pstoichiometries{it}=[];
0111   <span class="keyword">for</span> itt = 1:length(listOfProducts{it});
0112     product{it}= [product{it} {listOfProducts{it}(itt).species}];
0113     pstoichiometries{it}= [pstoichiometries{it} listOfProducts{it}(itt).stoichiometry];
0114   <span class="keyword">end</span>
0115 <span class="keyword">end</span>
0116 
0117 <span class="keyword">for</span> it=1:length(listOfModifiers),
0118   modifier{it}={};
0119   <span class="keyword">for</span> itt = 1:length(listOfModifiers{it});
0120     modifier{it}= [modifier{it} {listOfModifiers{it}(itt).species}];
0121   <span class="keyword">end</span>
0122 <span class="keyword">end</span>
0123 
0124 <span class="comment">% ----------------------------------------------------------------</span>
0125 
0126 N=zeros(length(metabolites),length(reaction_id));
0127 
0128 <span class="keyword">for</span> it=1:length(s.reaction),
0129   substrate_indices =  <a href="../../../mnt/utils/label_names.html" class="code" title="function [label,indices] = label_names(names,allnames,method)">label_names</a>(substrate{it},metabolites,<span class="string">'single'</span>);
0130   <span class="keyword">if</span> length(substrate_indices), N(substrate_indices,it) = N(substrate_indices,it)-sstoichiometries{it}'; <span class="keyword">end</span> 
0131   product_indices =  <a href="../../../mnt/utils/label_names.html" class="code" title="function [label,indices] = label_names(names,allnames,method)">label_names</a>(product{it},metabolites,<span class="string">'single'</span>);
0132   <span class="keyword">if</span> length(product_indices),
0133     N(product_indices,it) = N(product_indices,it) + pstoichiometries{it}' ; <span class="keyword">end</span>
0134 <span class="keyword">end</span>
0135 
0136 <span class="comment">% --------------------------------------------------------------------------------------------</span>
0137 
0138 network.metabolites  = metabolites;
0139 network.actions      = reaction_id;
0140 network.external     = double(external);
0141 network.reversible   = reversible;
0142 network.N            = N;
0143 
0144 network.metabolite_KEGGID = metabolite_kegg_id;
0145 network.reaction_KEGGID   = reaction_kegg_id;
0146 
0147 <span class="keyword">if</span> import_names,
0148 
0149 <span class="keyword">if</span> exist(<span class="string">'metabolite_names'</span>,<span class="string">'var'</span>), network.metabolite_names  = metabolite_names; 
0150 <span class="keyword">else</span>, network.metabolite_names  = network.metabolites; <span class="keyword">end</span>
0151 
0152 <span class="keyword">if</span> exist(<span class="string">'reaction_name'</span>,<span class="string">'var'</span>), network.reaction_names  = reaction_name; 
0153 <span class="keyword">else</span>, network.reaction_names  = network.actions; <span class="keyword">end</span>
0154 
0155 <span class="keyword">end</span>
0156 
0157 <span class="keyword">if</span> import_names,
0158   <span class="keyword">if</span> exist(<span class="string">'metabolite_names'</span>,<span class="string">'var'</span>), network.metabolite_compartments  = metabolite_compartments; 
0159   <span class="keyword">else</span>, network.metabolite_compartments  = repmat({<span class="string">''</span>},length(network.metabolites),1); <span class="keyword">end</span>
0160 <span class="keyword">end</span>
0161 
0162 <span class="comment">% ------------------------------------------------------------</span>
0163 <span class="comment">% set reaction kinetics</span>
0164 
0165 network.regulation_matrix = zeros(size(network.N))';
0166   
0167 <span class="keyword">for</span> it1 = 1:length(modifier),
0168   <span class="keyword">for</span> it2=1:length(modifier{it1}),
0169     mm = <a href="../../../mnt/utils/label_names.html" class="code" title="function [label,indices] = label_names(names,allnames,method)">label_names</a>(modifier{it1}(it2),metabolites);
0170     <span class="keyword">if</span> mm,
0171       network.regulation_matrix(it1,mm)=1;
0172     <span class="keyword">end</span>
0173   <span class="keyword">end</span>
0174 <span class="keyword">end</span>
0175 
0176 <span class="keyword">if</span> ~isempty(reaction_formula{1}),
0177   network.kinetics.type = <span class="string">'numeric'</span>;
0178   network.kinetics.reactions = {};
0179   all_parameters = {};
0180   <span class="keyword">for</span> it = 1:length(actions),
0181     network.kinetics.reactions{it}.string = strrep(reaction_math{it},<span class="string">'pow'</span>,<span class="string">'power'</span>);
0182     <span class="keyword">for</span> itt = 1:length(reaction_parameter{it}),
0183       this_parameter = reaction_parameter{it}(itt);
0184       network.kinetics.reactions{it}.parameters{itt}.name = this_parameter.id;
0185       network.kinetics.reactions{it}.parameters{itt}.value = this_parameter.value;
0186     <span class="keyword">end</span>
0187     <span class="keyword">if</span> length(reaction_parameter{it}),
0188       network.kinetics.reactions{it}.parameters = network.kinetics.reactions{it}.parameters';
0189       <span class="keyword">else</span>,
0190       network.kinetics.reactions{it}.parameters = {};
0191     <span class="keyword">end</span>
0192     <span class="keyword">end</span>
0193   network.kinetics.reactions = network.kinetics.reactions';
0194 <span class="keyword">end</span>
0195 
0196 
0197 <span class="keyword">if</span> ~isempty(reaction_formula{1}),
0198   z=1;
0199   network.kinetics.parameter_values = [];
0200   network.kinetics.parameters = [];
0201 
0202   <span class="keyword">for</span> it=1:length(network.actions),
0203     par = network.kinetics.reactions{it}.parameters;
0204     <span class="keyword">for</span> it2 = 1: length(par),
0205       network.kinetics.parameters{z}   = [<span class="string">'v'</span> num2str(it) <span class="string">'_'</span> par{it2}.name];
0206       network.kinetics.parameter_values(z)   = par{it2}.value;
0207       network.kinetics.reactions{it}.parameters{it2}.index = z;
0208       network.kinetics.reactions{it}.parameters{it2} = rmfield(network.kinetics.reactions{it}.parameters{it2},<span class="string">'value'</span>);
0209       z=z+1;
0210     <span class="keyword">end</span>
0211   <span class="keyword">end</span>
0212   network.kinetics.parameter_values = network.kinetics.parameter_values';
0213   network.kinetics.parameters = network.kinetics.parameters';
0214 <span class="keyword">elseif</span> verbose, 
0215   fprintf(<span class="string">'Warning: no kinetics found in SBML file.\n'</span>);
0216 <span class="keyword">end</span> 
0217 
0218 <span class="keyword">if</span> exist(<span class="string">'s_init'</span>,<span class="string">'var'</span>), network.s_init       = s_init; 
0219 <span class="keyword">else</span>,
0220 <span class="keyword">if</span> exist(<span class="string">'a_init'</span>,<span class="string">'var'</span>), network.s_init       = a_init; <span class="keyword">end</span>
0221 <span class="keyword">end</span>
0222 
0223 <span class="keyword">if</span> graphics_flag,
0224   <span class="keyword">if</span> length(network.actions),
0225     <a href="../../../mnt/mnt_graphics/netgraph_draw.html" class="code" title="function  network = netgraph_draw(network,varargin)">netgraph_draw</a>(network);
0226   <span class="keyword">end</span>
0227 <span class="keyword">end</span>
0228 
0229 
0230 <span class="comment">% --------------------------------------------------------------</span>
0231 
0232 <span class="comment">%if create_annotations,</span>
0233 
0234 <span class="comment">%for it=1:length(network.metabolites),</span>
0235 <span class="comment">%  network.metabolite_annotation{it}.object      = network.metabolites{it};</span>
0236 <span class="comment">%  network.metabolite_annotation{it}.is_reaction = 0;</span>
0237 <span class="comment">%  network.metabolite_annotation{it}.quantity    = 'concentration';</span>
0238 <span class="comment">%  network.metabolite_annotation{it}.unit        = 'mM';</span>
0239 <span class="comment">%end</span>
0240 
0241 <span class="comment">%for it=1:length(network.actions),</span>
0242 <span class="comment">%  network.action_annotation{it}.object        = network.actions{it};</span>
0243 <span class="comment">%  network.action_annotation{it}.is_reaction   =  1;</span>
0244 <span class="comment">%  network.action_annotation{it}.quantity      = 'flux';</span>
0245 <span class="comment">%  network.action_annotation{it}.unit          = 'mM/min';</span>
0246 <span class="comment">%end</span>
0247 
0248 <span class="comment">%if ~isempty(reaction_formula),</span>
0249 <span class="comment">%  z=1;</span>
0250 <span class="comment">%  for it=1:length(network.actions),</span>
0251 <span class="comment">%    par = network.kinetics.reactions{it}.parameters;</span>
0252 <span class="comment">%    for it2 = 1: length(par),</span>
0253 <span class="comment">%    network.parameter_annotation{z}.quantity      = 'reaction parameter';</span>
0254 <span class="comment">%    network.parameter_annotation{it}.is_reaction  = 0;</span>
0255 <span class="comment">%    network.parameter_annotation{it}.unit         = 'unknown';</span>
0256 <span class="comment">%    network.parameter_annotation{z}.object        = par{it2}.name;</span>
0257 <span class="comment">%    network.parameter_annotation{z}.value         = par{it2}.value;</span>
0258 <span class="comment">%    network.parameter_annotation{z}.appears_in_reaction = it;</span>
0259 <span class="comment">%    z=z+1;</span>
0260 <span class="comment">%    end</span>
0261 <span class="comment">%  end</span>
0262 <span class="comment">%end</span></pre></div>
<hr><address>Generated on Wed 10-Apr-2013 10:42:33 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>