<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of sbml2network</title>
  <meta name="keywords" content="sbml2network">
  <meta name="description" content="network = sbml2network(file,graphics_flag);">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">mnt</a> &gt; <a href="../index.html">mnt_network</a> &gt; <a href="index.html">network_import_export</a> &gt; sbml2network.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for mnt/mnt_network/network_import_export&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>sbml2network
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>network = sbml2network(file,graphics_flag);</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function network = sbml2network(file,graphics_flag); </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> network = sbml2network(file,graphics_flag);

 Read biochemical network from SBML file

 Only SBML level 1 is supported

 EXAMPLE network = sbml2network('data/branch.xml');

 This function requires the xml package &quot;XML TOOLS&quot; by Peter Rydesa&quot;ter, available from Matlab Central</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../mnt/mnt_graphics/netgraph_draw.html" class="code" title="function  network = netgraph_draw(network,varargin)">netgraph_draw</a>	netgraph_draw(network,varargin)</li><li><a href="../../../mnt/util/label_names.html" class="code" title="function [label,indices] = label_names(names,allnames,method)">label_names</a>	function [label,indices] = label_names(names,allnames, method)</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">% network = sbml2network(file,graphics_flag);</span>
0002 <span class="comment">%</span>
0003 <span class="comment">% Read biochemical network from SBML file</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% Only SBML level 1 is supported</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% EXAMPLE network = sbml2network('data/branch.xml');</span>
0008 <span class="comment">%</span>
0009 <span class="comment">% This function requires the xml package &quot;XML TOOLS&quot; by Peter Rydesa&quot;ter, available from Matlab Central</span>
0010 
0011 <a name="_sub0" href="#_subfunctions" class="code">function network = sbml2network(file,graphics_flag);</a>
0012 
0013 <span class="keyword">if</span> ~exist(<span class="string">'graphics_flag'</span>,<span class="string">'var'</span>), graphics_flag=0; <span class="keyword">end</span>
0014 
0015 f = fopen(file);
0016 xmlstring=char(fread(f,[1 inf],<span class="string">'uint8'</span>));
0017 fclose(f);
0018 <span class="keyword">try</span>
0019   st=xmlstruct(xmlstring,<span class="string">'sub'</span>);
0020 <span class="keyword">catch</span> err
0021   error(<span class="string">'Make sure that the xml package &quot;XML TOOLS&quot; by Peter Rydesa&quot;ter, available from Matlab Central, is installed in your system'</span>);
0022 <span class="keyword">end</span>
0023 
0024 <span class="keyword">for</span> it = 1:length(st.sub),
0025  <span class="keyword">if</span> strcmp(st.sub(it).name, <span class="string">'sbml'</span>),
0026    sbml_struct=st.sub(it);
0027    sbml_level = sbml_struct.data.level;
0028    sbml_xmlns = sbml_struct.data.xmlns;
0029    sbml_version = sbml_struct.data.version;
0030  <span class="keyword">end</span>
0031 <span class="keyword">end</span>
0032 
0033 model = sbml_struct.sub(1); <span class="comment">%fprintf('Model %s\n',model.data.name);</span>
0034 
0035 <span class="keyword">for</span> it = 1:length(model.sub),
0036   <span class="keyword">switch</span> model.sub(it).name,
0037     <span class="keyword">case</span> <span class="string">'notes'</span>,                 notes                 = model.sub(it);
0038     <span class="keyword">case</span> <span class="string">'listOfFunctionDefinitions'</span>, listOfFunctionDefinitions = model.sub(it);
0039     <span class="keyword">case</span> <span class="string">'listOfUnitDefinitions'</span>, listOfUnitDefinitions = model.sub(it);
0040     <span class="keyword">case</span> <span class="string">'listOfCompartments'</span>,    listOfCompartments    = model.sub(it);
0041     <span class="keyword">case</span> <span class="string">'listOfSpecies'</span>,         listOfSpecies         = model.sub(it);
0042     <span class="keyword">case</span> <span class="string">'listOfParameters'</span>,      listOfParameters      = model.sub(it);
0043     <span class="keyword">case</span> <span class="string">'listOfRules'</span>,           listOfRules           = model.sub(it);
0044     <span class="keyword">case</span> <span class="string">'listOfReactions'</span>,       listOfReactions       = model.sub(it);
0045     <span class="keyword">case</span> <span class="string">'listOfEvents'</span>,          listOfEvents          = model.sub(it);
0046   <span class="keyword">end</span>
0047 <span class="keyword">end</span>
0048 
0049 <span class="comment">% --- analyse list of species -&gt; lists 'metabolites', 'metabolite_names',</span>
0050 <span class="comment">% 'metabolite_compartments', 's_init', 'a_init', 'external', 'metabolite_units'</span>
0051 
0052 <span class="keyword">for</span> it=1:length(listOfSpecies.sub)-1,
0053  <span class="keyword">if</span> isfield(listOfSpecies.sub(it).data,<span class="string">'id'</span>),
0054    metabolites{it} = listOfSpecies.sub(it).data.id;
0055  <span class="keyword">end</span>
0056  <span class="keyword">if</span> isfield(listOfSpecies.sub(it).data,<span class="string">'name'</span>),
0057    metabolite_names{it} = listOfSpecies.sub(it).data.name;
0058    <span class="comment">% fill holes</span>
0059  <span class="keyword">else</span>,
0060    metabolite_names{it} =    metabolites{it};
0061  <span class="keyword">end</span>
0062  <span class="keyword">if</span> isfield(listOfSpecies.sub(it).data,<span class="string">'substanceUnits'</span>),
0063    metabolite_units{it} = listOfSpecies.sub(it).data.unit;
0064  <span class="keyword">end</span>
0065  <span class="keyword">if</span> isfield(listOfSpecies.sub(it).data,<span class="string">'compartment'</span>),
0066    metabolite_compartments{it} = listOfSpecies.sub(it).data.compartment;
0067  <span class="keyword">end</span>
0068  <span class="keyword">if</span> isfield(listOfSpecies.sub(it).data,<span class="string">'initialAmount'</span>),
0069    a_init(it) = eval(listOfSpecies.sub(it).data.initialAmount);
0070  <span class="keyword">end</span>
0071  <span class="keyword">if</span> isfield(listOfSpecies.sub(it).data,<span class="string">'initialConcentration'</span>),
0072    s_init(it) = eval(listOfSpecies.sub(it).data.initialConcentration);
0073  <span class="keyword">end</span>
0074  <span class="keyword">if</span> isfield(listOfSpecies.sub(it).data,<span class="string">'boundaryCondition'</span>),
0075    external(it) = eval(listOfSpecies.sub(it).data.boundaryCondition);
0076  <span class="keyword">end</span>
0077 <span class="keyword">end</span>
0078 
0079 
0080 <span class="keyword">if</span> ~exist(<span class="string">'metabolites'</span>,<span class="string">'var'</span>), metabolites = metabolite_names; <span class="keyword">end</span>
0081 metabolites = metabolites';
0082 <span class="keyword">if</span> exist(<span class="string">'s_init'</span>,<span class="string">'var'</span>), s_init = s_init'; <span class="keyword">end</span>
0083 <span class="keyword">if</span> exist(<span class="string">'a_init'</span>,<span class="string">'var'</span>), a_init = a_init'; <span class="keyword">end</span>
0084 <span class="keyword">if</span> exist(<span class="string">'metabolite_names'</span>,<span class="string">'var'</span>), metabolite_names=metabolite_names'; <span class="keyword">end</span> 
0085 <span class="keyword">if</span> exist(<span class="string">'metabolite_units'</span>,<span class="string">'var'</span>), metabolite_units=metabolite_units'; <span class="keyword">end</span> 
0086 <span class="keyword">if</span> exist(<span class="string">'metabolite_compartments'</span>,<span class="string">'var'</span>), metabolite_compartments=metabolite_compartments'; <span class="keyword">end</span> 
0087 
0088 
0089 <span class="comment">% --- analyse list of reactions -&gt; lists 'actions', 'reversible', reaction_annotation,</span>
0090 <span class="comment">% listOfReactants, listOfProducts, listOfModifiers</span>
0091 
0092 actions    = [];
0093 reversible = [];
0094 
0095 nr = length(listOfReactions.sub)-1;
0096 
0097 <span class="keyword">for</span> it=1:nr,
0098 
0099   <span class="keyword">if</span> isfield(listOfReactions.sub(it).data,<span class="string">'id'</span>),         reaction_id{it,:} = listOfReactions.sub(it).data.id; <span class="keyword">end</span>
0100   <span class="keyword">if</span> isfield(listOfReactions.sub(it).data,<span class="string">'name'</span>),       reaction_name{it} = listOfReactions.sub(it).data.name; <span class="keyword">end</span>
0101   <span class="keyword">if</span> isfield(listOfReactions.sub(it).data,<span class="string">'fast'</span>),       reaction_fast{it} = listOfReactions.sub(it).data.fast; <span class="keyword">end</span>
0102   <span class="keyword">if</span> isfield(listOfReactions.sub(it).data,<span class="string">'reversible'</span>), 
0103     reaction_rev{it} = listOfReactions.sub(it).data.reversible;
0104     reversible(it)=strcmp(reaction_rev{it},<span class="string">'true'</span>);
0105   <span class="keyword">end</span>
0106 
0107   listOfReactants{it} = {};
0108   listOfProducts{it}  = {};
0109   listOfModifiers{it}  = {};
0110 
0111   <span class="keyword">for</span> itt = 1:length(listOfReactions.sub(it).sub)-1;
0112     item = listOfReactions.sub(it).sub(itt);
0113     <span class="keyword">switch</span> item.name,
0114       <span class="keyword">case</span> <span class="string">'annotation'</span>,      reaction_annotation{it} = item;
0115       <span class="keyword">case</span> <span class="string">'listOfReactants'</span>,     listOfReactants{it} = item;
0116       <span class="keyword">case</span> <span class="string">'listOfProducts'</span>,       listOfProducts{it} = item;
0117       <span class="keyword">case</span> <span class="string">'listOfModifiers'</span>,     listOfModifiers{it} = item;
0118     <span class="keyword">end</span>
0119   <span class="keyword">end</span>
0120 <span class="keyword">end</span>
0121 
0122 <span class="keyword">if</span> ~exist(<span class="string">'reaction_id'</span>,<span class="string">'var'</span>), reaction_id = reaction_name; <span class="keyword">end</span>
0123 
0124 actions = reaction_id;
0125 
0126 <span class="keyword">if</span> isempty(reversible), reversible = ones(size(actions)); <span class="keyword">else</span>, reversible=reversible'; <span class="keyword">end</span>
0127 
0128 <span class="comment">% -------------------------------------------------------------------------------------</span>
0129 <span class="comment">%</span>
0130 <span class="comment">% analyse kinetics -&gt; lists stoichiometries, pstoichiometries, formula, parlist</span>
0131 
0132 formula = {};
0133 parlist = {};
0134 
0135 <span class="keyword">for</span> it=1:nr,
0136 
0137   this_substrate ={};
0138   <span class="keyword">if</span> ~isempty(listOfReactants{it}), this_substrate = listOfReactants{it}.sub; <span class="keyword">end</span>
0139   substrate{it}={};
0140   sstoichiometries{it}=[];
0141   <span class="keyword">for</span> itt = 1:length(this_substrate)-1;
0142     <span class="keyword">if</span> isfield(this_substrate(itt).data,<span class="string">'specie'</span>), 
0143       substrate{it}= [substrate{it} {this_substrate(itt).data.specie}];
0144     <span class="keyword">else</span>,
0145       substrate{it}= [substrate{it} {this_substrate(itt).data.species}];
0146     <span class="keyword">end</span>
0147     <span class="keyword">if</span> isfield(this_substrate(itt).data,<span class="string">'stoichiometry'</span>),
0148       sstoichiometries{it}=[sstoichiometries{it} eval(this_substrate(itt).data.stoichiometry)];
0149     <span class="keyword">else</span>,sstoichiometries{it} = 1;
0150     <span class="keyword">end</span>
0151   <span class="keyword">end</span>
0152   
0153    
0154   this_product={};
0155   <span class="keyword">if</span> ~isempty(listOfProducts{it}), this_product = listOfProducts{it}.sub; <span class="keyword">end</span> 
0156   product{it}          = {};
0157   pstoichiometries{it} = [];
0158   <span class="keyword">for</span> itt = 1:length(this_product)-1;
0159     <span class="keyword">if</span> isfield(this_product(itt).data,<span class="string">'specie'</span>), 
0160       product{it}= [product{it} {this_product(itt).data.specie}];
0161     <span class="keyword">else</span>,
0162       product{it}= [product{it} {this_product(itt).data.species}];
0163     <span class="keyword">end</span>
0164     <span class="keyword">if</span> isfield(this_product(itt).data,<span class="string">'stoichiometry'</span>),
0165       pstoichiometries{it}=[pstoichiometries{it} eval(this_product(itt).data.stoichiometry)];
0166     <span class="keyword">else</span>,
0167       pstoichiometries{it} = 1;
0168     <span class="keyword">end</span>
0169   <span class="keyword">end</span>
0170 
0171   this_modifier={};
0172   <span class="keyword">if</span> ~isempty(listOfModifiers{it}), this_modifier = listOfModifiers{it}.sub; <span class="keyword">end</span> 
0173   modifier{it}          = {};
0174   <span class="keyword">for</span> itt = 1:length(this_modifier)-1;
0175     <span class="keyword">if</span> isfield(this_modifier(itt).data,<span class="string">'specie'</span>), 
0176       modifier{it}= [modifier{it} {this_modifier(itt).data.specie}];
0177     <span class="keyword">else</span>,
0178       modifier{it}= [modifier{it} {this_modifier(itt).data.species}];
0179     <span class="keyword">end</span>
0180   <span class="keyword">end</span>
0181 
0182   formula{it} = <span class="string">''</span>;
0183   parlist{it} = {};
0184   <span class="keyword">if</span> isfield(listOfReactions.sub(it).sub(3).data,<span class="string">'formula'</span>),
0185     formula{it} = listOfReactions.sub(it).sub(3).data.formula;
0186     parlist{it}={};
0187     <span class="keyword">if</span> ~isempty( listOfReactions.sub(it).sub(3).sub),
0188       <span class="keyword">for</span> itt = 1:length(listOfReactions.sub(it).sub(3).sub(1).sub)-1;
0189     parameters  =  listOfReactions.sub(it).sub(3).sub(1).sub(itt).data;
0190     parlist{it}= [parlist{it}; {parameters}];
0191       <span class="keyword">end</span>
0192     <span class="keyword">end</span>
0193   <span class="keyword">end</span>
0194   
0195 <span class="keyword">end</span>
0196 
0197 <span class="comment">% ----------------------------------------------------------------</span>
0198 
0199 N = zeros(length(metabolites),length(reaction_id));
0200 
0201 <span class="keyword">for</span> it=1:length(listOfReactions.sub)-1,
0202   substrate_indices =  <a href="../../../mnt/util/label_names.html" class="code" title="function [label,indices] = label_names(names,allnames,method)">label_names</a>(substrate{it},metabolites,<span class="string">'single'</span>);
0203  <span class="keyword">if</span> length(substrate_indices), N(substrate_indices,it) = N(substrate_indices,it)-sstoichiometries{it}'; <span class="keyword">end</span> 
0204   product_indices =  <a href="../../../mnt/util/label_names.html" class="code" title="function [label,indices] = label_names(names,allnames,method)">label_names</a>(product{it},metabolites,<span class="string">'single'</span>);
0205  <span class="keyword">if</span> length(product_indices),  N(product_indices,it) = N(product_indices,it) + pstoichiometries{it}' ; <span class="keyword">end</span>
0206 <span class="keyword">end</span>
0207 
0208 <span class="comment">% --------------------------------------------------------------------------------------------</span>
0209 
0210 network.metabolites  = metabolites;
0211 network.actions      = reaction_id;
0212 network.external     = zeros(size(network.metabolites));
0213 network.reversible   = reversible;
0214 network.N            = N;
0215 
0216 <span class="keyword">if</span> graphics_flag,
0217   <span class="keyword">if</span> length(network.actions),
0218     <a href="../../../mnt/mnt_graphics/netgraph_draw.html" class="code" title="function  network = netgraph_draw(network,varargin)">netgraph_draw</a>(network);
0219   <span class="keyword">end</span>
0220 <span class="keyword">end</span>
0221 
0222 <span class="keyword">if</span> ~isempty(formula),
0223   network.kinetics.type = <span class="string">'numeric'</span>;
0224   network.kinetics.reactions = {};
0225   <span class="keyword">for</span> it = 1:length(actions),
0226     network.kinetics.reactions{it}.string = formula{it};
0227     network.kinetics.reactions{it}.parameters = parlist{it};
0228     <span class="keyword">for</span> itt = 1:length(network.kinetics.reactions{it}.parameters),
0229       network.kinetics.reactions{it}.parameters{itt}.value = eval(network.kinetics.reactions{it}.parameters{itt}.value );
0230     <span class="keyword">end</span>
0231   <span class="keyword">end</span>
0232   network.kinetics.reactions = network.kinetics.reactions';
0233   
0234   network.regulation_matrix = zeros(size(network.N))';
0235   <span class="keyword">for</span> it1 = 1:length(network.actions),
0236     <span class="keyword">for</span> it2=1:length(network.metabolites),
0237       <span class="keyword">if</span> length(findstr(network.metabolites{it2},network.kinetics.reactions{it1}.string)), network.regulation_matrix(it1,it2) =1; <span class="keyword">end</span>
0238     <span class="keyword">end</span>
0239   <span class="keyword">end</span>
0240 <span class="keyword">end</span>
0241 
0242 
0243 <span class="keyword">if</span> exist(<span class="string">'metabolite_names'</span>,<span class="string">'var'</span>), network.metabolite_names  = metabolite_names; <span class="keyword">end</span>
0244 network.action_names      = actions;
0245 
0246 <span class="keyword">if</span> ~isempty(formula),
0247   z=1;
0248   network.kinetics.parameter_values = [];
0249   network.kinetics.parameters = [];
0250 
0251   <span class="keyword">for</span> it=1:length(network.actions),
0252     par = network.kinetics.reactions{it}.parameters;
0253     <span class="keyword">for</span> it2 = 1: length(par),
0254       network.kinetics.parameters{z}   = [<span class="string">'v'</span> num2str(it) <span class="string">'_'</span> par{it2}.name];
0255       network.kinetics.parameter_values(z)   = par{it2}.value;
0256       network.kinetics.reactions{it}.parameters{it2}.index = z;
0257       network.kinetics.reactions{it}.parameters{it2} = rmfield(network.kinetics.reactions{it}.parameters{it2},<span class="string">'value'</span>);
0258       z=z+1;
0259     <span class="keyword">end</span>
0260   <span class="keyword">end</span>
0261   network.kinetics.parameter_values = network.kinetics.parameter_values';
0262   network.kinetics.parameters = network.kinetics.parameters';
0263 <span class="keyword">else</span> fprintf(<span class="string">'Warning: no kinetics found in SBML file.\n'</span>);
0264 <span class="keyword">end</span> 
0265 
0266 <span class="keyword">if</span> exist(<span class="string">'s_init'</span>,<span class="string">'var'</span>), 
0267   network.s_init       = s_init; 
0268 <span class="keyword">else</span>,
0269   <span class="keyword">if</span> exist(<span class="string">'a_init'</span>,<span class="string">'var'</span>), 
0270     network.s_init       = a_init; 
0271   <span class="keyword">end</span>
0272 <span class="keyword">end</span>
0273 
0274 <span class="keyword">end</span>
0275 
0276 <span class="comment">% ----------------------------------------------------------------</span>
0277</pre></div>
<hr><address>Generated on Fri 05-Apr-2013 16:43:00 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>