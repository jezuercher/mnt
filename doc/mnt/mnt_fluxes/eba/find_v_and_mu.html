<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of find_v_and_mu</title>
  <meta name="keywords" content="find_v_and_mu">
  <meta name="description" content="[v,mu] = find_v_and_mu(N,K,external,eba_constraints,eba_options)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">mnt</a> &gt; <a href="../index.html">mnt_fluxes</a> &gt; <a href="index.html">eba</a> &gt; find_v_and_mu.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for mnt/mnt_fluxes/eba&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>find_v_and_mu
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>[v,mu] = find_v_and_mu(N,K,external,eba_constraints,eba_options)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [v,mu] = find_v_and_mu(N, K, external, eba_constraints, eba_options) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> [v,mu] = find_v_and_mu(N,K,external,eba_constraints,eba_options)

 determine a common set of feasible v and mu values satisfying their 
 boundary eba_constraints, sign(v)=sign(A), and minimising the euclidean norm</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [v,mu] = find_v_and_mu(N, K, external, eba_constraints, eba_options)</a>
0002 
0003 <span class="comment">% [v,mu] = find_v_and_mu(N,K,external,eba_constraints,eba_options)</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% determine a common set of feasible v and mu values satisfying their</span>
0006 <span class="comment">% boundary eba_constraints, sign(v)=sign(A), and minimising the euclidean norm</span>
0007 
0008 <span class="keyword">if</span> ~isfield(eba_constraints,<span class="string">'mu_min'</span>), eba_constraints.mu_min = -10; <span class="keyword">end</span>
0009 <span class="keyword">if</span> ~isfield(eba_constraints,<span class="string">'mu_max'</span>), eba_constraints.mu_max = 10; <span class="keyword">end</span>
0010 
0011 [nm,nr] = size(N);
0012 
0013 ind_fix = find(isfinite(eba_constraints.v_fix));
0014 n_int = sum(external==0); 
0015 N_int = N(find(external==0),:);
0016 
0017 <span class="comment">% x contains all v and all mu</span>
0018 
0019 <span class="comment">%min = sum(x.^2);</span>
0020 <span class="comment">% x(1:nr) &gt;= eba_constraints.v_min</span>
0021 <span class="comment">% x(1:nr) &lt;= eba_constraints.v_max</span>
0022 <span class="comment">% x(ind_fix) = eba_constraints.v_fix(ind_fix)</span>
0023 <span class="comment">% N_int * x(1:nr) =0</span>
0024 <span class="comment">% diag(x(1:nr))* N' * x(nr+1:end) &gt;= epsilon &gt;0</span>
0025 
0026 i_ps = find(isfinite(eba_constraints.ext_sign));
0027        
0028 A = double([-diag(eba_constraints.ext_sign(i_ps)) * N(i_ps,:), zeros(length(i_ps),nm)]);
0029 b = zeros(length(i_ps),1);
0030 
0031 my_eye = eye(nr);
0032 
0033 Aeq = double([my_eye(ind_fix,:), zeros(length(ind_fix),nm); <span class="keyword">...</span>
0034               N_int, zeros(n_int,nm)]);
0035 
0036 beq = double([eba_constraints.v_fix(ind_fix); zeros(n_int,1)]);
0037 
0038 <span class="comment">%rand('state',eba_options.seed);</span>
0039 
0040 xmin = [eba_constraints.v_min; eba_constraints.mu_min*ones(nm,1)];
0041 xmax = [eba_constraints.v_max; eba_constraints.mu_max*ones(nm,1)];
0042 
0043 exitflag = -1;
0044 <span class="keyword">while</span> exitflag&lt;=0,
0045 <span class="comment">%x0 = xmin + rand(nr+nm,1).*[xmax-xmin];</span>
0046 <span class="comment">%x0(1:nr) = K*pinv(full(K))*x0(1:nr);</span>
0047 <span class="comment">%x0 = zeros(nr+nm,1);</span>
0048 x0 = rand(nr+nm,1)-.5;
0049 [x,value,exitflag] = my_fmincon(@elf1,x0,A,b,Aeq,beq,xmin,xmax,@(x)elf2(x,full(N)),optimset(<span class="string">'MaxFunEvals'</span>,10000));
0050 <span class="keyword">end</span>
0051 
0052 <span class="comment">%A*x &lt;= b</span>
0053 <span class="comment">%Aeq*x - beq</span>
0054 <span class="comment">%C = elf2(x,N)</span>
0055 
0056 v = x(1:nr);
0057 mu = x(nr+1:end);
0058 
0059 <span class="keyword">return</span>
0060 
0061 <span class="comment">%check</span>
0062 <span class="comment">%[v eba_constraints.v_min eba_constraints.v_max eba_constraints.v_fix]</span>
0063 <span class="comment">%N_int * v</span>
0064 <span class="comment">%[v, N'*mu]</span>
0065 
0066 <span class="keyword">if</span> sum(v&lt;eba_constraints.v_min), warning(<span class="string">'Solution violates constraint'</span>); <span class="keyword">end</span>
0067 <span class="keyword">if</span> sum(v&gt;eba_constraints.v_max), warning(<span class="string">'Solution violates constraint'</span>); <span class="keyword">end</span>
0068 <span class="keyword">if</span> sum(abs(v(isfinite(eba_constraints.v_fix)) - eba_constraints.v_fix(isfinite(eba_constraints.v_fix)))&gt;10^-8), 
0069   warning(<span class="string">'Solution violates constraint'</span>); 
0070 <span class="keyword">end</span>
0071 <span class="keyword">if</span> sum(abs(N_int*v) &gt; 10^-8), warning(<span class="string">'Solution violates constraint'</span>); <span class="keyword">end</span>
0072 <span class="keyword">if</span> sum(v.*(N'*mu)&gt;0), warning(<span class="string">'Solution violates constraint'</span>); <span class="keyword">end</span></pre></div>
<hr><address>Generated on Sun 14-Apr-2013 22:34:00 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>