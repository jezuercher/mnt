<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of optimise_mu_given_signs</title>
  <meta name="keywords" content="optimise_mu_given_signs">
  <meta name="description" content="[delta_mu,delta_mu_score,this_mu] = optimize_mu_given_signs(N,parameter_prior,data,v,options,constraints)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">mnt</a> &gt; <a href="../index.html">mnt_fluxes</a> &gt; <a href="index.html">eba</a> &gt; optimise_mu_given_signs.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for mnt/mnt_fluxes/eba&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>optimise_mu_given_signs
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>[delta_mu,delta_mu_score,this_mu] = optimize_mu_given_signs(N,parameter_prior,data,v,options,constraints)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [delta_mu, delta_mu_score, this_mu] = optimize_mu_given_signs(N,parameter_prior,data,v,options,constraints) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> [delta_mu,delta_mu_score,this_mu] = optimize_mu_given_signs(N,parameter_prior,data,v,options,constraints)

 maximise prob density w.r.t. delta_mu
 (with distribution parameters mean: delta_mu_mean and covariance: delta_mu_cov)
 while satisfying the sign constraints v~=0 -&gt; sign(delta_mu) = -sign(v)

 v: (size nr x n_exp) flux matrix, only used for sign constraints</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../mnt/mnt_mca/analyse_N.html" class="code" title="function [K, L, NR, null_l, pinv_NR, independent_metabolites, N1] = analyse_N(N,external)">analyse_N</a>	[ K, L, NR, null_l, pinv_NR, independent_metabolites, N1] = analyse_N(N,external)</li><li><a href="../../../mnt/mnt_numbers/RT.html" class="code" title="function result = RT(temperature)">RT</a>	result = RT(temperature)</li><li><a href="../../../mnt/utils/matrix_add_block.html" class="code" title="function M = matrix_add_block(A,B);">matrix_add_block</a>	M = matrix_add_block(A,B);</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [delta_mu, delta_mu_score, this_mu] = optimize_mu_given_signs(N,parameter_prior,data,v,options,constraints)</a>
0002 
0003 <span class="comment">% [delta_mu,delta_mu_score,this_mu] = optimize_mu_given_signs(N,parameter_prior,data,v,options,constraints)</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% maximise prob density w.r.t. delta_mu</span>
0006 <span class="comment">% (with distribution parameters mean: delta_mu_mean and covariance: delta_mu_cov)</span>
0007 <span class="comment">% while satisfying the sign constraints v~=0 -&gt; sign(delta_mu) = -sign(v)</span>
0008 <span class="comment">%</span>
0009 <span class="comment">% v: (size nr x n_exp) flux matrix, only used for sign constraints</span>
0010 
0011 [nm,nr] = size(N);
0012 n_exp   = size(v,2);
0013 
0014 <span class="keyword">if</span> ~isfield(constraints,<span class="string">'mu_data'</span>),
0015   constraints.mu_data.mean = zeros(nm*n_exp,1);
0016   constraints.mu_data.std  = 10*ones(nm*n_exp,1);
0017 <span class="keyword">end</span>
0018 
0019 <span class="comment">% -----------------------------------------------------------------</span>
0020 <span class="comment">% use combined vector x = [mu0; log_c];</span>
0021 
0022 x_mean = [parameter_prior.mu0.mean; reshape(data.log_c.mean,nm*n_exp,1)];
0023 x_cov  = <a href="../../../mnt/utils/matrix_add_block.html" class="code" title="function M = matrix_add_block(A,B);">matrix_add_block</a>(parameter_prior.mu0.cov,diag(reshape(data.log_c.std,nm*n_exp,1).^2));
0024 
0025 <span class="comment">% build matrix M such that mu = M * x;</span>
0026 <span class="comment">% NRt contains the independent rows of N'</span>
0027 <span class="comment">% example 3 exp. samples:</span>
0028 <span class="comment">%</span>
0029 <span class="comment">%         ( I  RT*I    -      -    )</span>
0030 <span class="comment">% M     = ( I    -    RT*I    -    )</span>
0031 <span class="comment">%         ( I    -      -    RT*I  )</span>
0032 
0033 [dum, L, NRt] = <a href="../../../mnt/mnt_mca/analyse_N.html" class="code" title="function [K, L, NR, null_l, pinv_NR, independent_metabolites, N1] = analyse_N(N,external)">analyse_N</a>(N');
0034 dum = []; <span class="keyword">for</span> it = 1:n_exp, dum = <a href="../../../mnt/utils/matrix_add_block.html" class="code" title="function M = matrix_add_block(A,B);">matrix_add_block</a>(dum,<a href="../../../mnt/mnt_numbers/RT.html" class="code" title="function result = RT(temperature)">RT</a>*eye(nm)); <span class="keyword">end</span>
0035 M   = [repmat(eye(nm),n_exp,1), dum];
0036 
0037 
0038 <span class="comment">% ------------------------------------------------------------</span>
0039 <span class="comment">% mean and covariance of mu predicted from knowledge about mu0 and log c</span>
0040 
0041 mu_mean = M * x_mean;
0042 mu_cov  = full(M * x_cov * M');
0043 
0044 
0045 <span class="comment">% ------------------------------------------------------------</span>
0046 <span class="comment">% define the matrix LL such that delta_mu = LL * mu</span>
0047 
0048 LL  = []; <span class="keyword">for</span> it = 1:n_exp, LL = <a href="../../../mnt/utils/matrix_add_block.html" class="code" title="function M = matrix_add_block(A,B);">matrix_add_block</a>(LL,N'); <span class="keyword">end</span>
0049 
0050 
0051 <span class="comment">%------------------------------------------------------------------</span>
0052 <span class="comment">% the sign constraint sign(delta_mu) = delta_mu_signs</span>
0053 <span class="comment">% is formulated as options.epsilon_delta_mu &lt; delta_mu_signs * LL * delta_mu_ind = LLL * delta_mu_ind</span>
0054 <span class="comment">% (rows for unspecified signs because of (v_r = 0) are removed in LLL)</span>
0055 <span class="comment">%</span>
0056 <span class="comment">% in addition, we require that  LLL * delta_mu_ind &lt; options.epsilon_delta_mu</span>
0057 <span class="comment">% (upper limit on all absolute values of delta_mu)</span>
0058 <span class="comment">% requested signs of delta_mu  as a (nr x n_exp) matrix</span>
0059 
0060 delta_mu_signs = -reshape(sign(v),nr*n_exp,1);
0061 
0062 rel_signs   = find(delta_mu_signs~=0);
0063 irrel_signs = find(~isfinite(delta_mu_signs));
0064 LLL         = diag(delta_mu_signs(rel_signs)) * LL(rel_signs,:);
0065 
0066 xmax     = constraints.dmu_limit;
0067 H        = inv(mu_cov); H = 1/2*(H+H');
0068 f        = - H * mu_mean;
0069 A        = full( [-LLL; <span class="keyword">...</span>
0070                    LLL; <span class="keyword">...</span>
0071                   -LL(irrel_signs,:); <span class="keyword">...</span>
0072                    LL(irrel_signs,:) ]);
0073 b        = [-options.epsilon_delta_mu * ones(size(LLL,1),1); <span class="keyword">...</span>
0074              xmax * ones(size(LLL,1),1); 
0075             -xmax * ones(length(irrel_signs),1);
0076              xmax * ones(length(irrel_signs),1);]; 
0077 mu_lower = [constraints.mu_data.mean - constraints.mu_data.std];
0078 mu_upper = [constraints.mu_data.mean + constraints.mu_data.std];
0079 mu_init  = constraints.mu_data.mean;
0080 
0081 [this_mu,fval,e] = fminconIPasQPsolver(H,f,A,b,mu_lower,mu_upper,mu_init);
0082 
0083 <span class="comment">%opt = optimset; opt.MaxIter = 100000000; opt.LargeScale = 'off'; % opt.TolCon = 10^-8;</span>
0084 <span class="comment">%[this_mu,fval,exitflag] = quadprog(H, f, A, b, [], [], mu_lower, mu_upper, mu_init, opt);</span>
0085 
0086 <span class="comment">%sum((A*this_mu-b)&gt;0)</span>
0087 
0088 <span class="keyword">if</span> sum(LLL*this_mu&lt;0),
0089   warning(<span class="string">'  Sign condition violated'</span>);
0090 <span class="comment">%  ind = find(LLL*this_mu&lt;0);</span>
0091 <span class="comment">%  this_mu = this_mu - 1.1 * pinv(LLL(ind,:)) * [LLL(ind,:) * this_mu];</span>
0092 <span class="keyword">end</span>
0093 
0094 delta_mu_score = gaussian_score(this_mu, mu_mean, mu_cov);
0095 
0096 delta_mu = LL * this_mu;
0097 delta_mu = reshape(delta_mu,nr,n_exp);
0098</pre></div>
<hr><address>Generated on Wed 10-Apr-2013 10:42:33 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>