<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of eba_v_and_mu</title>
  <meta name="keywords" content="eba_v_and_mu">
  <meta name="description" content="[v,mu, value] = eba_v_and_mu(N,K,external,eba_constraints,eba_options,x0)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">mnt</a> &gt; <a href="../index.html">mnt_fluxes</a> &gt; <a href="index.html">eba</a> &gt; eba_v_and_mu.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for mnt/mnt_fluxes/eba&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>eba_v_and_mu
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>[v,mu, value] = eba_v_and_mu(N,K,external,eba_constraints,eba_options,x0)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [v,mu,value] = eba_v_and_mu(N,K,external,eba_constraints,eba_options,x0) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> [v,mu, value] = eba_v_and_mu(N,K,external,eba_constraints,eba_options,x0)

 Determine feasible flux vector v and chemical potentials mu
 under EBA eba_constraints 
 
 x0 starting point for optimisation (if known)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../mnt/mnt_fluxes/eba/eba_util/ebaf/ebaf1.html" class="code" title="function f = eba1(x)">ebaf1</a>	</li><li><a href="../../../mnt/mnt_fluxes/eba/eba_util/ebaf/ebaf2.html" class="code" title="function [C,Ceq] = ebaf2(x,N,epsilon)">ebaf2</a>	</li><li><a href="../../../mnt/mnt_fluxes/eba/eba_util/ebaf/ebaf3.html" class="code" title="function f = ebaf3(x,zv)">ebaf3</a>	</li><li><a href="../../../mnt/utils/default.html" class="code" title="function commandstring = default(varargin)">default</a>	commandstring = default(varname1,defaultvalue1,varname2,defaultvalue2,...)</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [v,mu,value] = eba_v_and_mu(N,K,external,eba_constraints,eba_options,x0)</a>
0002 
0003 <span class="comment">% [v,mu, value] = eba_v_and_mu(N,K,external,eba_constraints,eba_options,x0)</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% Determine feasible flux vector v and chemical potentials mu</span>
0006 <span class="comment">% under EBA eba_constraints</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% x0 starting point for optimisation (if known)</span>
0009 
0010 <span class="comment">% ------------------------------------------------------------</span>
0011 <span class="comment">% vector x contains all v and all mu</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% eba_constraints contains information about ...</span>
0014 <span class="comment">%</span>
0015 <span class="comment">% limits           : eba_constraints.v_min &lt;=   x(1:nr)      &lt;= eba_constraints.v_max</span>
0016 <span class="comment">% limits           : eba_constraints.mu_min &lt;=   x(nr+(1:nm)) &lt;= eba_constraints.mu_max</span>
0017 <span class="comment">% limits           : eba_constraints.muconmat * x(nr+(1:nm)) &lt;= eba_constraints.muconmax</span>
0018 <span class="comment">% fixed fluxes     : x(ind_fix) = eba_constraints.v_fix(ind_fix)</span>
0019 <span class="comment">% stationary fluxes: N_int * x(1:nr) = 0</span>
0020 <span class="comment">% feasible signs   : diag(x(1:nr)) * N' * x(nr+1:end) &lt;= -epsilon &lt; 0</span>
0021 <span class="comment">% regularisation   : min != sum(x.^2);</span>
0022 <span class="comment">%</span>
0023 <span class="comment">% Rewrite this in the form</span>
0024 <span class="comment">%</span>
0025 <span class="comment">%   A * x &lt;= b</span>
0026 <span class="comment">% Aeq * x  = beq</span>
0027 <span class="comment">%       C  = ebaf2(x,N)   (for signs)</span>
0028 <span class="comment">%     min != ebaf1(x)     (regularisation)</span>
0029 
0030 
0031 
0032 <span class="comment">%  ------------------------------------------------------------</span>
0033 <span class="comment">% initialisation</span>
0034 
0035 eval(<a href="../../../mnt/utils/default.html" class="code" title="function commandstring = default(varargin)">default</a>(<span class="string">'x0'</span>,<span class="string">'[]'</span>));
0036 
0037 <span class="keyword">if</span> isfinite(eba_options.seed), rand(<span class="string">'state'</span>,eba_options.seed); <span class="keyword">end</span>
0038 
0039 [nm,nr] = size(N);
0040 
0041 ind_fix      = find(isfinite(eba_constraints.v_fix));
0042 ind_extsigns = find(isfinite(eba_constraints.ext_sign));
0043 n_int        = sum(external==0); 
0044 N_int        = N(find(external==0),:);
0045 my_eye       = eye(nr);
0046 ind_dmu_max   = find(isfinite(eba_constraints.dmu_max));
0047 ind_dmu_min   = find(isfinite(eba_constraints.dmu_min));
0048 
0049 <span class="comment">%  ------------------------------------------------------------</span>
0050 <span class="comment">% calculation</span>
0051 
0052 A = double([<span class="keyword">...</span>
0053     [-diag(eba_constraints.ext_sign(ind_extsigns)) * N(ind_extsigns,:), zeros(length(ind_extsigns),nm)]; <span class="keyword">...</span>
0054     zeros(size(eba_constraints.muconmat,1),nr), eba_constraints.muconmat;
0055     zeros(length(ind_dmu_max),nr), N(:,ind_dmu_max)';
0056     zeros(length(ind_dmu_min),nr), -N(:,ind_dmu_min)' ]);
0057 
0058 b = [zeros(length(ind_extsigns),1); <span class="keyword">...</span>
0059      eba_constraints.muconmax;
0060      eba_constraints.dmu_max(ind_dmu_max);
0061      -eba_constraints.dmu_min(ind_dmu_max);
0062     ];
0063 
0064 Aeq = double([my_eye(ind_fix,:), zeros(length(ind_fix),nm); <span class="keyword">...</span>
0065               N_int, zeros(n_int,nm)]);
0066 
0067 beq = double([eba_constraints.v_fix(ind_fix); zeros(n_int,1)]);
0068 
0069 xmin = [eba_constraints.v_min; eba_constraints.mu_min];
0070 xmax = [eba_constraints.v_max; eba_constraints.mu_max];
0071 
0072 
0073 <span class="comment">% ----------------------------------------------------------</span>
0074 <span class="comment">% optimisation</span>
0075 
0076 <span class="keyword">for</span> it = 1:eba_options.n_trials,
0077 
0078   exitflag = -1;
0079   opt = optimset(<span class="string">'MaxFunEvals'</span>,1000000,<span class="string">'MaxIter'</span>,1000000);
0080   <span class="keyword">if</span> eba_options.relax_eba_constraint, epsilon = -10^-5;
0081   <span class="keyword">else</span>, epsilon = 10^-5;
0082   <span class="keyword">end</span>
0083   
0084   <span class="keyword">while</span> exitflag&lt;=0,
0085     <span class="keyword">if</span> isempty(x0), x0 = xmin + rand(size(xmin)) .* [xmax-xmin];  <span class="keyword">end</span>
0086 
0087 <span class="comment">%%    x0 &gt; xmin</span>
0088 <span class="comment">%%    x0 &lt; xmax</span>
0089 <span class="comment">%%    ebaf2(x0,full(N),epsilon)&lt;0</span>
0090 <span class="comment">%%    A*x0&lt;b</span>
0091 <span class="comment">%%    Aeq*x0 ==beq</span>
0092     
0093     <span class="keyword">switch</span> eba_options.optimality_criterion,
0094       <span class="keyword">case</span> <span class="string">'z'</span>,
0095         [x,value,exitflag] = fmincon(@(x)-<a href="../../../mnt/mnt_fluxes/eba/eba_util/ebaf/ebaf3.html" class="code" title="function f = ebaf3(x,zv)">ebaf3</a>(x,eba_constraints.zv),x0,A,b,Aeq,beq,xmin,xmax,@(x)<a href="../../../mnt/mnt_fluxes/eba/eba_util/ebaf/ebaf2.html" class="code" title="function [C,Ceq] = ebaf2(x,N,epsilon)">ebaf2</a>(x,full(N),epsilon),opt);
0096       <span class="keyword">case</span> <span class="string">'minimum_norm'</span>,
0097         [x,value,exitflag] = fmincon(@<a href="../../../mnt/mnt_fluxes/eba/eba_util/ebaf/ebaf1.html" class="code" title="function f = eba1(x)">ebaf1</a>,x0,A,b,Aeq,beq,xmin,xmax,@(x)<a href="../../../mnt/mnt_fluxes/eba/eba_util/ebaf/ebaf2.html" class="code" title="function [C,Ceq] = ebaf2(x,N,epsilon)">ebaf2</a>(x,full(N),epsilon),opt);
0098     <span class="keyword">end</span>
0099     value = -value;
0100   <span class="keyword">end</span>
0101   xlist(:,it) = x;
0102   valuelist(it) = value;  
0103 <span class="keyword">end</span>
0104 
0105 [value,ind] = max(valuelist);
0106 x           = xlist(:,ind);
0107 
0108 v  = x(1:nr);
0109 mu = x(nr+1:end);
0110 
0111 
0112 <span class="comment">% ----------------------------------------------------------------------</span>
0113 <span class="comment">% check solution</span>
0114 
0115 <span class="keyword">if</span> sum(v&lt;eba_constraints.v_min), warning(<span class="string">'Solution violates lower limit constraint'</span>); <span class="keyword">end</span>
0116 <span class="keyword">if</span> sum(v&gt;eba_constraints.v_max), warning(<span class="string">'Solution violates upper limit constraint'</span>); <span class="keyword">end</span>
0117 <span class="keyword">if</span> sum(abs(v(isfinite(eba_constraints.v_fix)) - eba_constraints.v_fix(isfinite(eba_constraints.v_fix)))&gt;10^-8), 
0118   warning(<span class="string">'Solution violates prescribed flux constraint'</span>); 
0119 <span class="keyword">end</span>
0120 <span class="keyword">if</span> sum(abs(N_int*v) &gt; 10^-8), warning(<span class="string">'Solution violates stationarity constraint'</span>); <span class="keyword">end</span>
0121 <span class="keyword">if</span> sum(v.*(N'*mu)&gt;-epsilon), warning(<span class="string">'Solution violates energy constraint'</span>); <span class="keyword">end</span></pre></div>
<hr><address>Generated on Wed 10-Apr-2013 10:42:33 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>