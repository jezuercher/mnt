<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of sample_feasible_v</title>
  <meta name="keywords" content="sample_feasible_v">
  <meta name="description" content="v = sample_feasible_v(N, ind_ext, constraints, options)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">mnt</a> &gt; <a href="../index.html">mnt_fluxes</a> &gt; <a href="index.html">flux_sampling</a> &gt; sample_feasible_v.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for mnt/mnt_fluxes/flux_sampling&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>sample_feasible_v
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>v = sample_feasible_v(N, ind_ext, constraints, options)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function v = sample_feasible_v(N, ind_ext, constraints, options) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> v = sample_feasible_v(N, ind_ext, constraints, options)

 Given a network and constraints on fluxes, 
 sample one flux vector v fulfilling thermo constraints

 Input arguments:
  constraints.v_min
  constraints.v_max
  constraints.v_sign
  constraints.ext_signs
  constraints.ind.ignore
  options.epsilon_stationary
  options.cycles

 for information about 'constraints' and 'options', see es_default_options</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../mnt/mnt_fluxes/eba/eba_util/EBA_orth.html" class="code" title="function [feasible,ind_non_orthogonal] = EBA_orth(sign_J,C)">EBA_orth</a>	orthogonal = EBA_orth(sign_J,C)</li><li><a href="../../../mnt/mnt_fluxes/eba/eba_util/eba_beard/EBA_orth.html" class="code" title="function [feasible,ind_non_orthogonal] = EBA_orth(sign_J,C)">EBA_orth</a>	orthogonal = EBA_orth(sign_J,C)</li><li><a href="../../../mnt/mnt_fluxes/eba/eba_util/eba_beard/cycles.html" class="code" title="function C = cycles(N);">cycles</a>	C = cycles(N);</li><li><a href="../../../mnt/mnt_fluxes/flux_feasibility/es_check_flux_constraints.html" class="code" title="function correct = es_check_flux_constraints(v,N,ind_ext,constraints,verbose,epsilon_stationary,C)">es_check_flux_constraints</a>	correct = es_check_flux_constraints(v,N,ind_ext,constraints,verbose,epsilon_stationary,C)</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function v = sample_feasible_v(N, ind_ext, constraints, options)</a>
0002 
0003 <span class="comment">% v = sample_feasible_v(N, ind_ext, constraints, options)</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% Given a network and constraints on fluxes,</span>
0006 <span class="comment">% sample one flux vector v fulfilling thermo constraints</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% Input arguments:</span>
0009 <span class="comment">%  constraints.v_min</span>
0010 <span class="comment">%  constraints.v_max</span>
0011 <span class="comment">%  constraints.v_sign</span>
0012 <span class="comment">%  constraints.ext_signs</span>
0013 <span class="comment">%  constraints.ind.ignore</span>
0014 <span class="comment">%  options.epsilon_stationary</span>
0015 <span class="comment">%  options.cycles</span>
0016 <span class="comment">%</span>
0017 <span class="comment">% for information about 'constraints' and 'options', see es_default_options</span>
0018 
0019 [nm,nr] = size(N);
0020 
0021 <span class="keyword">if</span> ~exist(<span class="string">'constraints'</span>,<span class="string">'var'</span>), 
0022   [options, constraints] = es_default_options(N); 
0023 <span class="keyword">end</span>
0024 
0025 <span class="keyword">if</span> ~isnan(options.seed), 
0026   randn(<span class="string">'state'</span>,options.seed); 
0027   rand(<span class="string">'state'</span>,options.seed); 
0028 <span class="keyword">end</span>
0029 
0030 <span class="keyword">if</span> sum(isnan(constraints.v_fix))==0,
0031   
0032   display(<span class="string">' Using fixed flux distribution'</span>);
0033   v       = constraints.v_fix;
0034   correct = <a href="../../../mnt/mnt_fluxes/flux_feasibility/es_check_flux_constraints.html" class="code" title="function correct = es_check_flux_constraints(v,N,ind_ext,constraints,verbose,epsilon_stationary,C)">es_check_flux_constraints</a>(v,N,ind_ext,constraints,0,options.epsilon_stationary,options.cycles);
0035   <span class="keyword">if</span> ~correct, 
0036     warning(<span class="string">'Unfeasible flux'</span>)
0037     <span class="comment">%correct = es_check_flux_constraints(v,N,ind_ext,constraints,1,options.epsilon_stationary,options.cycles);</span>
0038   <span class="keyword">end</span>
0039   
0040 <span class="keyword">else</span>
0041   
0042   display(<span class="string">' Sampling flux distribution'</span>);
0043 
0044   
0045   <span class="comment">%% ----------------------------------------------------</span>
0046   <span class="comment">%% initialise constraints</span>
0047   
0048   <span class="keyword">if</span> ~isfield(constraints,<span class="string">'v_min'</span>),
0049     constraints.v_min = -constraints.v_max; 
0050   <span class="keyword">end</span>
0051   
0052   constraints.v_min(constraints.v_sign== 1) = 0;
0053   constraints.v_max(constraints.v_sign==-1) = 0;
0054   
0055   ind_v_min    = find(isfinite(constraints.v_min));
0056   ind_v_max    = find(isfinite(constraints.v_max));
0057   ind_vsign    = find(isfinite(constraints.v_sign));
0058   ind_extsign  = find(isfinite(constraints.ext_signs));
0059   
0060   
0061 <span class="comment">% ----------------------------------------------------</span>
0062 <span class="comment">% analyse network structure</span>
0063   
0064   N_int = N(setdiff(1:nm,ind_ext),:);
0065   N_zerofluxes = eye(nr); N_zerofluxes = N_zerofluxes(find(constraints.v_fix==0),:);
0066   
0067   K = null([N_int; N_zerofluxes],<span class="string">'r'</span>);
0068   
0069   <span class="keyword">if</span> ~isfield(options,<span class="string">'cycles'</span>), options.cycles = nan; <span class="keyword">end</span>
0070 
0071   <span class="keyword">if</span> isnan(options.cycles),
0072     <span class="keyword">if</span> isfield(constraints,<span class="string">'ind_ignore'</span>),
0073       use_in_cycles = setdiff(1:size(N,2),constraints.ind_ignore);
0074       NN = N(:,use_in_cycles);
0075       CC = <a href="../../../mnt/mnt_fluxes/eba/eba_util/eba_beard/cycles.html" class="code" title="function C = cycles(N);">cycles</a>(NN);
0076       C  = zeros(size(N,2),size(CC,2));
0077       C(use_in_cycles,:) = CC;
0078     <span class="keyword">else</span>
0079       C = <a href="../../../mnt/mnt_fluxes/eba/eba_util/eba_beard/cycles.html" class="code" title="function C = cycles(N);">cycles</a>(N);
0080     <span class="keyword">end</span>
0081   <span class="keyword">else</span>,
0082     C = options.cycles;
0083   <span class="keyword">end</span>
0084   n_vred   = size(K,2);
0085   <span class="comment">%n_cycles = size(C,2);</span>
0086   
0087 <span class="comment">% ----------------------------------------------------</span>
0088 <span class="comment">% compute minimal bounding box for reduced flux vectors</span>
0089 <span class="comment">% satisfying v = K * v_red</span>
0090 
0091     clear vred_lower vred_upper
0092 
0093     G = [-K(ind_v_min,:); <span class="keyword">...</span>
0094           K(ind_v_max,:); <span class="keyword">...</span>
0095          - diag(constraints.ext_signs(ind_extsign)) * N(ind_extsign,:) * K ]; 
0096     h = [-constraints.v_min(ind_v_min);<span class="keyword">...</span>
0097          constraints.v_max(ind_v_max);
0098          zeros(length(ind_extsign),1)];
0099     
0100     <span class="keyword">for</span> it =1:n_vred,
0101       c                = zeros(n_vred,1); 
0102       c(it)            = 1;
0103       vred_opt         = lp236a(c,G,h,[],[]);
0104       vred_lower(it,1) = vred_opt(it);
0105       vred_opt         = lp236a(-c,G,h,[],[]);
0106       vred_upper(it,1) = vred_opt(it);
0107     <span class="keyword">end</span>
0108     
0109     
0110 <span class="comment">% ----------------------------------------------------</span>
0111 <span class="comment">% sample a reduced flux vector (in the bounding box) that</span>
0112 <span class="comment">% corresponds to a feasible flux sign pattern</span>
0113     
0114     it       = 0;
0115     feasible = 0; 
0116     
0117     <span class="keyword">while</span> ~feasible,
0118       
0119       it = it+1;
0120       
0121       <span class="keyword">if</span> options.verbose, display(sprintf(<span class="string">' Sampling flux vector. Trial %d '</span>,it)); <span class="keyword">end</span> 
0122       
0123       within_bounds = 0;
0124       <span class="keyword">while</span> ~within_bounds,
0125         v = K * [vred_lower + rand(n_vred,1) .* [vred_upper-vred_lower] ];
0126         within_bounds = <span class="keyword">...</span>
0127             (sum(constraints.v_min &gt; v) == 0) * <span class="keyword">...</span>
0128             (sum(constraints.v_max &lt; v) == 0) * <span class="keyword">...</span>
0129             (sum( constraints.ext_signs(ind_extsign) ~= sign(N(ind_extsign,:) * v))==0);
0130       <span class="keyword">end</span>
0131 
0132       feasible = <a href="../../../mnt/mnt_fluxes/eba/eba_util/EBA_orth.html" class="code" title="function [feasible,ind_non_orthogonal] = EBA_orth(sign_J,C)">EBA_orth</a>(sign(v),C);
0133       
0134     <span class="keyword">end</span>
0135     
0136 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Fri 05-Apr-2013 16:43:00 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>