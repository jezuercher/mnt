<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of convenience_velocities</title>
  <meta name="keywords" content="convenience_velocities">
  <meta name="description" content="v = convenience_velocities(s,network,kinetics,indices,split,scale_G,offset_ratio)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="#">mnt</a> &gt; <a href="#">mnt_kinetics</a> &gt; <a href="#">convenience</a> &gt; convenience_velocities.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for ./mnt/mnt_kinetics/convenience&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>convenience_velocities
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>v = convenience_velocities(s,network,kinetics,indices,split,scale_G,offset_ratio)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function v = convenience_velocities(s,network,kinetics,indices,split,scale_G,offset_ratio) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> v = convenience_velocities(s,network,kinetics,indices,split,scale_G,offset_ratio)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../.././mnt/utils/column.html" class="code" title="function x = column(x)">column</a>	transform a vector (row or column) into a column vector</li><li><a href="../../.././mnt/utils/default.html" class="code" title="function commandstring = default(varargin)">default</a>	commandstring = default(varname1,defaultvalue1,varname2,defaultvalue2,...)</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../.././mnt/mnt_kinetics/kinetics/network_velocities.html" class="code" title="function v = network_velocities(s, network, kinetics, split, indices,t)">network_velocities</a>	v = network_velocities(s,network,kinetics,split,indices,t)</li></ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function v = convenience_velocities(s,network,kinetics,indices,split,scale_G,offset_ratio)</a>
0002 
0003 <span class="comment">% v = convenience_velocities(s,network,kinetics,indices,split,scale_G,offset_ratio)</span>
0004 
0005 eval(<a href="../../.././mnt/utils/default.html" class="code" title="function commandstring = default(varargin)">default</a>(<span class="string">'kinetics'</span>,<span class="string">'network.kinetics'</span>,<span class="keyword">...</span>
0006              <span class="string">'indices'</span>,<span class="string">'1:length(network.actions)'</span>,<span class="keyword">...</span>
0007              <span class="string">'split'</span>,<span class="string">'0'</span>,<span class="keyword">...</span>
0008              <span class="string">'scale_G'</span>,<span class="string">'convert_G_scale'</span>,<span class="keyword">...</span>
0009              <span class="string">'offset_ratio'</span>,<span class="string">'0.2'</span>));
0010 
0011 <span class="comment">% v = convenience_velocities(s,network,kinetics,indices,split)</span>
0012 <span class="comment">% kinetic law for convenience kinetics</span>
0013 
0014 N_sparse            = sparse(network.N(:,indices));
0015 KA_mat              = kinetics.KA(indices,:);
0016 KI_mat              = kinetics.KI(indices,:);
0017 KM_mat              = kinetics.KM(indices,:);
0018 
0019 [nm,nr]             = size(N_sparse);
0020 empty_matrix        = sparse(nr,nm);
0021 N_sparse_trans      = N_sparse';
0022 N_abs_trans         = abs(N_sparse_trans);
0023 Nminus              = empty_matrix';
0024 Nplus               = Nminus;
0025 Nminus(find(N_sparse&lt;0)) = abs(N_sparse(find(N_sparse&lt;0)));
0026  Nplus(find(N_sparse&gt;0)) = abs(N_sparse(find(N_sparse&gt;0)));
0027 ind_substrate       = <a href="../../.././mnt/utils/column.html" class="code" title="function x = column(x)">column</a>(find(N_sparse_trans&lt;0));
0028 ind_product         = <a href="../../.././mnt/utils/column.html" class="code" title="function x = column(x)">column</a>(find(N_sparse_trans&gt;0));
0029 ind_both            = <a href="../../.././mnt/utils/column.html" class="code" title="function x = column(x)">column</a>(find(N_sparse_trans~=0));
0030 ind_KM              = [ind_substrate; ind_product];
0031 ind_KA              = find(network.regulation_matrix(indices,:) &gt; 0);
0032 ind_KI              = find(network.regulation_matrix(indices,:) &lt; 0);
0033 sparse_diag_s       = diag(sparse(s));
0034     
0035 sqrt_q = exp( 0.5 * (- N_sparse_trans) * log(kinetics.g)/scale_G);
0036 
0037 <span class="keyword">if</span> sum(sqrt_q&lt;10^-8)+sum(sqrt_q&lt;10^-8),
0038 <span class="comment">%  warning('Extreme equilibrium constants encountered');</span>
0039   sqrt_q(sqrt_q&lt;10^-8) = 10^-8;
0040   sqrt_q(sqrt_q&gt;10^8)  = 10^8;
0041 <span class="keyword">end</span>
0042 
0043 <span class="comment">% kinetic terms</span>
0044 
0045 KM_inv         = empty_matrix;
0046 KM_inv(ind_KM) = 1./ KM_mat(ind_KM);    
0047 KM_inv_c       = KM_inv * sparse_diag_s;
0048 
0049 c_mat         = (N_sparse_trans~=0) * sparse_diag_s;
0050 c_num         = empty_matrix;
0051 c_num(ind_KM) = c_mat(ind_KM) .^ N_abs_trans(ind_KM);
0052 
0053 KM_inv_c_den         = empty_matrix;
0054 KM_inv_c_den(ind_KM) = 1;
0055 
0056 <span class="keyword">for</span> zz = 1:full(max(max(abs(N_sparse)))),
0057   KM_inv_c_den(find(N_abs_trans&gt;=zz)) = KM_inv_c_den(find(N_abs_trans&gt;=zz)) + KM_inv_c(find(N_abs_trans&gt;=zz)) .^ zz;
0058 <span class="keyword">end</span>
0059 
0060 numerator_substrate_term_mat   = empty_matrix;
0061 numerator_product_term_mat     = empty_matrix;
0062 numerator_factor_term_mat      = empty_matrix;
0063 denominator_substrate_term_mat = empty_matrix;
0064 denominator_product_term_mat   = empty_matrix;
0065 
0066 numerator_substrate_term_mat(ind_substrate) = log(c_num(ind_substrate));
0067 numerator_product_term_mat(ind_product)     = log(c_num(ind_product));
0068 numerator_factor_term_mat(ind_both)         = log(KM_inv(ind_both)).*N_abs_trans(ind_KM);
0069 
0070 denominator_substrate_term_mat(ind_substrate) = log(KM_inv_c_den(ind_substrate));
0071 denominator_product_term_mat(ind_product)     = log(KM_inv_c_den(ind_product));
0072 
0073 numerator_substrate_term   = exp(sum(numerator_substrate_term_mat,2));
0074 numerator_product_term     = exp(sum(numerator_product_term_mat  ,2));
0075 numerator_factor_term      = exp(sum(numerator_factor_term_mat   ,2));
0076 denominator_substrate_term = exp(sum(denominator_substrate_term_mat,2));
0077 denominator_product_term   = exp(sum(denominator_product_term_mat  ,2));
0078 
0079 <span class="keyword">if</span> sum(numerator_factor_term&gt;10^8),
0080 <span class="comment">%  warning('Extreme numerator term encountered');</span>
0081   numerator_factor_term(numerator_factor_term&gt;10^8) = 10^8;
0082 <span class="keyword">end</span>
0083 
0084 denominator                = denominator_substrate_term + denominator_product_term - 1;
0085 
0086 <span class="comment">% regulatory prefactor</span>
0087 
0088 pre = kinetics.E(indices) .* kinetics.r(indices);
0089 
0090 <span class="keyword">if</span> length(ind_KA),  
0091   Wplus_c  = (KA_mat&gt;0) * sparse_diag_s;
0092   pre_A_mat = empty_matrix;
0093   pre_A_mat(ind_KA) =  log( Wplus_c(ind_KA) ./ ( KA_mat(ind_KA) +  Wplus_c(ind_KA) ));  
0094   pre = pre .* [offset_ratio + [1-offset_ratio] * exp(sum(pre_A_mat,2))];
0095 <span class="keyword">end</span>
0096 
0097 <span class="keyword">if</span> length(ind_KI), 
0098   Wminus_c = (KI_mat&gt;0) * sparse_diag_s;
0099   pre_I_mat = empty_matrix;
0100   pre_I_mat(ind_KI) =  log( KI_mat(ind_KI)  ./ ( KI_mat(ind_KI) +  Wminus_c(ind_KI) )); 
0101   pre = pre .* [ offset_ratio + [1-offset_ratio] * exp(sum(pre_I_mat,2))];
0102 <span class="keyword">end</span>
0103 
0104 <span class="comment">%if pre&lt;=0,               warning('Zero or negative prefactor encountered');  end</span>
0105 <span class="comment">%if min(denominator) &lt;=0, warning('Zero or negative denominator encountered'); end</span>
0106 
0107 <span class="comment">% complete rate law</span>
0108 
0109 <span class="keyword">if</span> split,
0110   v = [full(pre .* numerator_factor_term .* (    sqrt_q .* numerator_substrate_term ) ./ denominator) ;<span class="keyword">...</span>
0111        full(pre .* numerator_factor_term .* ( 1./sqrt_q .* numerator_product_term   ) ./ denominator) <span class="keyword">...</span>
0112       ];      
0113 <span class="keyword">else</span>,
0114   v = full(pre .* numerator_factor_term .* ( sqrt_q .* numerator_substrate_term - 1 ./ sqrt_q .* numerator_product_term ) ./ denominator );
0115 <span class="keyword">end</span>
0116 
0117 <span class="comment">%compute reaction affinity</span>
0118 <span class="comment">% vplus  = sqrt_q .* numerator_substrate_term;</span>
0119 <span class="comment">% vminus = 1 ./ sqrt_q .* numerator_product_term;</span>
0120 <span class="comment">% A = full(RT * log(vplus./vminus));</span>
0121 <span class="comment">% find(abs(A) &lt; 10^-1)'</span></pre></div>
<hr><address>Generated on Sat 15-Nov-2014 18:05:26 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>