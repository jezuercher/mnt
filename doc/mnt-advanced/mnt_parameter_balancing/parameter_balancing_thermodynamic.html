<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of parameter_balancing_thermodynamic</title>
  <meta name="keywords" content="parameter_balancing_thermodynamic">
  <meta name="description" content="[c, v, mu0, Keq, A, my_kinetic_data] = parameter_balancing_theromdynamic(network, v, filename,options)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">mnt-advanced</a> &gt; <a href="#">mnt_parameter_balancing</a> &gt; parameter_balancing_thermodynamic.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for ./mnt-advanced/mnt_parameter_balancing&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>parameter_balancing_thermodynamic
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>[c, v, mu0, Keq, A, my_kinetic_data] = parameter_balancing_theromdynamic(network, v, filename,options)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [c, mu0, Keq, A, my_kinetic_data] = parameter_balancing_thermodynamic(network, v, filename, options) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> [c, v, mu0, Keq, A, my_kinetic_data] = parameter_balancing_theromdynamic(network, v, filename,options)

 Convenience function for using parameter balancing to obtain a steady state 
 given a thermodynamically feasible flux distribution
 
 The code assumes that the network structure contains KEGG IDs and uses
 SBtab data files supplied that can contain data on standard chemical potentials,
 equilibrium constants, concentrations, and reaction affinities

 Fields of options:
   options.ind_water           (indices of metabolites representing water)
   options.data_refer_to_molar = 0;    (flag)
   options.flag_pseudo_value   = 0;    (flag; use pseudo values?)
   options.A_max               = 1000; (kJ/mol)
   options.A_min               = 0.5;  (kJ/mol)
   options.A_mean              = nan;  (kJ/mol)
   options.A_std               = std;  (kJ/mol)
   options.A_lower             = nan * ones(nr,1);
   options.A_upper             = nan * ones(nr,1);
   options.conc_min            = 0.00001; (mM)
   options.conc_max            = 100;     (mM)
   options.c_fix               = nan   (vector)
   options.u_max               = 1000; (mM)
   options.u_min               = 0.01; (mM)
   options.variability         = 2;    variability of known concentrations
   options.sigma_mu0           = 3;    error of mu0 values (kJ/mol); 3 for alberty data

 my_kinetic_data: data and assumptions finally used in the optimisation task</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../.././mnt-advanced/mnt_data_integration/data_integration_bounds_pseudovalues.html" class="code" title="function kinetic_data = data_integration_bounds_pseudovalues(kinetic_data,quantity_info,flag_pseudo_values,network,verbose)">data_integration_bounds_pseudovalues</a>	kinetic_data = data_integration_bounds_pseudovalues(kinetic_data,quantity_info,flag_pseudo_values,network);</li><li><a href="../.././mnt-advanced/mnt_data_integration/data_integration_load_kinetic_data.html" class="code" title="function kinetic_data = data_integration_load_kinetic_data(data_quantities, quantity_info, network, file_kinetic_data, use_sbml_ids, use_kegg_ids, flag_invent_std, verbose, filter_column, filter_entry,reaction_column_name,compound_column_name)">data_integration_load_kinetic_data</a>	kinetic_data = data_integration_load_kinetic_data(data_quantities, quantity_info, network, file_kinetic_data, use_sbml_ids, use_kegg_ids, flag_invent_std, verbose)</li><li><a href="../.././mnt-advanced/mnt_data_integration/data_integration_load_quantity_info.html" class="code" title="function quantity_info = data_integration_load_quantity_info(omit_quantities, quantity_info_filename)">data_integration_load_quantity_info</a>	quantity_info = data_integration_load_quantity_info(omit_quantities,quantity_info_filename)</li><li><a href="parameter_balancing.html" class="code" title="function [res, exitflag] = parameter_balancing(task, quantity_info, options)">parameter_balancing</a>	[res, exitflag] = parameter_balancing(task, quantity_info, options)</li><li><a href="parameter_balancing_task.html" class="code" title="function [task, prior] = parameter_balancing_task(network, kinetic_data, quantity_info, model_quantities, basic_quantities)">parameter_balancing_task</a>	Prepare vectors and matrices for parameter balancing</li><li><a href="parameter_balancing_thermodynamic.html" class="code" title="function [c, mu0, Keq, A, my_kinetic_data] = parameter_balancing_thermodynamic(network, v, filename, options)">parameter_balancing_thermodynamic</a>	[c, v, mu0, Keq, A, my_kinetic_data] = parameter_balancing_theromdynamic(network, v, filename,options)</li><li><a href="../.././mnt/mnt_kinetics/kinetics/set_kinetics.html" class="code" title="function kinetics = set_kinetics(network,type,parameters)">set_kinetics</a>	kinetics = set_kinetics(network,type,parameters)</li><li><a href="../.././mnt/mnt_numbers/RT.html" class="code" title="function result = RT(temperature)">RT</a>	result = RT(temperature)</li><li><a href="../.././mnt/utils/default.html" class="code" title="function commandstring = default(varargin)">default</a>	commandstring = default(varname1,defaultvalue1,varname2,defaultvalue2,...)</li><li><a href="../.././mnt/utils/join_struct.html" class="code" title="function c = join_struct(a,b)">join_struct</a>	c = join_struct(a,b)</li><li><a href="../.././mnt/utils/label_names.html" class="code" title="function [label,indices] = label_names(names,allnames,method)">label_names</a>	function [label,indices] = label_names(names,allnames, method)</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="parameter_balancing_thermodynamic.html" class="code" title="function [c, mu0, Keq, A, my_kinetic_data] = parameter_balancing_thermodynamic(network, v, filename, options)">parameter_balancing_thermodynamic</a>	[c, v, mu0, Keq, A, my_kinetic_data] = parameter_balancing_theromdynamic(network, v, filename,options)</li></ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [c, mu0, Keq, A, my_kinetic_data] = parameter_balancing_thermodynamic(network, v, filename, options)</a>
0002 
0003 <span class="comment">% [c, v, mu0, Keq, A, my_kinetic_data] = parameter_balancing_theromdynamic(network, v, filename,options)</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% Convenience function for using parameter balancing to obtain a steady state</span>
0006 <span class="comment">% given a thermodynamically feasible flux distribution</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% The code assumes that the network structure contains KEGG IDs and uses</span>
0009 <span class="comment">% SBtab data files supplied that can contain data on standard chemical potentials,</span>
0010 <span class="comment">% equilibrium constants, concentrations, and reaction affinities</span>
0011 <span class="comment">%</span>
0012 <span class="comment">% Fields of options:</span>
0013 <span class="comment">%   options.ind_water           (indices of metabolites representing water)</span>
0014 <span class="comment">%   options.data_refer_to_molar = 0;    (flag)</span>
0015 <span class="comment">%   options.flag_pseudo_value   = 0;    (flag; use pseudo values?)</span>
0016 <span class="comment">%   options.A_max               = 1000; (kJ/mol)</span>
0017 <span class="comment">%   options.A_min               = 0.5;  (kJ/mol)</span>
0018 <span class="comment">%   options.A_mean              = nan;  (kJ/mol)</span>
0019 <span class="comment">%   options.A_std               = std;  (kJ/mol)</span>
0020 <span class="comment">%   options.A_lower             = nan * ones(nr,1);</span>
0021 <span class="comment">%   options.A_upper             = nan * ones(nr,1);</span>
0022 <span class="comment">%   options.conc_min            = 0.00001; (mM)</span>
0023 <span class="comment">%   options.conc_max            = 100;     (mM)</span>
0024 <span class="comment">%   options.c_fix               = nan   (vector)</span>
0025 <span class="comment">%   options.u_max               = 1000; (mM)</span>
0026 <span class="comment">%   options.u_min               = 0.01; (mM)</span>
0027 <span class="comment">%   options.variability         = 2;    variability of known concentrations</span>
0028 <span class="comment">%   options.sigma_mu0           = 3;    error of mu0 values (kJ/mol); 3 for alberty data</span>
0029 <span class="comment">%</span>
0030 <span class="comment">% my_kinetic_data: data and assumptions finally used in the optimisation task</span>
0031 
0032 [nm,nr] = size(network.N);
0033 
0034 eval(<a href="../.././mnt/utils/default.html" class="code" title="function commandstring = default(varargin)">default</a>(<span class="string">'options'</span>,<span class="string">'struct'</span>));
0035 
0036 options_default.ind_water           = [];
0037 options_default.set_water_conc_to_one = 1;
0038 options_default.data_refer_to_molar = 0;
0039 options_default.flag_pseudo_values  = 0;
0040 options_default.sigma_mu0           = 3;<span class="comment">%    error of mu0 values (kJ/mol); 3 for alberty data</span>
0041 options_default.A_max               = 100;
0042 options_default.A_min               = 0.5;  
0043 options_default.c_fix               = nan * ones(nm,1);
0044 options_default.A_fix               = nan * ones(nr,1);
0045 options_default.A_lower             = nan * ones(nr,1);
0046 options_default.A_upper             = nan * ones(nr,1);
0047 options_default.conc_min            = 0.00001; <span class="comment">%(mM)</span>
0048 options_default.conc_max            = 100;     <span class="comment">%(mM)</span>
0049 options_default.virtual_reactions   = {};
0050 
0051 options = <a href="../.././mnt/utils/join_struct.html" class="code" title="function c = join_struct(a,b)">join_struct</a>(options_default,options);
0052 
0053 
0054 <span class="comment">% --------------------------------------------------------</span>
0055 <span class="comment">% virtual reactions, whose affinities should be controlled</span>
0056 <span class="comment">% (e.g., the driving force in spontaneous ATP hydrolysis)</span>
0057 
0058 <span class="keyword">if</span> length(options.virtual_reactions),
0059 
0060   <span class="comment">%% add virtual reactions to the network and run parameter balancing</span>
0061   v_aug           = [v; ones(length(options.virtual_reactions),1)];
0062   options.A_lower = [options.A_lower; options.virtual_A_lower];
0063   options.A_upper = [options.A_upper; options.virtual_A_upper];
0064 
0065   network_aug     = network;
0066   <span class="keyword">for</span> it = 1:length(options.virtual_reactions),
0067     nn = zeros(nm,1);
0068     ind     = <a href="../.././mnt/utils/label_names.html" class="code" title="function [label,indices] = label_names(names,allnames,method)">label_names</a>(options.virtual_reactions(it).metabolites, network.metabolites);
0069     nn(ind) = options.virtual_reactions(it).stoichiometries;
0070     network_aug.N   = [network_aug.N, nn];
0071     network_aug.actions = [network_aug.actions; {sprintf(<span class="string">'aug_%f'</span>,it)}];
0072   <span class="keyword">end</span>
0073 
0074   ooptions = rmfield(options, <span class="string">'virtual_reactions'</span>);
0075   [c, mu0, Keq_aug, A_aug, my_kinetic_data] = <a href="parameter_balancing_thermodynamic.html" class="code" title="function [c, mu0, Keq, A, my_kinetic_data] = parameter_balancing_thermodynamic(network, v, filename, options)">parameter_balancing_thermodynamic</a>(network_aug, v, filename, ooptions);
0076 
0077   A   =   A_aug(1:end-length(options.virtual_reactions));
0078   Keq = Keq_aug(1:end-length(options.virtual_reactions));
0079 
0080   <span class="keyword">return</span>
0081 
0082 <span class="keyword">end</span>
0083 
0084 
0085 <span class="comment">% ------------------------------------------------------------------------</span>
0086 <span class="comment">% read standard chemical potentials</span>
0087 
0088 <span class="comment">% load Gibbs free energies of formation ... this requires metabolite KEGG IDs in the model!</span>
0089 
0090 data_quantities = {<span class="string">'standard chemical potential'</span>,<span class="string">'equilibrium constant'</span>, <span class="string">'concentration'</span>,<span class="string">'reaction affinity'</span>}';
0091 quantity_info   = <a href="../.././mnt-advanced/mnt_data_integration/data_integration_load_quantity_info.html" class="code" title="function quantity_info = data_integration_load_quantity_info(omit_quantities, quantity_info_filename)">data_integration_load_quantity_info</a>;
0092 kinetic_data    = <a href="../.././mnt-advanced/mnt_data_integration/data_integration_load_kinetic_data.html" class="code" title="function kinetic_data = data_integration_load_kinetic_data(data_quantities, quantity_info, network, file_kinetic_data, use_sbml_ids, use_kegg_ids, flag_invent_std, verbose, filter_column, filter_entry,reaction_column_name,compound_column_name)">data_integration_load_kinetic_data</a>(data_quantities, quantity_info, network, filename, 0, 1);
0093 
0094 <span class="comment">% for which metabolite concentrations do we have standard chemical potentials?</span>
0095 <span class="comment">% mu0 = kinetic_data.mu0.median;</span>
0096 <span class="comment">% figure(2); netgraph_concentrations(network_CoHid,isfinite(mu0),[],1,gp)</span>
0097 
0098 <span class="keyword">if</span> options.data_refer_to_molar,
0099 
0100   ind_cor = setdiff(1:nm,options.ind_water);
0101   kinetic_data.mu0.median(ind_cor)  = kinetic_data.mu0.median(ind_cor) - <a href="../.././mnt/mnt_numbers/RT.html" class="code" title="function result = RT(temperature)">RT</a> * log(1000); 
0102   kinetic_data.mu0.mean(ind_cor)    = kinetic_data.mu0.mean(ind_cor)   - <a href="../.././mnt/mnt_numbers/RT.html" class="code" title="function result = RT(temperature)">RT</a> * log(1000); 
0103   kinetic_data.mu0.lower(ind_cor)   = kinetic_data.mu0.lower(ind_cor)  - <a href="../.././mnt/mnt_numbers/RT.html" class="code" title="function result = RT(temperature)">RT</a> * log(1000); 
0104   kinetic_data.mu0.upper(ind_cor)   = kinetic_data.mu0.upper(ind_cor)  - <a href="../.././mnt/mnt_numbers/RT.html" class="code" title="function result = RT(temperature)">RT</a> * log(1000); 
0105   kinetic_data.c.median             = kinetic_data.c.median   * 1000; 
0106   kinetic_data.c.mean               = kinetic_data.c.mean     * 1000; 
0107   kinetic_data.c.std                = kinetic_data.c.std      * 1000; 
0108   kinetic_data.c.lower              = kinetic_data.c.lower    * 1000; 
0109   kinetic_data.c.upper              = kinetic_data.c.upper    * 1000; 
0110   kinetic_data.c.mean_ln            = kinetic_data.c.mean_ln  + log(1000); 
0111   kinetic_data.c.lower_ln           = kinetic_data.c.lower_ln + log(1000); 
0112   kinetic_data.c.upper_ln           = kinetic_data.c.upper_ln + log(1000); 
0113   
0114   kinetic_data = concentration_sampling_update_kinetic_data(kinetic_data, network, v, options);
0115 
0116 <span class="keyword">end</span>
0117 
0118 <span class="keyword">if</span> options.set_water_conc_to_one, 
0119   options.c_fix(options.ind_water) = 1; 
0120 <span class="keyword">end</span>
0121 
0122 
0123 <span class="comment">% -----------------------</span>
0124 <span class="comment">% fix mu0 values and concentrations exactly at data values</span>
0125 
0126 <span class="comment">% TOO SMALL VALUES HERE CAN LEAD TO NUMERICAL PROBLEMS LATER ON</span>
0127 <span class="comment">% IN PARAMETER BALANCING (QUADPROG)</span>
0128 
0129 kinetic_data.mu0.std(find(isfinite(kinetic_data.mu0.std)))   = 10^-4;
0130 kinetic_data.c.std(find(isfinite(kinetic_data.c.std)))       = 10^-4;
0131 kinetic_data.c.std_ln(find(isfinite(kinetic_data.c.std_ln))) = 10^-4;
0132 
0133 
0134 <span class="comment">% ------------------------------------------------------------------------</span>
0135 <span class="comment">% Determine consistent parameter set by parameter balancing</span>
0136 
0137 quantity_info     = <a href="../.././mnt-advanced/mnt_data_integration/data_integration_load_quantity_info.html" class="code" title="function quantity_info = data_integration_load_quantity_info(omit_quantities, quantity_info_filename)">data_integration_load_quantity_info</a>;
0138 model_quantities  = {<span class="string">'standard chemical potential'</span>,<span class="string">'equilibrium constant'</span>, <span class="string">'concentration'</span>,<span class="string">'reaction affinity'</span>}';
0139 data_quantities   = {<span class="string">'standard chemical potential'</span>,<span class="string">'equilibrium constant'</span>, <span class="string">'concentration'</span>,<span class="string">'reaction affinity'</span>}';
0140 basic_quantities  = {<span class="string">'standard chemical potential'</span>,<span class="string">'concentration'</span>}';
0141 
0142 my_kinetic_data = kinetic_data;
0143 
0144 
0145 <span class="comment">% prepare data for parameter balancing</span>
0146 
0147 quantity_info.LowerBound{quantity_info.symbol_index.c}   = <span class="string">'0.001'</span>;
0148 quantity_info.UpperBound{quantity_info.symbol_index.c}   = <span class="string">'100'</span>;
0149 quantity_info.LowerBound{quantity_info.symbol_index.A}   = <span class="string">'-60'</span>;
0150 quantity_info.UpperBound{quantity_info.symbol_index.A}   = <span class="string">'60'</span>;
0151 quantity_info.LowerBound{quantity_info.symbol_index.Keq} = <span class="string">'0.000001'</span>;
0152 quantity_info.UpperBound{quantity_info.symbol_index.Keq} = <span class="string">'1000000'</span>;
0153 quantity_info.PriorStd{quantity_info.symbol_index.Keq}   = <span class="string">'0.05'</span>;
0154 
0155 my_kinetic_data.mu0.std = options.sigma_mu0 * ones(nm,1);
0156 
0157 my_kinetic_data = <a href="../.././mnt-advanced/mnt_data_integration/data_integration_bounds_pseudovalues.html" class="code" title="function kinetic_data = data_integration_bounds_pseudovalues(kinetic_data,quantity_info,flag_pseudo_values,network,verbose)">data_integration_bounds_pseudovalues</a>(my_kinetic_data,quantity_info,options.flag_pseudo_values,network);
0158 
0159 my_kinetic_data.c.lower    = options.conc_min * ones(nm,1);
0160 my_kinetic_data.c.upper    = options.conc_max * ones(nm,1);
0161 
0162 ind_fix = find(isfinite(options.c_fix));
0163 my_kinetic_data.c.lower(ind_fix) = 0.95 * options.c_fix(ind_fix);
0164 my_kinetic_data.c.upper(ind_fix) = 1.05 * options.c_fix(ind_fix);
0165 my_kinetic_data.c.lower_ln = log(my_kinetic_data.c.lower);
0166 my_kinetic_data.c.upper_ln = log(my_kinetic_data.c.upper);
0167 
0168 my_kinetic_data.A.upper(v&lt;0) = min(my_kinetic_data.A.upper(v&lt;0),  -options.A_min);
0169 my_kinetic_data.A.lower(v&gt;0) = max(my_kinetic_data.A.lower(v&gt;0),   options.A_min);
0170 my_kinetic_data.A.upper(v&gt;0) = max(my_kinetic_data.A.median(v&gt;0),  options.A_max);
0171 my_kinetic_data.A.lower(v&lt;0) = min(my_kinetic_data.A.median(v&lt;0), -options.A_max);
0172 
0173 ind = find(isfinite(options.A_lower));
0174 my_kinetic_data.A.lower(ind) = max(my_kinetic_data.A.lower(ind), options.A_lower(ind));
0175 
0176 ind = find(isfinite(options.A_upper));
0177 my_kinetic_data.A.upper(ind) = min(my_kinetic_data.A.upper(ind), options.A_upper(ind));
0178 
0179 ind_plus = find(options.A_fix&gt;0);
0180 my_kinetic_data.A.lower(ind_plus) = 0.99 * options.A_fix(ind_plus);
0181 my_kinetic_data.A.upper(ind_plus) = 1.01 * options.A_fix(ind_plus);
0182 
0183 ind_minus = find(options.A_fix&lt;0);
0184 my_kinetic_data.A.lower(ind_minus) = 1.01 * options.A_fix(ind_minus);
0185 my_kinetic_data.A.upper(ind_minus) = 0.99 * options.A_fix(ind_minus);
0186 
0187 network.kinetics = <a href="../.././mnt/mnt_kinetics/kinetics/set_kinetics.html" class="code" title="function kinetics = set_kinetics(network,type,parameters)">set_kinetics</a>(network, <span class="string">'cs'</span>);
0188 
0189 
0190 <span class="comment">% -----------------------------------------------------</span>
0191 <span class="comment">% Parameter balancing calculation</span>
0192 
0193 task = <a href="parameter_balancing_task.html" class="code" title="function [task, prior] = parameter_balancing_task(network, kinetic_data, quantity_info, model_quantities, basic_quantities)">parameter_balancing_task</a>(network, my_kinetic_data, quantity_info, model_quantities, basic_quantities);
0194 
0195 res  = <a href="parameter_balancing.html" class="code" title="function [res, exitflag] = parameter_balancing(task, quantity_info, options)">parameter_balancing</a>(task, quantity_info, struct(<span class="string">'insert_pseudo_values'</span>,0));
0196 
0197 
0198 <span class="comment">% -----------------------------------------------------</span>
0199 <span class="comment">% Output variables</span>
0200 
0201 mu0 = res.kinetics_posterior_mode.mu0;
0202 Keq = res.kinetics_posterior_mode.Keq;
0203 c   = res.kinetics_posterior_mode.c;    
0204 A   = res.kinetics_posterior_mode.A;</pre></div>
<hr><address>Generated on Sat 15-Nov-2014 18:05:26 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>