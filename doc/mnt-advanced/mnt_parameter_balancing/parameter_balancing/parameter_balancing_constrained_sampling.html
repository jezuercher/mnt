<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of parameter_balancing_constrained_sampling</title>
  <meta name="keywords" content="parameter_balancing_constrained_sampling">
  <meta name="description" content="[q_sample, xmodel_sample, xdata_sample, kinetics_sample, v_sample, q_min, q_max] = parameter_balancing_constrained_sampling(task,res,options,quantity_info)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="#">mnt-advanced</a> &gt; <a href="#">mnt_parameter_balancing</a> &gt; <a href="#">parameter_balancing</a> &gt; parameter_balancing_constrained_sampling.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for ./mnt-advanced/mnt_parameter_balancing/parameter_balancing&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>parameter_balancing_constrained_sampling
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>[q_sample, xmodel_sample, xdata_sample, kinetics_sample, v_sample, q_min, q_max] = parameter_balancing_constrained_sampling(task,res,options,quantity_info)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [q_sample, xmodel_sample, xdata_sample, kinetics_sample, v_sample, q_min, q_max] = parameter_balancing_constrained_sampling(task,res,options,quantity_info) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> [q_sample, xmodel_sample, xdata_sample, kinetics_sample, v_sample, q_min, q_max] = parameter_balancing_constrained_sampling(task,res,options,quantity_info)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="parameter_balancing_quantity_numbers.html" class="code" title="function num = parameter_balancing_quantity_numbers(quantities,quantity_info,network)">parameter_balancing_quantity_numbers</a>	count how many quantities of a certain type appear in a model</li><li><a href="parameter_balancing_sample_models.html" class="code" title="function [v, kinetics_list] = parameter_balancing_sample_models(task,kinetics_sample,options)">parameter_balancing_sample_models</a>	</li><li><a href="../../.././mnt/mnt_network/network_query/network_numbers.html" class="code" title="function [nr,nm,nx,KM_indices,KA_indices,KI_indices,nKM,nKA,nKI] = network_numbers(network)">network_numbers</a>	[nr,nm,nx,KM_indices,KA_indices,KI_indices,nKM,nKA,nKI] = network_numbers(network)</li><li><a href="../../.././mnt/utils/convex_sampling.html" class="code" title="function [x, x_lower, x_upper, success_flag, x_lower_list, x_upper_list] = convex_sampling(A_ineq,b_ineq,A_eq,b_eq,n_sample,xl,xu,verbose,method,options)">convex_sampling</a>	[x, x_lower. x_upper, success_flag, x_lower_list, x_upper_list] = convex_sampling(A_ineq,b_ineq,A_eq,b_eq,n_sample,xl,xu);</li><li><a href="../../.././mnt/utils/default.html" class="code" title="function commandstring = default(varargin)">default</a>	commandstring = default(varname1,defaultvalue1,varname2,defaultvalue2,...)</li><li><a href="../../.././mnt/utils/join_struct.html" class="code" title="function c = join_struct(a,b)">join_struct</a>	c = join_struct(a,b)</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [q_sample, xmodel_sample, xdata_sample, kinetics_sample, v_sample, q_min, q_max] = parameter_balancing_constrained_sampling(task,res,options,quantity_info)</a>
0002 
0003 <span class="comment">% [q_sample, xmodel_sample, xdata_sample, kinetics_sample, v_sample, q_min, q_max] = parameter_balancing_constrained_sampling(task,res,options,quantity_info)</span>
0004 
0005 eval(<a href="../../.././mnt/utils/default.html" class="code" title="function commandstring = default(varargin)">default</a>(<span class="string">'options'</span>,<span class="string">'struct'</span>,<span class="string">'quantity_info'</span>,<span class="string">' data_integration_load_quantity_info'</span>));
0006 
0007 options_default.n_sample = 1000;
0008 options_default.n_warm   = [];
0009 options_default.n_pick   = 10;
0010 options_default.q_width  = 10;
0011 options_default.compute_reaction_velocities = 0;
0012 options_default.flag_artificial_centering = 0;
0013 options_default.insert_pseudo_values = 0;
0014 options_default.sampling_type = <span class="string">'gaussian'</span>;
0015 options_default.start_sampling_near_mode = 0;
0016 options_default.try_rejection_sampling = 0;
0017 
0018 options = <a href="../../.././mnt/utils/join_struct.html" class="code" title="function c = join_struct(a,b)">join_struct</a>(options_default,options);
0019 
0020 <span class="comment">% use all lower and upper values as explicit constraints</span>
0021 
0022 xconstraints = [-task.xlower.value_nat; <span class="keyword">...</span>
0023                  task.xupper.value_nat; ];
0024 
0025 Qconstraints = [-task.Q_xlower_q; <span class="keyword">...</span>
0026                  task.Q_xupper_q;];
0027 
0028 <span class="keyword">if</span> options.insert_pseudo_values,
0029 
0030 xconstraints = [xconstraints; <span class="keyword">...</span>
0031                 -task.xall.lower_nat; <span class="keyword">...</span>
0032                  task.xall.upper_nat;];
0033 
0034 Qconstraints = [Qconstraints; <span class="keyword">...</span>
0035                 -task.Q_xall_q; <span class="keyword">...</span>
0036                  task.Q_xall_q];
0037 
0038 <span class="keyword">end</span>
0039 
0040 ind_exact    = find(task.xdata.std &lt; 10^-3);
0041 <span class="keyword">if</span> ind_exact,
0042   display(<span class="string">'Data points with standard deviations &lt;10^-3 found. Using equality constraints.'</span>); 
0043   x_exact = task.xdata.mean(ind_exact);
0044   Q_exact = task.Q_xdata_q(ind_exact,:);
0045   ind_nonexact = find(task.xdata.std &gt;= 10^-3);
0046 <span class="keyword">else</span>
0047   x_exact = [];
0048   Q_exact = [];
0049 <span class="keyword">end</span>
0050 
0051 q_mode  = res.q_posterior.mode;
0052 q_mean  = res.q_posterior.mean;
0053 q_cov   = res.q_posterior.cov;
0054 q_std   = sqrt(diag(q_cov));
0055 q_lower = q_mode - options.q_width * q_std;
0056 q_upper = q_mode + options.q_width * q_std;
0057 
0058 <span class="keyword">if</span> options.start_sampling_near_mode,
0059   q_start = res.q_posterior.mode; 
0060 <span class="keyword">else</span>, 
0061   q_start = [];
0062 <span class="keyword">end</span>
0063 
0064 <span class="keyword">switch</span> options.sampling_type,
0065   
0066   <span class="keyword">case</span> <span class="string">'gaussian'</span>,
0067     
0068     display(<span class="string">'Running sampling with Gaussian distribution and constraints'</span>);
0069     <span class="comment">%% call hit and run directly</span>
0070     <span class="comment">%% [q_sample, q_min, q_max] = convex_sampling_hit_and_run(Qconstraints, xconstraints, Q_exact, x_exact, q_lower, q_upper, q_mean, q_cov, options.n_sample, options.n_warm,options.n_pick,options.flag_artificial_centering, q_start);</span>
0071     <span class="comment">%% call convex_sampling (remove equality constraints first)</span>
0072     ooptions         = options;
0073     ooptions.x_mean  = q_mean;
0074     ooptions.x_cov   = q_cov;
0075     ooptions.x_start = q_start;
0076     [q_sample, q_min, q_max] = <a href="../../.././mnt/utils/convex_sampling.html" class="code" title="function [x, x_lower, x_upper, success_flag, x_lower_list, x_upper_list] = convex_sampling(A_ineq,b_ineq,A_eq,b_eq,n_sample,xl,xu,verbose,method,options)">convex_sampling</a>(Qconstraints, xconstraints, Q_exact, x_exact, options.n_sample, q_lower, q_upper, 1, <span class="string">'hit-and-run'</span>, ooptions);
0077     
0078   <span class="keyword">case</span> <span class="string">'uniform'</span>,
0079     
0080     display(<span class="string">'Running uniform sampling'</span>);
0081     <span class="keyword">switch</span> options.try_rejection_sampling,
0082       <span class="keyword">case</span> 1,
0083         display(<span class="string">'Using rejection sampling instead of hit-and run'</span>);
0084         [q_sample, q_min, q_max] = <a href="../../.././mnt/utils/convex_sampling.html" class="code" title="function [x, x_lower, x_upper, success_flag, x_lower_list, x_upper_list] = convex_sampling(A_ineq,b_ineq,A_eq,b_eq,n_sample,xl,xu,verbose,method,options)">convex_sampling</a>(Qconstraints, xconstraints, Q_exact, x_exact,options.n_sample,q_lower, q_upper,0);
0085       <span class="keyword">case</span> 0,
0086         display(<span class="string">'Using hit-and run sampling'</span>);
0087         <span class="comment">%% call hit and run directly</span>
0088         <span class="comment">%% [q_sample, q_min, q_max] = convex_sampling_hit_and_run(Qconstraints, xconstraints, Q_exact, x_exact, q_lower, q_upper, [], [], options.n_sample, options.n_warm,options.n_pick,options.flag_artificial_centering, q_start );</span>
0089         <span class="comment">%% call convex_sampling (remove equality constraints first)</span>
0090         ooptions         = options;
0091         ooptions.x_mean  = [];
0092         ooptions.x_cov   = [];
0093         ooptions.x_start = q_start;
0094         [q_sample, q_min, q_max] = <a href="../../.././mnt/utils/convex_sampling.html" class="code" title="function [x, x_lower, x_upper, success_flag, x_lower_list, x_upper_list] = convex_sampling(A_ineq,b_ineq,A_eq,b_eq,n_sample,xl,xu,verbose,method,options)">convex_sampling</a>(Qconstraints, xconstraints, Q_exact, x_exact,options.n_sample,q_lower, q_upper,1,<span class="string">'hit-and-run'</span>,ooptions);   <span class="keyword">end</span>
0095   
0096 <span class="keyword">end</span>
0097 
0098 xmodel_sample = task.Q_xmodel_q * q_sample;
0099 xdata_sample  = task.Q_xdata_q  * q_sample;
0100 
0101 
0102 <span class="comment">% -----------------------------------------------------------------------</span>
0103 <span class="comment">% translate the sampled model values back to kinetic constants</span>
0104 
0105 [nr,nm,nx,ind_KM,ind_KA,ind_KI,nKM,nKA,nKI] = <a href="../../.././mnt/mnt_network/network_query/network_numbers.html" class="code" title="function [nr,nm,nx,KM_indices,KA_indices,KI_indices,nKM,nKA,nKI] = network_numbers(network)">network_numbers</a>(task.network);
0106 
0107 num_model = <a href="parameter_balancing_quantity_numbers.html" class="code" title="function num = parameter_balancing_quantity_numbers(quantities,quantity_info,network)">parameter_balancing_quantity_numbers</a>(task.model_quantities,quantity_info,task.network);
0108 
0109 <span class="keyword">for</span> it = 1:length(task.model_quantities),
0110   my_quantity     = task.model_quantities{it};
0111   ind             = find(strcmp(my_quantity,quantity_info.QuantityType));
0112   my_scaling      = quantity_info.Scaling{ind};
0113   my_symbol       = quantity_info.Symbol{ind};
0114   my_indices      = task.xmodel.indices.(my_symbol);
0115   my_x_sample     = xmodel_sample(my_indices,:);
0116 
0117   <span class="keyword">if</span> strcmp( my_scaling, <span class="string">'Logarithmic'</span>),
0118     my_x_sample   = exp(my_x_sample);
0119   <span class="keyword">else</span>
0120     my_x_sample   = my_x_sample;
0121   <span class="keyword">end</span>
0122   
0123   <span class="keyword">switch</span> my_symbol, 
0124     <span class="keyword">case</span> <span class="string">'KM'</span>, indices = ind_KM;
0125     <span class="keyword">case</span> <span class="string">'KA'</span>, indices = ind_KA;
0126     <span class="keyword">case</span> <span class="string">'KI'</span>, indices = ind_KI;
0127   <span class="keyword">end</span>
0128 
0129   <span class="keyword">switch</span> my_symbol, 
0130     <span class="keyword">case</span> {<span class="string">'KM'</span>},
0131       my_x_sample  =  exp(xmodel_sample(task.xmodel.indices.KM,:));
0132     <span class="keyword">case</span> {<span class="string">'KA'</span>},
0133       my_x_sample  =  exp(xmodel_sample(task.xmodel.indices.KA,:));
0134     <span class="keyword">case</span> {<span class="string">'KI'</span>},
0135       my_x_sample  =  exp(xmodel_sample(task.xmodel.indices.KI,:));
0136   <span class="keyword">end</span>
0137 
0138   kinetics_sample.(my_symbol)   = my_x_sample;
0139   
0140 <span class="keyword">end</span>
0141 
0142 <span class="keyword">if</span> options.compute_reaction_velocities,
0143   my_kinetics = task.network.kinetics;
0144   <span class="keyword">if</span> strcmp(<span class="string">'cs'</span>,my_kinetics.type),
0145     [v_sample] = <a href="parameter_balancing_sample_models.html" class="code" title="function [v, kinetics_list] = parameter_balancing_sample_models(task,kinetics_sample,options)">parameter_balancing_sample_models</a>(task,kinetics_sample,struct(<span class="string">'sample_models'</span>,<span class="string">'0'</span>));
0146   <span class="keyword">else</span>
0147     error(<span class="string">'Kinetics not supported'</span>);
0148   <span class="keyword">end</span>
0149 <span class="keyword">else</span>,
0150   v_sample = [];
0151 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Sat 15-Nov-2014 18:05:26 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>